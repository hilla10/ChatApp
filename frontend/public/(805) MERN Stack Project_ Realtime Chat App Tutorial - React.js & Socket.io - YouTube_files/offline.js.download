(function(g){var window=this;'use strict';var QYF=function(O){var f=new g.Ff("und",new g.p5("Default","und",!0));f.captionTracks=O.captionTracks;return f},R0F=function(O){return new g.QD(function(f,P){var x=O.length,M=[];
if(x)for(var r=function(Y,m){x--;M[Y]=m;x==0&&f(M)},d=function(Y){P(Y)},B,k=0;k<O.length;k++)B=O[k],g.kbd(B,g.T9(r,k),d);
else f(M)})},pZ=function(O){this.S=O},j1=function(){pZ.apply(this,arguments)},tBE=function(){j1.apply(this,arguments)},Fe4=function(){j1.apply(this,arguments)},nb4=function(){j1.apply(this,arguments)},p8T=function(){j1.apply(this,arguments)},jY2=function(){j1.apply(this,arguments)},HCJ=function(){j1.apply(this,arguments)},We2=function(){j1.apply(this,arguments)},T$9=function(){pZ.apply(this,arguments)},$p4=function(){j1.apply(this,arguments)},ZCT=function(){j1.apply(this,arguments)},cH2=function(){j1.apply(this,
arguments)},VB2=function(){j1.apply(this,arguments)},vbZ=function(){j1.apply(this,arguments)},z0F=function(){j1.apply(this,arguments)},h0r=function(){j1.apply(this,arguments)},EbJ=function(){j1.apply(this,arguments)},KeQ=function(){j1.apply(this,arguments)},a_2=function(){j1.apply(this,arguments)},sYr=function(){j1.apply(this,arguments)},iCE=function(){j1.apply(this,arguments)},Dp9=function(){pZ.apply(this,arguments)},yHE=function(){j1.apply(this,arguments)},Oq4=function(){j1.apply(this,arguments)},
fbT=function(){j1.apply(this,arguments)},Pp2=function(){j1.apply(this,arguments)},xLS=function(){j1.apply(this,arguments)},MT4=function(){j1.apply(this,arguments)},rDr=function(){j1.apply(this,arguments)},dLZ=function(){j1.apply(this,arguments)},wv1=function(){j1.apply(this,arguments)},BiE=function(){pZ.apply(this,arguments)},okJ=function(){pZ.apply(this,arguments)},kbS=function(){pZ.apply(this,arguments)},YFr=function(){j1.apply(this,arguments)},mLJ=function(){j1.apply(this,arguments)},eKF=function(){j1.apply(this,
arguments)},gkF=function(){j1.apply(this,arguments)},XvF=function(){j1.apply(this,arguments)},IbS=function(){j1.apply(this,arguments)},JDr=function(){j1.apply(this,arguments)},ULJ=function(){j1.apply(this,arguments)},qFF=function(){j1.apply(this,arguments)},LgT=function(){j1.apply(this,arguments)},lbF=function(){j1.apply(this,arguments)},NiF=function(){j1.apply(this,arguments)},SF2=function(){j1.apply(this,arguments)},uCF=function(){j1.apply(this,arguments)},GbZ=function(){j1.apply(this,arguments)},
CpF=function(){j1.apply(this,arguments)},bqr=function(){j1.apply(this,arguments)},ADQ=function(){j1.apply(this,arguments)},Qjr=function(){j1.apply(this,arguments)},RKT=function(){j1.apply(this,arguments)},tTT=function(){j1.apply(this,arguments)},Fg9=function(){j1.apply(this,arguments)},nkE=function(){j1.apply(this,arguments)},pvF=function(){j1.apply(this,arguments)},jj4=function(){j1.apply(this,arguments)},Hq1=function(){j1.apply(this,arguments)},WgJ=function(){j1.apply(this,arguments)},TiJ=function(){j1.apply(this,
arguments)},$LQ=function(){j1.apply(this,arguments)},ZqF=function(){pZ.apply(this,arguments)},cDT=function(){j1.apply(this,arguments)},VTQ=function(){j1.apply(this,arguments)},vkT=function(){j1.apply(this,arguments)},zK9=function(){j1.apply(this,arguments)},hKE=function(){j1.apply(this,arguments)},EkS=function(){j1.apply(this,arguments)},Kg4=function(){j1.apply(this,arguments)},abF=function(){j1.apply(this,arguments)},sjF=function(){j1.apply(this,arguments)},iqS=function(){j1.apply(this,arguments)},
DL9=function(){j1.apply(this,arguments)},yDS=function(){j1.apply(this,arguments)},OjZ=function(){j1.apply(this,arguments)},fU9=function(){j1.apply(this,arguments)},PZ1=function(){j1.apply(this,arguments)},xiF=function(){j1.apply(this,arguments)},MxF=function(){j1.apply(this,arguments)},r$4=function(){j1.apply(this,arguments)},dir=function(){j1.apply(this,arguments)},wsZ=function(){j1.apply(this,arguments)},BwQ=function(){j1.apply(this,arguments)},ouJ=function(){j1.apply(this,arguments)},kG1=function(){j1.apply(this,
arguments)},YXF=function(){j1.apply(this,arguments)},mi2=function(){j1.apply(this,arguments)},eQ2=function(){j1.apply(this,arguments)},guQ=function(){j1.apply(this,arguments)},XsF=function(){j1.apply(this,arguments)},IUT=function(){j1.apply(this,arguments)},J$r=function(){j1.apply(this,arguments)},UiT=function(){j1.apply(this,arguments)},qXF=function(){j1.apply(this,arguments)},LmF=function(){j1.apply(this,arguments)},lUE=function(){j1.apply(this,arguments)},Nw2=function(O){O=O.key||O.id;
if(!O)throw Error("Entity key is missing");return O},SXT=function(){if(HN)return HN();
var O={};HN=g.fs("PersistentEntityStoreDb",{PT:(O.EntityStore={qG:1},O.EntityAssociationStore={qG:2},O),shared:!1,upgrade:function(f,P){P(1)&&g.pn(g.A3(f,"EntityStore",{keyPath:"key"}),"entityType","entityType");P(2)&&(f=g.A3(f,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.pn(f,"byParentEntityKey","parentEntityKey"),g.pn(f,"byChildEntityKey","childEntityKey"))},
version:3});return HN()},u9r=function(O){return g.VK(SXT(),O)},GG4=function(O){return g.VK((0,g.KFE)(),O)},WN=function(O){this.token=O},TY=function(O,f){f=f===void 0?{}:f;
g.dU.call(this,g.a2J[O],Object.assign({},{name:"PESEncoderError",type:O},f));this.type=O;this.level="WARNING";Object.setPrototypeOf(this,TY.prototype)},CZ1=function(O){return new TY("WRONG_DATA_TYPE",{bA:O})},bjE=function(O){return O instanceof Error?new TY("UNKNOWN_ENCODE_ERROR",{originalMessage:O.message}):new TY("UNKNOWN_ENCODE_ERROR")},A$F=function(O){return O instanceof Error?new TY("UNKNOWN_DECODE_ERROR",{originalMessage:O.message}):new TY("UNKNOWN_DECODE_ERROR")},Qa4=function(O,f){O=O instanceof
TY?O:f(O);
g.br(O);throw O;},RQr=function(){},tx2=function(O,f,P){try{return O.K(f,P)}catch(x){Qa4(x,bjE)}},FmF=function(O){O=(new TextEncoder).encode(O).subarray(0,16);
var f=new Uint8Array(16);f.set(O);return f},$R=function(O){this.S=O},psE=function(O){var f=nu2[O];
if(f)return f;g.Qn(new g.dU("Entity model not found.",{entityType:O}))},ja2=function(O,f){this.S=O;
this.N=f;this.K={}},WmF=function(O,f){a:{O=HjZ(O.N,f.version);
try{var P=O.N(f.data,f.key);break a}catch(x){Qa4(x,A$F)}P=void 0}return P},Zy=function(O,f,P){return O.S.objectStore("EntityStore").get(f).then(function(x){if(x){if(P&&x.entityType!==P)throw Error("Incorrect entity type");
return WmF(O,x)}})},cN=function(O,f,P){return P?(P=P.map(function(x){return Zy(O,x,f)}),g.lj.all(P)):O.S.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(f)).then(function(x){return x.map(function(M){return WmF(O,M)})})},vN=function(O,f,P){var x=Nw2(f),M=HjZ(O.N,1),r=Object.assign({},f);
return O.S.objectStore("EntityStore").get(x).then(function(d){if(d){if(d.entityType!==P)throw Error("Incorrect entity type");r.entityMetadata||(d=WmF(O,d),r.entityMetadata=d.entityMetadata)}}).then(function(){var d={key:x,
entityType:P,data:tx2(M,r,x),version:1};return g.lj.all([g.t3(O.S.objectStore("EntityStore"),d),TwF(O,r,P)])}).then(function(){V$(O,x,P);
return x})},$i4=function(O,f,P){f=f.map(function(x){return vN(O,x,P)});
return g.lj.all(f)},zY=function(O,f,P){if(P==null?0:P.SJ){var x=new Set;
return Zj1(O,f,x).then(function(){for(var r=[],d=g.R(x),B=d.next();!B.done;B=d.next())r.push(zY(O,B.value));return g.lj.all(r).then(function(){})})}var M=g.VH(f).entityType;
return g.lj.all([O.S.objectStore("EntityStore").delete(f),c$S(O,f)]).then(function(){V$(O,f,M)})},Vx9=function(O,f){return g.Tf(O.S.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(f)},function(P){return g.lj.all([P.delete(),
c$S(O,P.cursor.primaryKey)]).then(function(){V$(O,P.cursor.primaryKey,f);return g.Hh(P)})})},vuF=function(O,f,P,x){var M=HjZ(O.N,1);
return Zy(O,f,x).then(function(r){if(r){r=g.wz(r,P);var d={key:f,entityType:x,data:tx2(M,r,f),version:1};return g.lj.all([g.t3(O.S.objectStore("EntityStore"),d),TwF(O,r,x)])}}).then(function(){V$(O,f,x);
return f})},V$=function(O,f,P){var x=O.K[P];
x||(x=new Set,O.K[P]=x);x.add(f)},zQF=function(O,f,P){var x=Nw2(f);
P=psE(P);if(!P)return g.lj.resolve([]);P=new P(f);O=O.S.objectStore("EntityAssociationStore");f=[];P=g.R(P.N());for(var M=P.next();!M.done;M=P.next())f.push(g.t3(O,{parentEntityKey:x,childEntityKey:M.value}));return g.lj.all(f).then(function(r){return r.map(function(d){return d[1]})})},c$S=function(O,f){return O.S.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(f))},TwF=function(O,f,P){var x=Nw2(f);
return c$S(O,x).then(function(){return zQF(O,f,P)})},Zj1=function(O,f,P){if(P.has(f))return g.lj.resolve(void 0);
P.add(f);return hQ4(O,f).then(function(x){return O.S.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(f)).then(function(){return x})}).then(function(x){var M=g.lj.resolve(void 0);
x=g.R(x);for(var r=x.next(),d={};!r.done;d={vv:void 0},r=x.next())d.vv=r.value,M=M.then(function(B){return function(){return Zj1(O,B.vv,P)}}(d));
return M}).then(function(){})},hQ4=function(O,f){var P=O.S.objectStore("EntityAssociationStore");
return P.index("byParentEntityKey").getAll(IDBKeyRange.only(f)).then(function(x){var M=[];x=g.R(x);for(var r=x.next();!r.done;r=x.next())r=r.value,M.push(P.index("byChildEntityKey").getAll(r.childEntityKey));return g.lj.all(M)}).then(function(x){var M=[];
x=g.R(x);for(var r=x.next();!r.done;r=x.next())r=r.value,r.length===1&&M.push(r[0].childEntityKey);return M})},hT=function(){},EuS=function(){this.S={};
this.S[0]=new hT;if(!g.GB("aes_pes_encoder_killswitch")){var O=this.S;try{var f=g.ak();var P=FmF(f);var x=new $R(new g.Mq(P),new g.ro(P))}catch(M){throw O=M instanceof Error?new TY("KEY_CREATION_FAILED",{originalMessage:M.message}):new TY("KEY_CREATION_FAILED"),g.br(O),O;}O[1]=x}},HjZ=function(O,f){f=f===void 0?0:f;
O=O.S[f];if(!O)throw f=new TY("INVALID_ENCODER_VERSION",{bA:f}),g.br(f),f;return O},EB=function(O,f){g.c.call(this);
this.token=O;this.S=f;this.observers=[];O=new g.G9.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.ak());O.onmessage=this.N.bind(this);this.channel=O},KZ=function(O,f,P){var x,M,r,d;
return g.T(function(B){if(B.S==1)return g.H(B,u9r(O.token),2);if(B.S!=3)return x=B.N,g.H(B,g.RN(x,["EntityStore","EntityAssociationStore"],f,function(k){M=new ja2(k,O.S);return P(M)}),3);
r=B.N;M&&(d=M.K,Object.keys(d).length>0&&(O.channel.postMessage(d),Km2(O,d)));return B.return(r)})},aL=function(O,f,P){return KZ(O,{mode:"readwrite",
b1:!0},function(x){return vN(x,f,P)})},aUF=function(O,f){return KZ(O,{mode:"readwrite",
b1:!0},function(P){return $i4(P,f,"offlineOrchestrationActionWrapperEntity")})},saZ=function(O,f){return KZ(O,{mode:"readwrite",
b1:!0},function(P){return zY(P,f)})},ijQ=function(O){return KZ(O,{mode:"readwrite",
b1:!0},function(f){return Vx9(f,"videoPlaybackPositionEntity")})},sB=function(O,f,P){return KZ(O,{mode:"readonly",
b1:!0},function(x){return Zy(x,f,P)})},ii=function(O,f,P){return KZ(O,{mode:"readonly",
b1:!0},function(x){return cN(x,f,P)})},Km2=function(O,f){O=g.R(O.observers);
for(var P=O.next();!P.done;P=O.next())P=P.value,P(f)},Di4=function(){var O,f,P;
return g.T(function(x){if(x.S==1)return g.oQ(x,2),g.H(x,g.yK(),4);if(x.S!=2){O=x.N;if(!O||!g.s3()||typeof g.G9.BroadcastChannel==="undefined")return x.return();f=new EuS;return x.return(new EB(O,f))}P=g.mF(x);P instanceof Error&&g.br(P);return x.return()})},Dy=function(){y$2||(y$2=Di4());
return y$2},OfS=function(O){var f;
O=(f=O.options)==null?void 0:f.persistenceOption;return O==="ENTITY_PERSISTENCE_OPTION_PERSIST"||O==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},f$E=function(O){var f;
return g.T(function(P){return P.S==1?g.H(P,Dy(),2):(f=P.N)?g.H(P,KZ(f,"readwrite",function(x){for(var M={},r=g.R(O),d=r.next(),B={};!d.done;B={z7:void 0,ih:void 0},d=r.next())B.z7=d.value,B.z7.entityKey&&OfS(B.z7)&&(B.ih=g.ua(B.z7.payload),d=void 0,B.z7.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(d=function(k){return function(){return vN(x,k.z7.payload[k.ih],k.ih)}}(B)),B.z7.type==="ENTITY_MUTATION_TYPE_DELETE"&&(d=function(k){return function(){return zY(x,k.z7.entityKey)}}(B)),B.z7.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(d=function(k){return function(){return vuF(x,k.z7.entityKey,k.z7.payload[k.ih],k.ih)}}(B)),d&&(M[B.z7.entityKey]=M[B.z7.entityKey]?M[B.z7.entityKey].then(d):d()));
return g.lj.all(Object.values(M))}),0):P.return()})},P_Z=function(O){var f;
return g.T(function(P){if(P.S==1){f=O.mutations;if(!f||f.length<=0)return P.return();if(g.I4){var x={type:"ENTITY_LOADED"};f!==void 0&&(x.payload=f);g.I4.dispatch(x)}return g.H(P,f$E(f),2)}f.length=0;g.Br(P)})},xoF=function(O){return O!==void 0},MME=function(O){var f=g.v3();
f=Object.assign({},f);O=Object.assign({},O);for(var P in f)O[P]?(f[P]!==4&&(f[P]=O[P]),delete O[P]):f[P]!==2&&(f[P]=4);Object.assign(f,O);g.mNU(f);JSON.stringify(f);return f},r_2=function(O){var f,P;
return g.T(function(x){if(x.S==1)return g.H(x,g.yK(),2);if(x.S!=3)return(f=x.N)?g.H(x,g.EY(f),3):x.return();P=x.N;return x.return(g.RN(P,["index","media","captions"],{mode:"readwrite",b1:!0},function(M){var r=IDBKeyRange.bound(O+"|",O+"~");M=[M.objectStore("index").delete(r),M.objectStore("media").delete(r),M.objectStore("captions").delete(r)];return g.lj.all(M).then(function(){})}))})},do9=function(){var O,f;
return g.T(function(P){if(P.S==1)return g.H(P,g.yK(),2);if(P.S!=3){O=P.N;if(!O)throw g.qy("rvdfd");return g.H(P,g.EY(O),3)}f=P.N;return P.return(g.RN(f,["index","media"],{mode:"readwrite",b1:!0},function(x){var M={};return g.jF(x.objectStore("index"),{},function(r){var d=r.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),B=g.lj.resolve(void 0);if(d){var k=d[1];d=d[2];M[k]=M[k]||{};var Y;M[k][d]=g.J9R((Y=r.getValue())==null?void 0:Y.fmts)}else B=r.delete().then(function(){});
return g.lj.all([g.Hh(r),B]).then(function(m){return g.R(m).next().value})}).then(function(){for(var r={},d=g.R(Object.keys(M)),B=d.next();!B.done;B=d.next()){B=B.value;
var k=M[B].v;r[B]=M[B].a&&k?1:2}var Y=MME(r);return g.OLd(x.objectStore("media"),{},function(m){var e=m.cursor.key.match(g.l4J);e&&r[e[1]]||x.objectStore("media").delete(m.cursor.key);return g.zNR(m)}).then(function(){return Y})})}))})},w_F=function(O,f){var P,x;
return g.T(function(M){if(M.S==1)return g.H(M,g.yK(),2);if(M.S!=3){P=M.N;if(!P)throw g.qy("wct");return g.H(M,g.EY(P),3)}x=M.N;return g.H(M,g.RN(x,["captions"],{mode:"readwrite",b1:!0},function(r){var d=[];r=r.objectStore("captions");for(var B=0;B<f.length;B++){var k=g.t3(r,f[B],O+"|"+f[B].metadata.vss_id);d.push(k)}return g.lj.all(d)}),0)})},BvS=function(O){var f,P,x;
return g.T(function(M){if(M.S==1)return f=IDBKeyRange.bound(O+"|",O+"~"),g.H(M,g.yK(),2);if(M.S!=3){P=M.N;if(!P)throw g.qy("gactfv");return g.H(M,g.EY(P),3)}x=M.N;return M.return(x.getAll("captions",f))})},oy1=function(O){return g.T(function(f){g.hL(O,0);
return f.return(r_2(O))})},kQT=function(O){return{context:g.s1(),
videoIds:O}},YmQ=function(O){return{context:g.s1(),
playlistIds:O}},moQ=function(O){return{context:g.s1(),
offlinePlaylistSyncChecks:O}},eVr=function(){this.S=new Map},X_F=function(){gy2||(gy2=new eVr);
return gy2},I$T=function(O,f){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:O},metadata:f,statusCode:void 0,csn:void 0,can:void 0}},J_J=function(O,f,P){if(!P){var x=x===void 0?!1:x;
P=O.S.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!P||x)P=g.Xp(16),O.S.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",P)}O={flowNonce:P,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:f.eventType};f.metadata&&(O.flowMetadata=f.metadata);f.statusCode!==void 0&&(O.flowEventStatus=f.statusCode);f.csn&&(O.csn=f.csn);f.can&&(O.can=f.can);g.eo("flowEvent",O,void 0)},UoF=function(O){var f,P,x,M,r,d,B,k,Y,m,e,X,I,J,l,S,Q,A,t,n,V,Z,rU,fd,xK,BY,eQ,PY,N2,iV,wE,ZE,sg,HY,aQ,tZ,b,D2,ET,oT;
return g.T(function(Q2){if(Q2.S==1)return g.H(Q2,KZ(O,{mode:"readonly",b1:!0},function(u){return cN(u,"playbackData").then(function(Og){var la=Og.map(function(DE){return DE.transfer}).filter(function(DE){return!!DE}),BX=Og.map(function(DE){return DE.offlineVideoPolicy}).filter(function(DE){return!!DE}),KB=Og.filter(function(DE){return!!DE.key}).map(function(DE){return g.vP(g.VH(DE.key).entityId,"downloadStatusEntity")});
la=cN(u,"transfer",la);BX=cN(u,"offlineVideoPolicy",BX);KB=cN(u,"downloadStatusEntity",KB);var og=la.then(function(DE){DE=DE.reduce(function(Pr,CB){(CB==null?0:CB.offlineVideoStreams)&&Pr.push.apply(Pr,g.F(CB.offlineVideoStreams));return Pr},[]).filter(function(Pr){return!!Pr});
return cN(u,"offlineVideoStreams",DE)});
return g.lj.all([la,BX,og,KB]).then(function(DE){var Pr=g.R(DE);DE=Pr.next().value;var CB=Pr.next().value;var C=Pr.next().value;Pr=Pr.next().value;return[Og,DE,CB,C,Pr]})})}),2);
if(Q2.S!=3)return f=Q2.N,g.H(Q2,KZ(O,{mode:"readonly",b1:!0},function(u){return cN(u,"mainDownloadsListEntity").then(function(Og){var la,BX;return(BX=(la=Og[0])==null?void 0:la.downloads)!=null?BX:[]})}),3);
P=Q2.N;x=g.R(f);M=x.next().value;r=x.next().value;d=x.next().value;B=x.next().value;k=x.next().value;Y=M;m=r;e=d;X=B;I=k;J={};l={};S={};Q={};A={};t=[];n=g.R(m);for(V=n.next();!V.done;V=n.next())(Z=V.value)&&(J[Z.key]=Z);rU=g.R(e);for(fd=rU.next();!fd.done;fd=rU.next())(xK=fd.value)&&(l[xK.key]=xK);BY=g.R(I);for(eQ=BY.next();!eQ.done;eQ=BY.next())(PY=eQ.value)&&(S[PY.key]=PY);N2=g.R(X);for(iV=N2.next();!iV.done;iV=N2.next())(wE=iV.value)&&(Q[wE.key]=wE);ZE=g.R(P);for(sg=ZE.next();!sg.done;sg=ZE.next())HY=
sg.value,aQ=void 0,A[(aQ=HY.videoItem)!=null?aQ:""]=!0,HY.videoItem&&(b=tZ=void 0,D2=(b=(tZ=g.VH(HY.videoItem))==null?void 0:tZ.entityId)!=null?b:"",t.push({externalVideoId:D2}));ET=Y.filter(function(u){if(!u||!u.key||!u.offlineVideoPolicy)return!1;u=g.VH(u.key).entityId;u=g.vP(u,"downloadStatusEntity");var Og;return!(u&&((Og=S[u])==null?void 0:Og.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
oT=ET.map(function(u){var Og=J[u.transfer],la=[];if(Og==null?0:Og.offlineVideoStreams)for(var BX=g.R(Og.offlineVideoStreams),KB=BX.next();!KB.done;KB=BX.next())(KB=Q[KB.value])&&la.push(KB);BX=l[u.offlineVideoPolicy];KB=A;var og=u==null?void 0:u.playerResponseTimestamp,DE=g.VH(BX.key).entityId;u=g.vP(DE,"mainVideoEntity");if(BX.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var Pr="OFFLINE_VIDEO_STATE_DISABLED";BX.expirationTimestamp&&Number(BX.expirationTimestamp)<Date.now()/1E3&&(Pr="OFFLINE_VIDEO_STATE_EXPIRED")}else if(BX.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")Pr="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(Og==null?void 0:Og.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":Pr="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":Pr="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":Pr="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":Pr="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":Pr="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":Pr="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:Pr="OFFLINE_VIDEO_STATE_UNKNOWN"}if(Pr==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(Og==null?void 0:Og.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":Pr="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":Pr="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":Pr=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}DE={id:DE,videoState:Pr};if(Og==null?0:Og.cotn)DE.cotn=Og.cotn;if(Og==null?0:Og.maximumDownloadQuality)DE.selectedVideoQuality=Og==null?void 0:Og.maximumDownloadQuality;if(Og==null?0:Og.lastProgressTimeMs)DE.lastProgressTimeMs=Og.lastProgressTimeMs;og&&(DE.playerResponseSavedTimeMs=String(Number(og)*1E3));Og=String;og=0;la=g.R(la);for(Pr=la.next();!Pr.done;Pr=la.next())if(Pr=Pr.value,Pr.streamsProgress){Pr=g.R(Pr.streamsProgress);for(var CB=Pr.next();!CB.done;CB=
Pr.next()){var C=void 0;og+=Number((C=CB.value.numBytesDownloaded)!=null?C:0)}}DE.downloadedBytes=Og(og);DE.selectedOfflineMode=KB[u]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";BX.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(DE.offlinePlaybackDisabledReason=BX.offlinePlaybackDisabledReason);return DE});
return Q2.return({offlineVideos:oT,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:t}}})})},qm2=function(){this.locks=navigator.locks},LWJ=function(){try{var O=g.b4("ytglobal.locks_");
if(O)return O;var f;if(f=navigator){var P=navigator;f="locks"in P&&!!P.locks}if(f)return g.G9.localStorage&&g.G9.localStorage.getItem("noop"),O=new qm2,g.CS("ytglobal.locks_",O),O}catch(x){}},y$=function(){},l$r=function(){},Nv2=function(O){if(O.includes(":"))throw Error("Invalid user cache name: "+O);
return O+":"+g.ak("CacheStorage get")},SmF=function(){return g.T(function(O){if(O8!==void 0)return O.return(O8);
O8=new Promise(function(f){var P;return g.T(function(x){switch(x.S){case 1:return g.oQ(x,2),g.H(x,fu.open("test-only"),4);case 4:return g.H(x,fu.delete("test-only"),5);case 5:g.YJ(x,3);break;case 2:if(P=g.mF(x),P instanceof Error&&P.name==="SecurityError")return f(!1),x.return();case 3:f("caches"in window),g.Br(x)}})});
return O.return(O8)})},GQ9=function(){return g.T(function(O){if(O.S==1)return g.H(O,SmF(),2);
if(!O.N)return O.return(void 0);uPE||(uPE=new l$r);return O.return(uPE)})},PJ=function(O,f,P){g.Qn(new g.dU("Woffle: "+O,P?{cotn:P}:""));
f instanceof Error&&g.Qn(f)},C_2=function(O){var f;
return g.T(function(P){if(P.S==1)return g.H(P,UoF(O),2);f=P.N;g.eo("offlineStateSnapshot",f);g.Br(P)})},x4=function(O){g.c.call(this);
var f=this;this.api=O;this.Pr={x$B:function(){return f.S},
CrN:function(){return f.N}};
typeof g.G9.BroadcastChannel!=="undefined"&&(this.S=new g.G9.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.ak()),this.S.onmessage=this.K.bind(this),this.N=new g.G9.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.ak()),this.N.onmessage=this.X.bind(this))},MX=function(O,f){O.api.PB("onOfflineOperationFailure",f);
var P;(P=O.S)==null||P.postMessage(f)},bf4=function(O,f,P){var x=this;
this.J=O;this.e$=f;this.visibility=P;this.j=this.W=this.C=this.K=this.S=!1;this.X=new g.Dt(function(){x.La()});
this.Pr={QT:function(){return x.N},
La:function(){x.La()},
va5:function(){return x.X}};
this.visibility.subscribe("visibilitystatechange",function(){x.Ge()})},A_E=function(O){if(!O.K&&!O.S){var f=LWJ();
if(f){O.K=!0;var P=g.ak("OfflineLockManager");f.request("woffle_orchestration_leader:"+P,{},function(){var x,M;return g.T(function(r){switch(r.S){case 1:return g.oQ(r,2),O.N=new g.mo,O.S=!0,O.K=!1,g.H(r,O.J(),4);case 4:return g.H(r,O.N.promise,5);case 5:g.YJ(r,0);break;case 2:x=g.mF(r),O.La(),x instanceof Error&&(M=x,M.args=[{name:"WoLockManagerError",AS:x.name}],g.br(M)),g.Br(r)}})})}}},Qu2=function(O){O.S&&(O.j=!0,rt(O))},RVF=function(O,f){O.S&&(O.C=f,rt(O))},tM1=function(O,f){O.S&&(O.W=f,rt(O))},
rt=function(O){O.W&&O.C&&O.j&&O.visibility.isBackground()?g.yl(O.X,6E4):O.X.stop()},dt=function(O){var f;
O.offlineDeleteReason=(f=O.offlineDeleteReason)!=null?f:"OFFLINE_DELETE_REASON_UNKNOWN";var P;O.offlineModeType=(P=O.offlineModeType)!=null?P:"OFFLINE_NOW";g.eo("offlineDeleteEvent",O)},wt=function(O,f){var P=f.videoId;
var x=f.H$;f=f.offlineModeType;O.encryptedVideoId=P;O.cotn=x==null?void 0:x.cotn;O.offlineabilityFormatType=x==null?void 0:x.maximumDownloadQuality;var M;O.isRefresh=(M=x==null?void 0:x.isRefresh)!=null?M:!1;var r;O.softErrorCount=(r=x==null?void 0:x.transferRetryCount)!=null?r:0;O.offlineModeType=f!=null?f:"OFFLINE_NOW";(O.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&O.statusType==="UNKNOWN_STATUS_TYPE"||!O.transferStatusType&&!O.statusType)&&g.Qn(Error("Woffle unknown transfer status"));
g.eo("offlineTransferStatusChanged",O)},FWr=function(O){wt({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},O)},nyT=function(O,f,P,x){x={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!x};f&&P&&(f=Math.floor(f/1024).toFixed(),P=Math.floor(P/1024).toFixed(),x.alreadyDownloadedKbytes=f,x.totalFetchedKbytes=f,x.totalContentKbytes=P);wt(x,O)},p_E=function(O){wt({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},O)},juF=function(O){wt({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},O)},Hf4=function(O){switch(O){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
BJ=function(O){var f,P,x;
return((x=(f=O.actionMetadata)==null?void 0:(P=f.retryScheduleIntervalsInSeconds)==null?void 0:P.length)!=null?x:0)>0},o6=function(O){return O.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!O.entityKey},k4=function(O){return O.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!O.entityKey},Y4=function(O){return O.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!O.entityKey},WWE=function(O){return O.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!O.entityKey},
mV=function(O,f,P,x,M){M=M===void 0?!1:M;
var r,d,B,k,Y,m;return g.T(function(e){if(e.S==1)return r=g.vP(O,f),d=g.vP(O,"downloadStatusEntity"),g.H(e,KZ(P,{mode:"readonly",b1:!0},function(X){return g.lj.all([Zy(X,r,f),Zy(X,d,"downloadStatusEntity")])}),2);
B=e.N;k=B.length?B[0]:void 0;if(!k)return e.R_(0);Y=Tv4;if(m=B.length>1?B[1]:void 0){if(m.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!M)return e.return();m.downloadState=x}else m={key:d,downloadState:x};g.pg(k,Y,m);return g.H(e,KZ(P,{mode:"readwrite",b1:!0},function(X){return g.lj.all([vN(X,k,f),vN(X,m,"downloadStatusEntity")])}),0)})},e3=function(O,f){return O.actionType===f.actionType&&O.entityKey===f.entityKey},gt=function(O,f){if(O&&O.transferState!=="TRANSFER_STATE_COMPLETE"&&O.transferState!==
"TRANSFER_STATE_FAILED"){var P=g.VH(O.key).entityId;
wt({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:P,H$:O,offlineModeType:f})}},X$=function(O){if(!O||!O.thumbnails)return[];
var f=[];O=g.R(O.thumbnails);for(var P=O.next();!P.done;P=O.next())P=P.value,P.url&&f.push(P.url);return f},$oS=function(O,f,P){P=P===void 0?[]:P;
var x,M,r,d,B,k,Y,m,e,X,I,J,l;return g.T(function(S){if(S.S==1)return P.length?g.H(S,ii(O,f),2):S.return([]);x=S.N;M=new Set;r=g.R(x);for(d=r.next();!d.done;d=r.next())if(B=d.value,k=B.id||B.key)Y=g.VH(k).entityId,M.add(Y);m=[];e=g.R(P);for(X=e.next();!X.done;X=e.next())I=X.value,J=I.offlineVideoData,l=void 0,((l=J)==null?0:l.videoId)&&!M.has(J.videoId)&&m.push(I);return S.return(m)})},ZfT=function(O,f,P){return new g.rB(O,{cotn:f,
raw_player_response:P,download_media:!0,start:Infinity,disable_watch_next:!0})},c_r=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},I6=function(O,f,P,x,M,r,d,B,k,Y,m){this.entityType=O;
this.actionId=f;this.action=P;this.parentActionId=x;this.rootActionId=M===void 0?f:M;this.childActionIds=r;this.prereqActionId=d;this.postreqActionIds=B;this.hasChildActionFailed=Y;this.retryScheduleIndex=0;this.S=m||Date.now();this.retryScheduleIndex=k||0},Ji=function(O){if(!O.key)throw Error("Entity key is required.");
if(!O.actionProto)throw Error("OfflineOrchestrationAction is required.");var f=g.VH(O.key),P=g.VH(O.actionProto.entityKey);return new I6(P.entityType,f.entityId,O.actionProto,O.parentActionId,O.rootActionId,O.childActionIds,O.prereqActionId,O.postreqActionIds,O.retryScheduleIndex,O.hasChildActionFailed,Number(O.enqueueTimeSec)*1E3)},U8=function(O){return{key:g.vP(O.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:O.action,parentActionId:O.parentActionId,rootActionId:O.rootActionId,childActionIds:O.childActionIds,prereqActionId:O.prereqActionId,postreqActionIds:O.postreqActionIds,retryScheduleIndex:O.retryScheduleIndex,hasChildActionFailed:O.hasChildActionFailed,enqueueTimeSec:(O.S/1E3).toFixed()}},VM4=function(){var O;
return g.T(function(f){return f.S==1?g.H(f,GQ9(),2):(O=f.N)?f.return(O.delete("yt-player-local-img")):f.return(!0)})},qX=function(O){var f,P;
return g.T(function(x){if(x.S==1)return g.H(x,GQ9(),2);if(x.S!=3){f=x.N;if(!f)throw Error("Cache API not supported");return O.length?g.H(x,f.open("yt-player-local-img"),3):x.return()}P=x.N;return g.H(x,Promise.all(O.map(function(M){return P.delete(M)})),0)})},Lu=function(O){var f,P;
return g.T(function(x){if(x.S==1)return g.H(x,GQ9(),2);if(x.S!=3){f=x.N;if(!f)throw Error("Cache API not supported");return O.length?g.H(x,f.open("yt-player-local-img"),3):x.return()}P=x.N;return g.H(x,P.addAll(O),0)})},lB=function(O,f,P,x,M){var r,d,B,k,Y,m,e,X,I,J,l,S,Q,A,t,n,V,Z,rU,fd,xK,BY,eQ,PY,N2,iV,wE,ZE,sg,HY,aQ;
return g.T(function(tZ){switch(tZ.S){case 1:return r=g.vP(O,"mainVideoEntity"),d=g.vP(O,"ytMainChannelEntity"),B=g.vP(O,"transfer"),k=g.vP(O,"videoDownloadContextEntity"),g.H(tZ,KZ(f,{mode:"readonly",b1:!0},function(b){return g.lj.all([Zy(b,r,"mainVideoEntity"),Zy(b,d,"ytMainChannelEntity"),Zy(b,B,"transfer"),Zy(b,k,"videoDownloadContextEntity"),cN(b,"ytMainChannelEntity"),cN(b,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:Y=tZ.N;m=g.R(Y);e=m.next().value;X=m.next().value;I=m.next().value;J=m.next().value;l=m.next().value;S=m.next().value;Q=e;A=X;t=I;n=J;V=l;Z=S;if(!Q&&!A){tZ.R_(3);break}rU=Q?X$(Q.thumbnail):[];if(!A){fd=[];tZ.R_(4);break}return g.H(tZ,vyF(A,V),5);case 5:fd=tZ.N;case 4:return xK=fd,g.H(tZ,qX(rU.concat(xK)),3);case 3:BY=[];eQ=g.vP(O,"downloadStatusEntity");PY=g.R(Z);for(N2=PY.next();!N2.done;N2=PY.next())iV=N2.value,wE=g.VH(iV.key).entityId,ZE=Ji(iV),sg=g.VH(ZE.action.entityKey).entityId,wE!==
O&&sg!==O||e3(P,iV.actionProto)||BY.push(iV.key);return g.H(tZ,KZ(f,{mode:"readwrite",b1:!0},function(b){var D2=BY.map(function(ET){return zY(b,ET)});
D2.push(zY(b,r,{SJ:!0}));D2.push(zY(b,eQ,{SJ:!0}));return g.lj.all(D2)}),7);
case 7:aQ=(HY=n)==null?void 0:HY.offlineModeType,M&&(dt(M),M.offlineModeType&&(aQ=M.offlineModeType)),gt(t,aQ),MX(x,{entityKey:r,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Br(tZ)}})},EyJ=function(O,f,P,x){var M,r,d,B,k,Y,m,e,X,I,J,l,S,Q,A,t,n,V,Z,rU,fd,xK,BY,eQ,PY,N2,iV,wE,ZE,sg,HY,aQ,tZ,b,D2,ET,oT,Q2,u,Og,la,BX,KB,og,DE,Pr,CB,C,N,G;
return g.T(function(p){switch(p.S){case 1:return M=g.vP(O,"mainPlaylistEntity"),r=g.vP(O,"ytMainChannelEntity"),g.H(p,KZ(f,{mode:"readonly",b1:!0},function(E){return g.lj.all([Zy(E,M,"mainPlaylistEntity"),Zy(E,r,"ytMainChannelEntity"),cN(E,"mainPlaylistEntity"),cN(E,"mainDownloadsListEntity"),cN(E,"ytMainChannelEntity"),cN(E,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:d=p.N;B=g.R(d);k=B.next().value;Y=B.next().value;m=B.next().value;e=B.next().value;X=B.next().value;I=B.next().value;J=k;l=Y;S=m;Q=e;A=X;t=I;if(!J&&!l){p.R_(3);break}n=J?zVF(J):[];if(!l){V=[];p.R_(4);break}return g.H(p,vyF(l,A),5);case 5:V=p.N;case 4:return Z=V,g.H(p,qX(n.concat(Z)),3);case 3:rU=[];fd=new Map;if(!J){p.R_(7);break}return g.H(p,hVQ(J,S,Q),8);case 8:rU=p.N;xK=g.R(rU);for(BY=xK.next();!BY.done;BY=xK.next())eQ=BY.value,fd.set(eQ,{videoId:eQ,playlistId:O,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.H(p,KZ(f,{mode:"readonly",b1:!0},function(E){return g.lj.all([cN(E,"transfer"),cN(E,"videoDownloadContextEntity")])}),9);
case 9:PY=p.N;N2=g.R(PY);iV=N2.next().value;wE=N2.next().value;ZE=iV;sg=wE;HY=g.R(ZE);for(aQ=HY.next();!aQ.done;aQ=HY.next())tZ=aQ.value,b=g.VH(tZ.key).entityId,(D2=fd.get(b))&&tZ&&(D2.cotn=tZ.cotn);ET=g.R(sg);for(oT=ET.next();!oT.done;oT=ET.next())Q2=oT.value,u=g.VH(Q2.key).entityId,(Og=fd.get(u))&&Q2&&(Og.offlineModeType=Q2.offlineModeType);case 7:la=[];BX=g.R(t);for(KB=BX.next();!KB.done;KB=BX.next())og=KB.value,DE=g.VH(og.key).entityId,Pr=Ji(og),DE!==O&&Pr.rootActionId!==O||e3(P,og.actionProto)||
la.push(og.key);CB=g.vP(O,"mainPlaylistEntity");return g.H(p,KZ(f,{mode:"readwrite",b1:!0},function(E){var wU=la.map(function(a){return zY(E,a)});
wU.push(zY(E,CB,{SJ:!0}));return g.lj.all(wU)}),10);
case 10:if(!J){p.R_(0);break}rU.reverse();if(!rU){p.R_(0);break}C=g.R(rU);N=C.next();case 13:if(N.done){p.R_(0);break}G=N.value;return g.H(p,lB(G,f,P,x,fd.get(G)),14);case 14:N=C.next(),p.R_(13)}})},a$F=function(O,f,P,x){var M,r,d,B,k,Y,m,e,X;
return g.T(function(I){if(I.S==1)return M=g.vP("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),r=new Map,g.H(I,KZ(O,{mode:"readwrite",b1:!0},function(J){var l=cN(J,"transfer"),S=cN(J,"offlineOrchestrationActionWrapperEntity"),Q=cN(J,"videoDownloadContextEntity"),A=Zy(J,M,"mainDownloadsListEntity");return g.lj.all([l,S,Q,A]).then(function(t){t=g.R(t);var n=t.next().value;var V=t.next().value;var Z=t.next().value;var rU=t.next().value;t=KWr.map(function(xK){return Vx9(J,xK)});
V=g.R(V);for(var fd=V.next();!fd.done;fd=V.next())fd=fd.value,e3(f,fd.actionProto)||t.push(zY(J,fd.key,{SJ:!0}));rU&&(rU.downloads=[],t.push(vN(J,rU,"mainDownloadsListEntity")));if(Z)for(Z=g.R(Z),rU=Z.next();!rU.done;rU=Z.next())rU=rU.value,V=g.VH(rU.key).entityId,V=g.vP(V,"transfer"),r.set(V,rU.offlineModeType);return g.lj.all(t).then(function(){return n})})}),2);
d=I.N;B=g.R(d);for(k=B.next();!k.done;k=B.next())Y=k.value,gt(Y,r.get(Y.key)),m=g.VH(Y.key).entityId,e={videoId:m,offlineDeleteReason:x,cotn:Y.cotn,offlineModeType:r.get(Y.key)},dt(e),X=g.vP(m,"mainVideoEntity"),MX(P,{entityKey:X,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.H(I,VM4(),0)})},zVF=function(O,f){var P=[];
if(O.thumbnailStyleData){O=g.R(O.thumbnailStyleData);for(var x=O.next();!x.done;x=O.next()){var M=void 0,r=void 0,d=void 0;P=P.concat(X$((M=x.value)==null?void 0:(r=M.value)==null?void 0:(d=r.collageThumbnail)==null?void 0:d.coverThumbnail))}}f=X$(f);return P.concat(f)},hVQ=function(O,f,P){var x,M,r,d,B,k,Y,m,e,X,I,J,l,S,Q,A,t,n,V,Z,rU,fd,xK;
return g.T(function(BY){x=[];M=new Set;if(P.length)for(r=g.R(P),d=r.next();!d.done;d=r.next())if(B=d.value,k=void 0,(k=B.downloads)==null?0:k.length)for(Y=g.R(B.downloads),m=Y.next();!m.done;m=Y.next())e=m.value,e.videoItem&&(X=g.VH(e.videoItem).entityId,M.add(X));if(O.videos){I=g.R(O.videos);for(J=I.next();!J.done;J=I.next())l=J.value,S=JSON.parse(g.VH(l).entityId),S.videoId&&!M.has(S.videoId)&&x.push(S.videoId);Q=g.R(f);for(A=Q.next();!A.done;A=Q.next())if(t=A.value,t.key!==O.key&&(n=t.videos))for(V=
g.R(n),Z=V.next();!Z.done;Z=V.next())rU=Z.value,fd=JSON.parse(g.VH(rU).entityId),fd.videoId&&(xK=x.indexOf(fd.videoId),xK!==-1&&x.splice(xK,1))}return BY.return(x)})},vyF=function(O,f){var P,x,M,r,d,B,k,Y;
return g.T(function(m){P=X$(O.avatar);x=g.R(f);for(M=x.next();!M.done;M=x.next())if(r=M.value,r.id!==O.id)for(d=g.R(X$(r.avatar)),B=d.next();!B.done;B=d.next())k=B.value,Y=P.indexOf(k),Y!==-1&&P.splice(Y,1);return m.return(P)})},suQ=function(O){var f;
return g.T(function(P){f=g.q(O.frameworkUpdates,NX);return O.frameworkUpdates&&f?g.H(P,P_Z(f),0):P.return()})},DoJ=function(O){var f;
if((f=O.onResponseReceivedActions)!=null&&f.length){var P;O=(P=g.q(g.q(O.onResponseReceivedActions[0],ifQ),g.idS))==null?void 0:P.actions;if(O!=null&&O.length)return O}},y_E=function(O){var f,P,x;
return g.T(function(M){if(M.S==1)return O?g.H(M,sB(O,g.pQ,"mainDownloadsListEntity"),2):M.return([]);f=M.N;return((P=f)==null?0:(x=P.downloads)==null?0:x.length)?M.return(f.downloads.map(function(r){var d;return(d=r.videoItem)!=null?d:""})):M.return([])})},fWF=function(O,f){var P;
return g.T(function(x){return x.S==1?g.H(x,O4Q(O,f),2):(P=x.N)?g.H(x,KZ(O,{mode:"readwrite",b1:!0},function(M){var r=[vN(M,P.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];P.mainDownloadsListEntity&&r.push(vN(M,P.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.lj.all(r)}),0):x.R_(0)})},O4Q=function(O,f){var P,x,M,r,d,B,k,Y,m,e,X,I,J,l,S,Q,A,t;
return g.T(function(n){if(n.S==1)return P=g.vP("main_downloads_library_id","mainDownloadsLibraryEntity"),x=g.vP("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.H(n,KZ(O,{mode:"readonly",b1:!0},function(V){return g.lj.all([Zy(V,P,"mainDownloadsLibraryEntity"),Zy(V,x,"mainDownloadsListEntity")])}),2);
M=n.N;r=g.R(M);d=r.next().value;B=r.next().value;k=d;Y=B;k||(k={id:P});m=g.R(f);for(e=m.next();!e.done;e=m.next())if(X=e.value,X===g.pQ){if(k.smartDownloadsList)return n.return();k.smartDownloadsList=X}else if(I=g.VH(X).entityType,J={},I==="mainPlaylistEntity"?J.playlistItem=X:I==="mainVideoEntity"&&(J.videoItem=X),!g.tt(J)){l=void 0;if((l=Y)==null?0:l.downloads){S=!1;Q=g.R(Y.downloads);for(A=Q.next();!A.done;A=Q.next())if(t=A.value,t.playlistItem===X||t.videoItem===X){S=!0;break}S||Y.downloads.push(J)}else Y=
{id:x,downloads:[J]};k.downloadsList=x}return n.return({mainDownloadsLibraryEntity:k,mainDownloadsListEntity:Y})})},PXT=function(O,f){var P,x,M,r,d,B,k,Y,m,e,X,I,J,l,S;
return g.T(function(Q){if(Q.S==1)return P=g.vP("main_downloads_library_id","mainDownloadsLibraryEntity"),x=g.vP("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.H(Q,KZ(O,{mode:"readonly",b1:!0},function(A){return g.lj.all([Zy(A,P,"mainDownloadsLibraryEntity"),Zy(A,x,"mainDownloadsListEntity"),Zy(A,g.pQ,"mainDownloadsListEntity")])}),2);
M=Q.N;r=g.R(M);d=r.next().value;B=r.next().value;k=r.next().value;Y=d;m=B;e=k;if(!Y)return Q.R_(0);if(f===g.pQ&&((X=e)==null?0:X.downloads))e.downloads=[];else if((I=m)==null?0:I.downloads)for(J=g.VH(f).entityType,l=0;l<m.downloads.length;l++)if(S=m.downloads[l],J==="mainVideoEntity"&&S.videoItem===f){m.downloads.splice(l,1);break}else if(J==="mainPlaylistEntity"&&S.playlistItem===f){m.downloads.splice(l,1);break}return g.H(Q,KZ(O,{mode:"readwrite",b1:!0},function(A){var t=[vN(A,Y,"mainDownloadsLibraryEntity")];
m&&t.push(vN(A,m,"mainDownloadsListEntity"));e&&t.push(vN(A,e,"mainDownloadsListEntity"));return g.lj.all(t)}),0)})},S3=function(O,f){var P,x,M,r,d,B,k,Y,m,e,X;
return g.T(function(I){if(I.S==1)return P=g.vP(f,"transfer"),x=g.vP(f,"videoDownloadContextEntity"),g.H(I,KZ(O,{mode:"readonly",b1:!0},function(J){return g.lj.all([Zy(J,P,"transfer"),Zy(J,x,"videoDownloadContextEntity")])}),2);
M=I.N;r=g.R(M);d=r.next().value;B=r.next().value;k=d;Y=B;X={videoId:f,cotn:(m=k)==null?void 0:m.cotn,offlineModeType:(e=Y)==null?void 0:e.offlineModeType};return I.return(X)})},uB=function(O,f,P,x,M){var r,d,B,k,Y,m,e,X,I,J,l,S,Q,A,t,n,V,Z,rU,fd;
return g.T(function(xK){switch(xK.S){case 1:return r=g.vP(O,"musicTrack"),d=g.vP(O,"transfer"),g.H(xK,KZ(f,{mode:"readonly",b1:!0},function(BY){return g.lj.all([Zy(BY,r,"musicTrack"),Zy(BY,d,"transfer"),cN(BY,"musicTrack"),cN(BY,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:B=xK.N;k=g.R(B);Y=k.next().value;m=k.next().value;e=k.next().value;X=k.next().value;I=Y;J=m;l=e;S=X;if(!I){xK.R_(3);break}return g.H(xK,x5E(I,l),4);case 4:return Q=xK.N,g.H(xK,qX(Q),3);case 3:A=[];t=g.R(S);for(n=t.next();!n.done;n=t.next())V=n.value,Z=g.VH(V.key).entityId,rU=Ji(V),fd=g.VH(rU.action.entityKey).entityId,Z!==O&&fd!==O||e3(P,V.actionProto)||A.push(V.key);return g.H(xK,KZ(f,{mode:"readwrite",b1:!0},function(BY){var eQ=A.map(function(PY){return zY(BY,PY)});
eQ.push(zY(BY,r,{SJ:!0}));return g.lj.all(eQ)}),6);
case 6:gt(J),M&&dt(M),MX(x,{entityKey:r,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Br(xK)}})},G5=function(O,f,P,x,M){var r,d,B,k,Y,m,e,X,I,J,l,S,Q,A,t,n,V,Z,rU,fd,xK,BY,eQ,PY,N2,iV,wE,ZE,sg,HY,aQ,tZ,b,D2,ET,oT;
return g.T(function(Q2){switch(Q2.S){case 1:return r=g.vP(O,f),d=g.vP("music_downloads_library_id","musicDownloadsLibraryEntity"),g.H(Q2,KZ(P,{mode:"readonly",b1:!0},function(u){return g.lj.all([Zy(u,r,f),Zy(u,d,"musicDownloadsLibraryEntity"),cN(u,f),cN(u,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:B=Q2.N;k=g.R(B);Y=k.next().value;m=k.next().value;e=k.next().value;X=k.next().value;I=Y;J=m;l=e;S=X;if(!I){Q2.R_(3);break}return g.H(Q2,x5E(I,l),4);case 4:return Q=Q2.N,g.H(Q2,qX(Q),3);case 3:A=[];t=new Map;if(!I){Q2.R_(6);break}return g.H(Q2,MmQ(I,l,J),7);case 7:A=Q2.N;n=g.R(A);for(V=n.next();!V.done;V=n.next())Z=V.value,rU=g.VH(Z).entityId,t.set(rU,{videoId:rU,playlistId:O,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.H(Q2,ii(P,"transfer"),8);case 8:for(fd=Q2.N,
xK=g.R(fd),BY=xK.next();!BY.done;BY=xK.next())eQ=BY.value,PY=g.VH(eQ.key).entityId,(N2=t.get(PY))&&eQ&&(N2.cotn=eQ.cotn);case 6:iV=[];wE=g.R(S);for(ZE=wE.next();!ZE.done;ZE=wE.next())sg=ZE.value,HY=g.VH(sg.key).entityId,aQ=Ji(sg),HY!==O&&aQ.rootActionId!==O||e3(x,sg.actionProto)||iV.push(sg.key);tZ=g.vP(O,f);return g.H(Q2,KZ(P,{mode:"readwrite",b1:!0},function(u){var Og=iV.map(function(la){return zY(u,la)});
Og.push(zY(u,tZ,{SJ:!0}));return g.lj.all(Og)}),9);
case 9:if(!I){Q2.R_(0);break}A.reverse();if(!A.length){Q2.R_(0);break}b=g.R(A);D2=b.next();case 12:if(D2.done){Q2.R_(0);break}ET=D2.value;oT=g.VH(ET).entityId;if(!oT){Q2.R_(13);break}return g.H(Q2,uB(oT,P,x,M,t.get(oT)),13);case 13:D2=b.next(),Q2.R_(12)}})},Cu=function(O,f,P){var x,M,r,d,B,k,Y;
return g.T(function(m){if(m.S==1)return g.H(m,KZ(O,{mode:"readwrite",b1:!0},function(e){var X=cN(e,"transfer"),I=cN(e,"offlineOrchestrationActionWrapperEntity");return g.lj.all([X,I]).then(function(J){J=g.R(J);var l=J.next().value;var S=J.next().value;J=rEF.map(function(n){return Vx9(e,n)});
S=g.R(S);for(var Q=S.next();!Q.done;Q=S.next()){Q=Q.value;var A=g.VH(Q.actionProto.entityKey).entityType==="musicTrack",t=Q.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";e3(f,Q.actionProto)||A&&(!A||t)||J.push(zY(e,Q.key,{SJ:!0}))}return g.lj.all(J).then(function(){return l})})}),2);
x=m.N;M=g.R(x);for(r=M.next();!r.done;r=M.next())d=r.value,gt(d),B=g.VH(d.key).entityId,k={videoId:B,offlineDeleteReason:void 0,cotn:d.cotn},dt(k),Y=g.vP(B,"musicTrack"),MX(P,{entityKey:Y,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.H(m,VM4(),0)})},d5T=function(O){for(var f,P=g.R(O.additionalMetadatas),x=P.next();!x.done;x=P.next())x=x.value,x.offlineMusicVideoData&&(f=x.offlineMusicVideoData);
var M,r,d,B,k;return{id:g.vP(O.videoId,"musicTrack"),videoId:O.videoId,title:O.title,thumbnailDetails:O.thumbnail,lengthMs:String(Number(O.lengthSeconds)*1E3),albumTitle:(M=f)==null?void 0:M.releaseTitle,musicVideoType:(r=f)==null?void 0:r.musicVideoType,contentRating:{explicitType:(d=f)==null?void 0:d.explicitType},artistNames:((B=f)==null?void 0:B.byline)||((k=f)==null?void 0:k.channelName),downloadMetadata:g.vP(O.videoId,"musicTrackDownloadMetadataEntity")}},MmQ=function(O,f,P){var x,M,r,d,B,k,
Y,m,e,X,I,J,l,S,Q,A,t,n;
return g.T(function(V){x=[];M=new Set;if((r=P)==null?0:(d=r.downloadedTracks)==null?0:d.length)for(B=g.R(P.downloadedTracks),k=B.next();!k.done;k=B.next())Y=k.value,M.add(Y);if(O.tracks){m=g.R(O.tracks);for(e=m.next();!e.done;e=m.next())X=e.value,M.has(X)||x.push(X);I=g.R(f);for(J=I.next();!J.done;J=I.next())if(l=J.value,l.id!==O.id&&(S=l.tracks))for(Q=g.R(S),A=Q.next();!A.done;A=Q.next())t=A.value,n=x.indexOf(t),n!==-1&&x.splice(n,1)}return V.return(x)})},x5E=function(O,f){var P,x,M,r,d,B,k,Y;
return g.T(function(m){P=X$(O.thumbnailDetails);x=g.R(f);for(M=x.next();!M.done;M=x.next())if(r=M.value,r.id!==O.id)for(d=g.R(X$(r.thumbnailDetails)),B=d.next();!B.done;B=d.next())k=B.value,Y=P.indexOf(k),Y!==-1&&P.splice(Y,1);return m.return(P)})},w6S=function(O,f){var P,x,M,r,d,B,k,Y,m;
return g.T(function(e){if(e.S==1)return P=g.vP("music_downloads_library_id","musicDownloadsLibraryEntity"),g.H(e,sB(O,P,"musicDownloadsLibraryEntity"),2);(x=e.N)||(x={id:P});M=g.VH(f).entityType;M==="musicTrack"?(r=x.downloadedTracks)!=null&&r.includes(f)||(x.downloadedTracks=((d=x.downloadedTracks)!=null?d:[]).concat(f)):M==="musicPlaylist"?(B=x.downloadedPlaylists)!=null&&B.includes(f)||(x.downloadedPlaylists=((k=x.downloadedPlaylists)!=null?k:[]).concat(f)):M!=="musicAlbumRelease"||(Y=x.downloadedAlbumReleases)!=
null&&Y.includes(f)||(x.downloadedAlbumReleases=((m=x.downloadedAlbumReleases)!=null?m:[]).concat(f));return g.H(e,aL(O,x,"musicDownloadsLibraryEntity"),0)})},BYF=function(O,f){var P,x,M,r,d,B,k;
return g.T(function(Y){if(Y.S==1)return P=g.vP("music_downloads_library_id","musicDownloadsLibraryEntity"),g.H(Y,sB(O,P,"musicDownloadsLibraryEntity"),2);x=Y.N;if(!x)return Y.R_(0);M=g.VH(f).entityType;M==="musicTrack"?r=x.downloadedTracks:M==="musicPlaylist"&&(r=x.downloadedPlaylists);if((d=r)==null?0:d.length)for(B=0;B<r.length;B++)if(k=r[B],k===f){r.splice(B,1);break}return g.H(Y,aL(O,x,"musicDownloadsLibraryEntity"),0)})},oeS=function(O){var f=O.videos;
O=[];var P=[];if(f){f=g.R(f);for(var x=f.next();!x.done;x=f.next()){var M=x.value.offlineVideoData.videoId;x=g.vP(M,"musicTrack");M=g.vP(M,"musicTrackDownloadMetadataEntity");O.push(x);P.push(M)}}return{Zd:O,A6:P}},bB=function(O,f,P){f={track:d5T(f)};
P&&(f.playlistId=P);if(O=g.q(O.actionMetadata,km2))f.maximumDownloadQuality=O.maximumDownloadQuality;return{musicTrackEntityActionMetadata:f}},m52=function(O){var f,P,x,M,r,d,B,k;
return g.T(function(Y){switch(Y.S){case 1:return f=g.at(),P=kQT(O),x=g.y7(YK2),g.oQ(Y,2),r={Yq:!0},g.H(Y,g.je(f,P,x,void 0,r),4);case 4:M=Y.N;g.YJ(Y,3);break;case 2:d=g.mF(Y);if(d instanceof g.hk)throw B="GetOffline network manager error: "+d.message,PJ(B,d),Error(B);PJ("GetOffline fetch request error",d);throw Error("GetOffline fetch request error");case 3:k=Ai(M);if(!M)throw PJ("Network request failed"),Error("Network request failed");if(k!==void 0)Qy(k);else if(!M.videos||!M.videos.length)throw PJ("No data"),
Error("No data");return Y.return(M.videos.map(function(m){return m.offlineVideoData}))}})},e9S=function(O){var f,P,x,M,r,d,B,k;
return g.T(function(Y){switch(Y.S){case 1:return f=g.at(),P=YmQ(O),x=g.y7(YK2),g.oQ(Y,2),r={Yq:!0},g.H(Y,g.je(f,P,x,void 0,r),4);case 4:M=Y.N;g.YJ(Y,3);break;case 2:d=g.mF(Y);if(d instanceof g.hk)throw B="GetOffline network manager error for playlist: "+d.message,PJ(B,d),Error(B);PJ("GetOffline fetch request error for playlist",d);throw Error("GetOffline fetch request error for playlist");case 3:k=Ai(M);if(!M)throw PJ("Network request failed for playlist"),Error("Network request failed for playlist");
if(k!==void 0)Qy(k,"playlist");else if(!M.playlists||!M.playlists.length)throw PJ("No data for playlist"),Error("No data for playlist");return Y.return(M.playlists.map(function(m){return m.offlinePlaylistData}))}})},X6F=function(O,f,P,x){var M,r,d,B,k,Y,m,e,X,I,J,l,S,Q,A,t,n,V,Z,rU,fd,xK,BY,eQ,PY,N2,iV,wE,ZE,sg;
return g.T(function(HY){switch(HY.S){case 1:return g.H(HY,Dy(),2);case 2:M=HY.N;if(!M)return HY.return([]);r=[];if((d=x)==null?0:d.length){r=x;HY.R_(3);break}return g.H(HY,ii(M,"mainPlaylistEntity"),4);case 4:r=HY.N;case 3:if(!r.length)return HY.return([]);B=[];k=Date.now()/1E3;Y=g.R(r);m=Y.next();case 5:if(m.done)return B.length?g.H(HY,ge1(B),10):HY.return([]);e=m.value;if(!e.downloadState){X=void 0;HY.R_(8);break}return g.H(HY,sB(M,e.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:X=
HY.N;case 8:I=X;J=void 0;S=(l=(J=e)==null?void 0:J.entityMetadata)&&l.nextAutoRefreshIntervalSeconds?Number(l.nextAutoRefreshIntervalSeconds):NaN;Q=Number.isNaN(S)?O:S;t=A=void 0;n=((A=I)==null?0:A.lastSyncedTimestampMillis)?Number((t=I)==null?void 0:t.lastSyncedTimestampMillis)/1E3:0;Z=V=void 0;rU=((V=I)==null?0:V.addedTimestampMillis)?Number((Z=I)==null?void 0:Z.addedTimestampMillis)/1E3:0;if(P||!l||n+Q<=k){fd=[];xK=void 0;if((xK=e.videos)==null?0:xK.length)for(BY=g.R(e.videos),eQ=BY.next();!eQ.done;eQ=
BY.next())PY=eQ.value,N2=JSON.parse(g.VH(PY).entityId),N2.videoId&&fd.push(N2.videoId);iV="0";l&&(wE=void 0,iV=String(Number((wE=l.offlineLastModifiedTimestampSeconds)!=null?wE:0).toFixed()));ZE={playlistId:e.playlistId,videoIds:fd,offlineLastModifiedTimestamp:iV,autoSync:f,offlineDateAddedTimestamp:String(rU.toFixed())};B.push(ZE)}m=Y.next();HY.R_(5);break;case 10:return sg=HY.N,HY.return(sg)}})},IW2=function(){var O,f,P,x,M;
return g.T(function(r){if(r.S==1)return g.H(r,Dy(),2);if(r.S!=3)return(O=r.N)?g.H(r,ii(O,"refresh"),3):r.return(!1);f=r.N;if((P=f[0])==null||!P.refreshTime)return r.return(!1);x=Number(f[0].refreshTime);M=Date.now()/1E3;return r.return(isFinite(x)&&M>=x)})},U5r=function(O,f){var P,x,M;
return g.T(function(r){switch(r.S){case 1:return g.oQ(r,2),g.H(r,JE9(O,f),4);case 4:return x=r.N,g.H(r,suQ(x),5);case 5:P=DoJ(x);g.YJ(r,3);break;case 2:M=g.mF(r),PJ("getAndProcessSmartDownloadsResponse request or processing error",M);case 3:return r.return(P)}})},qKT=function(O,f,P,x){var M,r,d,B,k,Y,m,e,X,I,J,l,S,Q,A,t,n,V,Z,rU,fd,xK,BY,eQ,PY,N2,iV,wE,ZE,sg;
return g.T(function(HY){switch(HY.S){case 1:return g.H(HY,Dy(),2);case 2:M=HY.N;if(!M)return HY.return([]);r=[];if((d=x)==null?0:d.length){r=x;HY.R_(3);break}return g.H(HY,ii(M,"musicPlaylist"),4);case 4:r=HY.N;case 3:if(!r.length)return HY.return([]);B=[];k=Date.now()/1E3;Y=g.R(r);m=Y.next();case 5:if(m.done)return B.length?g.H(HY,ge1(B),10):HY.return([]);e=m.value;X=void 0;J=(I=(X=e)==null?void 0:X.entityMetadata)&&I.nextAutoRefreshIntervalSeconds?Number(I.nextAutoRefreshIntervalSeconds):NaN;l=
Number.isNaN(J)?O:J;Q=S=0;A="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!e.downloadMetadata){HY.R_(8);break}return g.H(HY,sB(M,e.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:t=HY.N,V=n=void 0,S=Number((V=(n=t)==null?void 0:n.addedTimestampMillis)!=null?V:"0")/1E3,rU=Z=void 0,Q=Number((rU=(Z=t)==null?void 0:Z.lastModifiedTimestampMillis)!=null?rU:"0")/1E3,xK=fd=void 0,A=(xK=(fd=t)==null?void 0:fd.syncState)!=null?xK:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:BY=void 0;if(P||A!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!I||Number((BY=I.lastSyncedTimestampSeconds)!=null?BY:0)+l<=k){eQ=[];PY=void 0;if((PY=e.tracks)==null?0:PY.length)for(N2=g.R(e.tracks),iV=N2.next();!iV.done;iV=N2.next())wE=iV.value,eQ.push(g.VH(wE).entityId);ZE={playlistId:e.playlistId,videoIds:eQ,offlineLastModifiedTimestamp:String(Q.toFixed()),autoSync:f,offlineDateAddedTimestamp:String(S.toFixed())};B.push(ZE)}m=Y.next();HY.R_(5);break;case 10:return sg=HY.N,HY.return(sg)}})},JE9=function(O,f){var P,x,M,r,d,B,k,Y,m,e;
return g.T(function(X){switch(X.S){case 1:return P=g.at(),g.H(X,Dy(),2);case 2:x=X.N;if(!x){X.R_(3);break}return g.H(X,UoF(x),4);case 4:M=X.N;case 3:var I=M;r={context:g.s1(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:O},offlineClientState:I,clientStateRequestData:{preferredFormatType:f}}}};d=g.y7(LvF);g.oQ(X,5);k={Yq:!0};return g.H(X,g.je(P,r,d,void 0,k),7);case 7:B=X.N;g.YJ(X,6);break;case 5:Y=g.mF(X);if(Y instanceof g.hk)throw m=
"DPS network manager error for smart downloads: "+Y.message,PJ(m,Y),Error(m);PJ("DPS fetch request error for smart downloads",Y);throw Error("DPS fetch request error for smart downloads");case 6:e=Ai(B);if(B)e!==void 0&&Qy(e,"smart downloads");else throw PJ("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return X.return(B)}})},NYJ=function(O,f){var P,x,M,r,d,B,k,Y;
return g.T(function(m){switch(m.S){case 1:return P=g.at(),x={context:g.s1(),videoPlaybackPositionEntities:O,lastSyncTimestampUsec:f},M=g.y7(lWS),g.oQ(m,2),d={Yq:!0},g.H(m,g.je(P,x,M,void 0,d),4);case 4:r=m.N;g.YJ(m,3);break;case 2:B=g.mF(m);if(B instanceof g.hk)throw k="VPPS network manager error: "+B.message,PJ(k,B),Error(k);PJ("VPPS fetch request error",B);throw Error("VPPS fetch request error");case 3:Y=Ai(r);if(r)Y!==void 0&&Qy(Y,"position sync");else throw PJ("Network request failed for position sync"),
Error("Network request failed for position sync");return m.return(r)}})},uMr=function(O,f,P){var x,M,r,d,B,k,Y,m;
return g.T(function(e){switch(e.S){case 1:x=g.at();var X=P.refreshData,I=P.isEnqueuedForExpiredStreamUrlRefetch,J=P.Tw,l=P.offlineSourceData,S=P.mediaCapabilities,Q={entityKey:O};X&&(Q.refreshData=X);I&&(Q.isExpiredStreamUrlRefetch=I);J&&(Q.downloadParameters=J);l&&(Q.offlineSourceData=l);X={context:g.eq(f),signatureTimestamp:20408,videos:[Q]};S&&(X.mediaCapabilities=S);M=X;r=g.y7(SKQ);g.oQ(e,2);B={Yq:!0};return g.H(e,g.je(x,M,r,void 0,B),4);case 4:d=e.N;g.YJ(e,3);break;case 2:k=g.mF(e);if(k instanceof
g.hk)throw Y="GetPDE network manager error: "+k.message,PJ(Y,k),Error(Y);PJ("GetPDE fetch request error",k);throw Error("GetPDE fetch request error");case 3:m=Ai(d);if(d)m!==void 0&&Qy(m,"PDE");else throw PJ("Network request failed for PDE"),Error("Network request failed for PDE");return e.return(d)}})},Ai=function(O){var f;
return(f=O.errorMetadata)==null?void 0:f.status},Qy=function(O,f){f=f?" for "+f:"";
if(O===0)throw O="Empty response body"+f,PJ(O),Error(O);O="Response with error"+f;PJ(O);throw Error(O);},ge1=function(O){var f,P,x,M,r,d,B,k;
return g.T(function(Y){switch(Y.S){case 1:return f=g.at(),P=moQ(O),x=g.y7(Gm2),g.oQ(Y,2),r={Yq:!0},g.H(Y,g.je(f,P,x,void 0,r),4);case 4:M=Y.N;g.YJ(Y,3);break;case 2:d=g.mF(Y);if(d instanceof g.hk)throw B="offlinePlaylistSyncCheck network manager error: "+d.message,PJ(B,d),Error(B);PJ("offlinePlaylistSyncCheck fetch request error",d);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:k=Ai(M);if(!M)throw PJ("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(k!==void 0)Qy(k,"playlist sync");else if(!M.offlinePlaylistSyncCheckDatas||!M.offlinePlaylistSyncCheckDatas.length)throw PJ("No data for playlist sync"),Error("No data for playlist sync");return Y.return(M.offlinePlaylistSyncCheckDatas.map(function(m){return m.offlinePlaylistSyncCheckData}))}})},R6=function(O){this.S=O},CX1=function(O,f){var P,x,M,r,d,B;
return g.T(function(k){switch(k.S){case 1:P=new Map,x=g.R(f),M=x.next();case 2:if(M.done){k.R_(4);break}r=M.value;d=P;B=d.set;return g.H(k,O.N(r),5);case 5:B.call(d,r,k.N);M=x.next();k.R_(2);break;case 4:return k.return(P)}})},ti=function(O,f,P,x,M,r){f=g.vP(f,P);
x=Object.assign({},r,{priority:x,retryScheduleIntervalsInSeconds:M});return{actionType:O,entityKey:f,actionMetadata:x}},F$=function(O,f,P,x,M,r){this.status=O;
this.S=f;this.X=P;this.N=x;this.K=M;this.downloadState=r},b4S=function(O,f,P){this.S=O;
this.U=f;this.K=P},R9S=function(O,f){var P,x,M,r,d,B,k,Y,m;
return g.T(function(e){switch(e.S){case 1:return P=f.entityKey,M=(x=g.q(f.actionMetadata,nu))==null?void 0:x.isEnqueuedForExpiredStreamUrlRefetch,g.oQ(e,2),r=void 0,g.H(e,AEF(O,f),4);case 4:r=e.N;g.oQ(e,5);var X=(X=g.q(f.actionMetadata,nu))?{maximumDownloadQuality:X.maximumDownloadQuality}:void 0;return g.H(e,uMr(P,O.U,{isEnqueuedForExpiredStreamUrlRefetch:M,Tw:X,offlineSourceData:r}),7);case 7:d=e.N;g.YJ(e,6,2);break;case 5:return g.mF(e,2),B=BJ(f)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",PJ("PDE handleAdd error"),e.return(pu(f,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",B,"DOWNLOAD_STATE_FAILED"));case 6:return g.H(e,QsF(O,d,f),8);case 8:return e.return(pu(f,!0,d.orchestrationActions));case 2:return k=g.mF(e),Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",m="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",k instanceof g.gD&&k.type==="QUOTA_EXCEEDED"&&(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
m="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),PJ("PDE handleAdd error"),e.return(pu(f,!1,void 0,Y,m,"DOWNLOAD_STATE_FAILED"))}})},neF=function(O,f){var P,x,M,r,d,B,k,Y,m,e,X,I,J,l,S,Q,A,t,n,V,Z,rU,fd,xK;
return g.T(function(BY){switch(BY.S){case 1:return P=f.entityKey,x=g.VH(P).entityId,g.H(BY,KZ(O.S,{mode:"readonly",b1:!0},function(eQ){var PY=Zy(eQ,P,"playbackData"),N2=Zy(eQ,g.vP(x,"offlineVideoPolicy"),"offlineVideoPolicy");eQ=Zy(eQ,g.vP(x,"transfer"),"transfer");return g.lj.all([PY,N2,eQ])}),2);
case 2:M=BY.N;r=g.R(M);d=r.next().value;B=r.next().value;k=r.next().value;Y=d;m=B;e=k;if(!Y||!m)return BY.return(pu(f,!0));X=[];l=((J=Y)==null?0:J.playerResponseJson)?JSON.parse(Y.playerResponseJson):null;if(!(e&&l&&O.U.L("html5_refresh_deprecated_downloads"))){BY.R_(3);break}I=tmF(O,l,e);return g.H(BY,Fv4(O,e),4);case 4:X=BY.N;case 3:S={lastPlayerResponseTimestampSeconds:Y.playerResponseTimestamp,offlineToken:m.offlineToken,formatIds:X};Q={};if((A=e)==null?0:A.maximumDownloadQuality)Q.maximumDownloadQuality=
e.maximumDownloadQuality;g.oQ(BY,5);t=void 0;return g.H(BY,AEF(O,f),7);case 7:return t=BY.N,g.oQ(BY,8),g.H(BY,uMr(P,O.U,{refreshData:S,Tw:Q,offlineSourceData:t,mediaCapabilities:I}),10);case 10:n=BY.N;g.YJ(BY,9,5);break;case 8:return g.mF(BY,5),V=BJ(f)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",PJ("PDE handleRefresh error"),BY.return(pu(f,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",V,"DOWNLOAD_STATE_FAILED"));
case 9:return g.H(BY,QsF(O,n,f),11);case 11:return BY.return(pu(f,!0,n.orchestrationActions));case 5:return Z=g.mF(BY),rU="PDE handleRefresh error",Z instanceof Error&&(rU="PDE handleRefresh error: "+Z.message),fd="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",xK="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Z instanceof g.gD&&Z.type==="QUOTA_EXCEEDED"&&(fd="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",xK="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),PJ(rU),BY.return(pu(f,
!1,void 0,fd,xK,"DOWNLOAD_STATE_FAILED"))}})},AEF=function(O,f){var P,x,M,r;
return g.T(function(d){if(d.S==1)return P=g.VH(f.entityKey).entityId,x=g.vP(P,"videoDownloadContextEntity"),g.H(d,sB(O.S,x,"videoDownloadContextEntity"),2);M=d.N;return(r=M)!=null&&r.offlineModeType?d.return({offlineModeType:M.offlineModeType}):d.return(void 0)})},QsF=function(O,f,P){var x,M,r,d,B;
return g.T(function(k){if(k.S==1){if(!f.frameworkUpdates||!g.q(f.frameworkUpdates,NX))return k.return();if(!(g.q(f.frameworkUpdates,NX).mutations&&g.q(f.frameworkUpdates,NX).mutations.length>0&&g.q(f.frameworkUpdates,NX).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return k.R_(2);x=g.VH(g.q(f.frameworkUpdates,NX).mutations[0].entityKey).entityId;return g.H(k,S3(O.S,x),3)}if(k.S!=2){M=k.N;r=g.q(P.actionMetadata,nu);if(B=(d=r)==null?void 0:d.playlistId)M.playlistId=B;M.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.B3(O.U)?g.H(k,lB(x,O.S,P,O.K,M),2):g.jf(O.U)?g.H(k,uB(x,O.S,P,O.K),2):k.R_(2)}return g.H(k,P_Z(g.q(f.frameworkUpdates,NX)),0)})},pu=function(O,f,P,x,M,r){return new F$(f?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",BJ(O),P,x,M,r)},tmF=function(O,f,P){f=ZfT(O.U,P.cotn,f);
P=g.NQ(f);return g.BmJ(f,P,O.U)},Fv4=function(O,f){var P,x,M,r,d,B,k,Y,m,e,X;
return g.T(function(I){if(I.S==1)return P=[],g.H(I,KZ(O.S,{mode:"readonly",b1:!0},function(J){var l=[],S=f.offlineVideoStreams;if(S){S=g.R(S);for(var Q=S.next();!Q.done;Q=S.next())l.push(Zy(J,Q.value,"offlineVideoStreams"))}return g.lj.all(l)}),2);
if(x=I.N)for(M=g.R(x),r=M.next();!r.done;r=M.next())if(d=r.value,B=void 0,(B=d)==null?0:B.streamsProgress)for(k=d.streamsProgress,Y=0;Y<k.length;Y++)m=k[Y],e=JSON.parse(m.formatStreamBytes),X={itag:e.itag,lmt:e.lastModified,xtags:e.xtags},P.push(X);return I.return(P)})},p6F=function(O,f){this.S=O;
this.U=f},jsr=function(O,f){var P,x,M,r,d,B,k,Y,m,e,X,I;
return g.T(function(J){switch(J.S){case 1:return P=BJ(f),g.H(J,ii(O.S,"videoPlaybackPositionEntity"),2);case 2:x=J.N;if(x.length===0)return J.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));g.oQ(J,3);return g.H(J,WN.getInstance(),5);case 5:M=J.N;if(!M)throw Error("prefStorage is undefined");return g.H(J,M.get("psi"),6);case 6:return r=J.N,k=(B=(d=r)==null?void 0:d.WI)!=null?B:"0",g.H(J,NYJ(x,k),7);case 7:return Y=J.N,m={isPaused:Y.watchHistoryPaused,WI:Y.syncTimestampUsec},g.H(J,M.set("psi",
m),8);case 8:if(m.isPaused){J.R_(9);break}e=g.q(Y.frameworkUpdates,NX);if(!Y.frameworkUpdates||!e){J.R_(9);break}return g.H(J,P_Z(e),9);case 9:g.YJ(J,4);break;case 3:return X=g.mF(J),I="PPE handleRefresh error: "+(X instanceof Error?X.message:"unknown error"),PJ(I),J.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return J.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
P))}})},WvE=function(O,f){var P,x,M,r,d,B,k,Y;
return g.T(function(m){switch(m.S){case 1:return P=BJ(f),x=g.VH(f.entityKey).entityId,g.oQ(m,2),g.H(m,WN.getInstance(),4);case 4:M=m.N;if(!M)throw Error("prefStorage is undefined");return g.H(m,M.get("psi"),5);case 5:r=m.N;d=g.q(f.actionMetadata,H4S);if(((B=r)==null?void 0:B.isPaused)!==!1||(k=d)==null||!k.lastPlaybackPositionSeconds){m.R_(6);break}Y={key:g.vP(x,"videoPlaybackPositionEntity"),videoId:x,lastPlaybackPositionSeconds:d.lastPlaybackPositionSeconds};return g.H(m,aL(O.S,Y,"videoPlaybackPositionEntity"),
6);case 6:g.YJ(m,3);break;case 2:return g.mF(m),m.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return m.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P))}})},TYZ=function(O,f){var P,x,M;
return g.T(function(r){switch(r.S){case 1:P=BJ(f);g.oQ(r,2);x=g.VH(f.entityKey).entityId;if(x==="!*$_ALL_ENTITIES_!*$")return g.H(r,ijQ(O.S),5);M=g.vP(x,"videoPlaybackPositionEntity");return g.H(r,saZ(O.S,M),5);case 5:g.YJ(r,3);break;case 2:return g.mF(r),r.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return r.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
P))}})},$5E=function(O,f){this.api=O;
this.S=f;this.logger=new g.NB("woffle");this.N=!1;this.Pr={oY:this.oY}},Z44=function(O){return g.T(function(f){return f.return(oy1(O))})},cEE=function(O){var f;
return g.T(function(P){if(P.S==1)return g.H(P,g.UN0(O),2);f=P.N;return P.return(f.filter(function(x){return!!x.url}).map(function(x){return x.url}))})},j3=function(O,f){var P=g.zw(f);
if(P===1||P===0)return Promise.resolve();(P=VmS(O,f))&&P.stopVideo();O.K=0;return Z44(f)},HJ=function(O,f,P,x){P=P===void 0?!1:P;
x=x===void 0?!0:x;f=typeof f==="string"?f:f.videoDetails.videoId;if(g.zw(f)===2){var M=VmS(O,f);M&&M.stopVideo();g.hL(f,2);O.K=2;P?veF(O.S):x&&z91(O.S)}},VmS=function(O,f){var P;
return((P=O.player)==null?void 0:P.getVideoData().videoId)===f?O.player:null},h9J=function(O,f){this.S=O;
this.U=f},Kv4=function(O,f){var P,x;
return g.T(function(M){switch(M.S){case 1:return P=BJ(f),g.H(M,sB(O.S,f.entityKey,"transfer"),2);case 2:if(x=M.N)return M.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));g.oQ(M,3);return g.H(M,EeZ(O,f),5);case 5:g.YJ(M,4);break;case 3:return g.mF(M),M.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return M.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
P))}})},aWE=function(O,f){var P,x;
return g.T(function(M){switch(M.S){case 1:return P=BJ(f),g.H(M,sB(O.S,f.entityKey,"transfer"),2);case 2:x=M.N;if(!x||x.transferState!=="TRANSFER_STATE_COMPLETE")return M.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));g.oQ(M,3);return g.H(M,EeZ(O,f,!0),5);case 5:g.YJ(M,4);break;case 3:return g.mF(M),M.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return M.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P))}})},ssQ=function(O,f){var P,x,M,r,d,B,k,Y,m,e;
return g.T(function(X){switch(X.S){case 1:return P=BJ(f),x=g.VH(f.entityKey).entityId,g.H(X,KZ(O.S,{mode:"readonly",b1:!0},function(I){var J=Zy(I,f.entityKey,"transfer");I=Zy(I,g.vP(x,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.lj.all([J,I])}),2);
case 2:M=X.N;r=g.R(M);d=r.next().value;B=r.next().value;k=d;Y=B;if(!k||k.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return X.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));g.oQ(X,3);k.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.H(X,aL(O.S,k,"transfer"),5);case 5:m=g.VH(k.key).entityId;p_E({videoId:m,H$:k,offlineModeType:(e=Y)==null?void 0:e.offlineModeType});g.YJ(X,4);break;case 3:return g.mF(X),X.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
P,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return X.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P))}})},EeZ=function(O,f,P){P=P===void 0?!1:P;
var x,M,r,d,B,k,Y,m,e,X,I,J,l,S,Q;return g.T(function(A){switch(A.S){case 1:return x=g.q(f.actionMetadata,i4r),M=g.VH(f.entityKey).entityId,r=g.vP(M,"downloadStatusEntity"),g.H(A,KZ(O.S,{mode:"readonly",b1:!0},function(t){var n=Zy(t,r,"downloadStatusEntity");t=Zy(t,g.vP(M,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.lj.all([n,t])}),2);
case 2:return d=A.N,B=g.R(d),k=B.next().value,Y=B.next().value,m=k,e=Y,X="TRANSFER_STATE_TRANSFER_IN_QUEUE",((I=m)==null?void 0:I.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(X="TRANSFER_STATE_PAUSED_BY_USER"),S={key:f.entityKey,transferState:X,cotn:g.Xp(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(J=x)==null?void 0:J.maximumDownloadQuality,preferredAudioTrack:(l=x)==null?void 0:l.preferredAudioTrack,transferRetryCount:0,isRefresh:P,hasLoggedFirstStarted:!1},g.H(A,KZ(O.S,
{mode:"readwrite",b1:!0},function(t){var n=[];P&&n.push(zY(t,g.vP(M,"offlineVideoStreams")));n.push(vN(t,S,"transfer"));return g.lj.all(n)}),3);
case 3:if(!P){A.R_(4);break}return g.H(A,Z44(M),4);case 4:FWr({videoId:M,H$:S,offlineModeType:(Q=e)==null?void 0:Q.offlineModeType}),g.Br(A)}})},yEJ=function(O,f,P,x){if(!O.action.entityKey)throw Error("entityKey is missing.");
var M=g.VH(O.action.entityKey);M={entityType:M.F$,entityId:M.entityId,offlineOrchestrationActionType:O.action.actionType,orchestrationAction:{orchestrationActionId:O.actionId}};f&&(M.offlineOrchestrationActionResult=f.status,M.isRetryable=P?!1:f.S,f.K&&(M.offlineOrchestrationFailureReason=D5r(f.K,M.isRetryable)));var r,d;if((r=O.action.actionMetadata)==null?0:(d=r.offlineLoggingData)==null?0:d.offlineModeType)M.offlineModeType=O.action.actionMetadata.offlineLoggingData.offlineModeType;x&&(M.additionalOrchestrationActions=
x.map(function(B){return{orchestrationActionId:B.actionId}}));
return M},D5r=function(O,f){return O!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||f?O==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&f?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":O:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},OaS=function(O,f){var P={offlineOrchestrationContext:yEJ(O)};
f=I$T(f,P);J_J(X_F(),f,O.rootActionId)},f61=function(O,f,P,x){x=x===void 0?[]:x;
f={offlineOrchestrationContext:yEJ(O,f,P,x)};f=I$T(3,f);J_J(X_F(),f,O.rootActionId)},PsF=function(){this.actions=[]},xj2=function(O,f){f=g.R(f);
for(var P=f.next();!P.done;P=f.next())P=P.value,OaS(P,1),O.actions.push(P);O.actions.sort(O.S)},MXF=function(O,f){if(f)for(var P=0;P<O.actions.length;P++)if(f==="!*$_ALL_ENTITIES_!*$"&&O.actions[P].actionId!==f||f!=="!*$_ALL_ENTITIES_!*$"&&O.actions[P].rootActionId===f&&O.actions[P].actionId!==f)O.actions.splice(P,1),P--},rXQ=function(O,f){O=g.R(O.actions);
for(var P=O.next();!P.done;P=O.next())if(P.value.actionId===f)return!0;return!1},WJ=function(O,f,P,x,M){g.c.call(this);
var r=this;this.N=O;this.XU=f;this.S$=P;this.W=x;this.U=M;this.S=new PsF;this.C=new g.v7;this.K=new g.Dt(function(){r.retry()});
this.J=NaN;this.j=!1;this.Pr={m$p:function(){return r.S},
Lw:function(){return r.C},
Amu:function(){return r.K},
retry:function(){return r.retry()}};
g.v(this,this.K);this.e$=this.N.observe(this.nu.bind(this))},BJS=function(O,f,P,x,M){var r;
return g.T(function(d){if(d.S==1)return r=new WJ(O,f,P,x,M),g.H(d,djE(r),2);waF(r);return d.return(r)})},waF=function(O){var f=O.S.actions[0];
return O.X?((f==null?void 0:f.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&O.X[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(O.j=!0),Promise.resolve()):otS(O)},otS=function(O){var f,P,x,M,r,d,B,k,Y,m,e,X,I,J,l,S,Q;
return g.T(function(A){switch(A.S){case 1:if(O.X)throw Error("Already processing an action");if(O.zN())return A.return();f=O.S.actions.shift();RVF(O.S$,!f);if(f===void 0)return A.return();f.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&f.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&MXF(O.S,f.actionId);P="";f.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&f.rootActionId===f.actionId&&(P=f.actionId);x=[f];O.X=x;if(M=O.XU[f.entityType]){A.R_(2);break}O.X=
void 0;return g.H(A,otS(O),3);case 3:return A.return();case 2:r=g.R(x);for(d=r.next();!d.done;d=r.next())B=d.value,OaS(B,2);g.oQ(A,4,5);return g.H(A,CX1(M,x.map(function(t){return t.action})),7);
case 7:k=A.N,Y=g.R(x),m=Y.next();case 8:if(m.done){A.R_(10);break}e=m.value;X=k.get(e.action);return g.H(A,kMF(O,e,X),9);case 9:m=Y.next();A.R_(8);break;case 10:MXF(O.S,P);case 5:g.er(A);O.X=void 0;g.gE(A,6);break;case 4:return I=g.mF(A),PJ("Orchestration error",I),g.oQ(A,12),g.H(A,YL2(O,x),14);case 14:g.YJ(A,5);break;case 12:J=g.mF(A);PJ("Orchestration retry error",J);l=g.R(x);for(S=l.next();!S.done;S=l.next())Q=S.value,Q.retryScheduleIndex<3&&xj2(O.S,[Q]);A.R_(5);break;case 6:return g.H(A,otS(O),
0)}})},kMF=function(O,f,P){var x,M,r,d,B,k,Y,m,e,X,I,J;
return g.T(function(l){switch(l.S){case 1:x=f.retryScheduleIndex+2===3;if(P.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){l.R_(2);break}if(P.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){l.R_(0);break}f61(f,P,x);if(P.S&&f.retryScheduleIndex+1<3)return g.H(l,YL2(O,[f]),0);r=((M=P)==null?0:M.N)?P.N:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";d={entityKey:f.action.entityKey,failureReason:r};B=void 0;g.B3(O.U)?B="mainVideoDownloadStateEntity":g.jf(O.U)&&(B="musicTrackDownloadMetadataEntity");
if(!B||!P.downloadState){l.R_(7);break}k=g.VH(f.action.entityKey).entityId;return g.H(l,mV(k,B,O.N,P.downloadState),7);case 7:MX(O.W,d);if(P.downloadState==="DOWNLOAD_STATE_FAILED"&&O.U.L("html5_auto_retry_failed_pde_actions")){l.R_(0);break}PJ("Orchestration result is not retryable, deleting action");return g.H(l,saZ(O.N,U8(f).key),0);case 2:Y=void 0;try{Y=(m=P.X)==null?void 0:m.map(function(S){return O.createAction(S,f)})}catch(S){return f61(f,P,x),e={entityKey:f.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},MX(O.W,e),PJ("Orchestration subactions creation error",S),l.return()}f61(f,P,x,Y);if(!Y){l.R_(12);break}X=Y.map(function(S){return U8(S)});
I=0;case 13:if(!(I<Y.length)||O.j){l.R_(15);break}return g.H(l,KZ(O.N,{mode:"readwrite",b1:!0},function(S){var Q=[];Q.push($i4(S,X.slice(I,I+10),"offlineOrchestrationActionWrapperEntity"));return g.lj.all(Q)}),16);
case 16:I+=10;l.R_(13);break;case 15:if(O.j)return O.j=!1,l.return();case 12:return J=U8(f),g.H(l,saZ(O.N,J.key),17);case 17:OaS(f,4),g.Br(l)}})},XaF=function(O,f){var P,x,M,r,d,B,k,Y,m,e,X,I;
return g.T(function(J){P=[];x=Infinity;M=4E3;r=g.R(f);for(d=r.next();!d.done;d=r.next())B=d.value,k=Number(B.enqueueTimeSec),Y=mjS(k),m=B.retryScheduleIndex,e=m!=null&&m>0,Y>0&&e?(x=Math.min(x,k),M=Math.min(Y,M)):P.push(B);isFinite(x)&&(!O.K.isActive()||x<O.J)&&(O.J=x,O.K.start(M));O.C.h1()||(X=P.length,P=P.filter(function(l){var S;l=((S=l.actionProto)==null?void 0:S.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!ec2.includes(l)}),I=P.length<X,!O.K.isActive()&&I&&O.K.start(1));
P.length>0&&gt2(O,P);return g.H(J,waF(O),0)})},JXF=function(O){var f,P,x,M,r,d,B;
return g.T(function(k){if(k.S==1)return g.H(k,I6r(O),2);f=k.N;P=[];x=g.R(f);for(M=x.next();!M.done;M=x.next())r=M.value,d=g.VH(r.key),B=d.entityId,rXQ(O.S,B)||P.push(r);return g.H(k,XaF(O,P),0)})},mjS=function(O){O=O*1E3-Date.now();
return O>4E3?4E3:O},YL2=function(O,f){var P,x,M;
return g.T(function(r){P=g.R(f);for(x=P.next();!x.done;x=P.next()){M=x.value;var d=void 0,B=void 0,k=((B=M.action)==null?void 0:(d=B.actionMetadata)==null?void 0:d.retryScheduleIntervalsInSeconds)||[1,2,4];d=1;M.retryScheduleIndex<k.length&&(d=k[M.retryScheduleIndex]);M.S=d*1E3+Date.now();M.retryScheduleIndex++}return g.H(r,UjT(O,f),0)})},djE=function(O){var f;
return g.T(function(P){if(P.S==1)return g.H(P,ii(O.N,"offlineOrchestrationActionWrapperEntity"),2);f=P.N;return g.H(P,XaF(O,f),0)})},gt2=function(O,f){f.length!==0&&f.forEach(function(P){P=Ji(P);
P.retryScheduleIndex<3&&xj2(O.S,[P])})},I6r=function(O,f){var P;
return g.T(function(x){if(x.S==1)return g.H(x,ii(O.N,"offlineOrchestrationActionWrapperEntity",f),2);P=x.N;return x.return(P.filter(xoF))})},UjT=function(O,f){if(f.length===0)return Promise.resolve([]);
f=f.map(function(P){return U8(P)});
return aUF(O.N,f)},qLT=function(O){this.Ao=O;
this.S=void 0},L8J=function(O,f){var P,x,M,r;
return g.T(function(d){P=f.videoId;x=!0;if(f.captionTracks.length)M=QYF(f),O.S=new g.Jp(O.Ao,f,M);else if(f.Z4)r=g.tRR(f),O.S=new g.q4(O.Ao,f.Z4,P,r,f.u4,f.eventId),x=f.u4;else return d.return();return d.return(new Promise(function(B){var k;(k=O.S)==null||k.sH({Yt:function(){return g.T(function(Y){if(Y.S==1)return g.H(Y,O.Yt(P,x),2);B();g.Br(Y)})},
cF:function(){}})}))})},l6Q=function(O){var f;
return g.T(function(P){if(P.S==1)return g.H(P,BvS(O),2);f=P.N;return P.return(!!f&&f.length>0)})},T5=function(O){g.c.call(this);
this.S=O;this.N=this.S.observe(this.K.bind(this))},NJZ=function(O,f){var P,x,M,r,d,B,k;
return g.T(function(Y){switch(Y.S){case 1:if(f.length===0)return Y.return([]);P=f.map(function(m){return g.vP(m,"transfer")});
return g.H(Y,ii(O.S,"transfer",P),2);case 2:x=Y.N;M=x.filter(xoF).map(function(m){return g.VH(m.key).entityId});
r=f.filter(function(m){return M.indexOf(m)===-1});
if(r.length===0)return Y.return([]);d=g.R(r);B=d.next();case 3:if(B.done){Y.R_(5);break}k=B.value;return g.H(Y,Z44(k),4);case 4:B=d.next();Y.R_(3);break;case 5:return Y.return(r)}})},GMS=function(O,f,P,x,M,r){var d,B,k;
return g.T(function(Y){d="STREAM_TYPE_UNKNOWN";P.video&&P.audio?(d="STREAM_TYPE_AUDIO_AND_VIDEO",PJ("unexpected stream type")):P.video&&!P.audio?d="STREAM_TYPE_VIDEO":!P.video&&P.audio&&(d="STREAM_TYPE_AUDIO");B=g.vP(f,"offlineVideoStreams");k={numBytesDownloaded:M.toFixed(),numTotalBytes:r.toFixed(),streamType:d,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(x),itag:d==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(P.itag):void 0};return g.H(Y,KZ(O,{mode:"readwrite",b1:!0},
function(m){var e=Zy(m,B,"offlineVideoStreams"),X=Zy(m,g.vP(f,"transfer"),"transfer");return g.lj.all([e,X]).then(function(I){I=g.R(I);var J=I.next().value;I=I.next().value;if(!I)return zY(m,B).then(function(){});
var l=SL2(J);J=uu9(J,x,k,B);var S=vN(m,J,"offlineVideoStreams");SL2(J)>l&&(I.lastProgressTimeMs=Date.now().toString());l=[S];I.offlineVideoStreams||(I.offlineVideoStreams=[]);I.offlineVideoStreams.indexOf(B)===-1&&(I.offlineVideoStreams.push(B),l.push(vN(m,I,"transfer")));return g.lj.all(l)})}),0)})},CsQ=function(O,f){var P,x,M,r,d;
return g.T(function(B){if(B.S==1)return P=g.vP(f,"offlineVideoStreams"),g.H(B,sB(O,P,"offlineVideoStreams"),2);x=B.N;if(!x||!x.streamsProgress)return B.return();M=g.R(x.streamsProgress);for(r=M.next();!r.done;r=M.next())d=r.value,d.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",d.numTotalBytes!==d.numBytesDownloaded&&(d.numBytesDownloaded=d.numTotalBytes);return g.H(B,aL(O,x,"offlineVideoStreams"),0)})},uu9=function(O,f,P,x){if(O&&O.streamsProgress){x=O;
a:{f=f.itag+";"+f.xtags;for(var M=O.streamsProgress,r=0;r<M.length;r++){var d=JSON.parse(M[r].formatStreamBytes);if(d.itag+";"+d.xtags===f){M[r]=P;P=M;break a}}M.push(P);P=M}x.streamsProgress=P}else O={key:x,streamsProgress:[P]};return O},SL2=function(O){if(O==null?0:O.streamsProgress){var f=0;
O=O.streamsProgress;for(var P=0;P<O.length;P++){var x=O[P];isNaN(Number(x.numBytesDownloaded))?PJ("stream progress bytes number invalid"):f+=Number(x.numBytesDownloaded)}return f}return 0},baF=function(O,f,P,x){g.c.call(this);
var M=this;this.N=O;this.api=f;this.cB=P;this.nu=x;this.C=new g.v7;this.X=new g.Dt(function(){M.S&&M.S.transferState==="TRANSFER_STATE_TRANSFERRING"&&M.C.h1()&&((M.S.transferRetryCount||0)<3?HJ(M.W,M.j,!1,!1):j3(M.W,M.j.videoDetails.videoId),M.iB("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.S$=this.QA=0;this.e$=this.J=!1;this.BB=g.sN(this.api.B().experiments,"html5_transfer_processing_logs_interval");this.vB=new g.kN(this);this.Pr={Eau:function(){return M.X},
IEc:function(){return M.nu},
Lw:function(){return M.C}};
this.XU=this.N.observe(this.Kb.bind(this));this.W=new $5E(f,this);this.FU=new qLT(f);this.k5=new T5(this.N);this.GN=this.C.listen("publicytnetworkstatus-online",this.b6.bind(this));this.mp=this.C.listen("publicytnetworkstatus-offline",this.XYU.bind(this));this.e$=this.api.B().L("html5_less_transfer_processing_logs");g.v(this,this.vB);this.vB.Z(f,"offlinetransferpause",this.y5u);if(g.B3(this.api.B()))this.K="mainVideoDownloadStateEntity";else if(g.jf(this.api.B())||g.kI(this.api.B()))this.K="musicTrackDownloadMetadataEntity"},
AX4=function(O){return g.T(function(f){if(f.S==1)f=g.H(f,do9(),2);
else{var P=O.k5;var x=g.v3();x=Object.keys(x);P=NJZ(P,x);f=g.H(f,P,0)}return f})},Zf=function(O,f){f=f===void 0?!1:f;
var P;return g.T(function(x){if(x.S==1){if(O.S)throw Error("Already downloading a video");O.S$=0;O.J=!1;return g.H(x,Qn1(O),2)}return x.S!=4?(P=x.N,tM1(O.cB,!P),P&&O.C.h1()?f?g.H(x,new Promise(function(M){g.L6(M,1E3)}),4):x.R_(4):(!P&&O.S&&$4(O),x.R_(0))):g.H(x,RcZ(O,P),0)})},tXr=function(O){return g.T(function(f){if(f.S==1)return O.j?g.H(f,j3(O.W,O.j.videoDetails.videoId),3):f.R_(0);
$4(O);g.Br(f)})},F8r=function(O,f){var P,x,M;
return g.T(function(r){switch(r.S){case 1:return g.oQ(r,2),(P=!!f.captionTracks.length||!!f.Z4)?g.H(r,l6Q(f.videoId),4):r.return();case 4:return(x=r.N)?r.return():g.H(r,L8J(O.FU,f),5);case 5:g.YJ(r,0);break;case 2:M=g.mF(r),PJ("Caption downloading error",M,f.cotn),g.Br(r)}})},RcZ=function(O,f){var P,x,M,r,d,B;
return g.T(function(k){switch(k.S){case 1:if(O.J)return k.return();O.J=!0;O.S=f;P=g.VH(O.S.key);x=P.entityId;M=void 0;if(O.S.transferState==="TRANSFER_STATE_TRANSFERRING")return g.H(k,cJ(O,x),7);if(O.S.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||O.S.transferRetryCount||O.S.hasLoggedFirstStarted){k.R_(3);break}return g.H(k,cJ(O,x),5);case 5:return M=k.N,O.S.hasLoggedFirstStarted=!0,g.H(k,ntJ(O),6);case 6:nyT({videoId:x,H$:O.S,offlineModeType:M},void 0,void 0,!0);k.R_(3);break;case 7:M=k.N,
wt({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:x,H$:O.S,offlineModeType:M});case 3:return g.H(k,paF(O),8);case 8:return r=null,g.oQ(k,9),g.H(k,jnE(O,f),11);case 11:r=k.N;O.j=r;g.YJ(k,10);break;case 9:return d=g.mF(k),PJ("error getting player response",d,f.cotn),g.H(k,O.iB("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return k.return();case 10:return B=ZfT(O.api.B(),f.cotn,r),g.H(k,F8r(O,B),13);case 13:return g.H(k,cEE(B.videoId),
14);case 14:B.F6=k.N;var Y=O.W,m=B,e=f.maximumDownloadQuality;m.getPlayerResponse();g.hL(m.videoId,2);Y.K=2;Y.N=!1;var X;(X=Y.player)==null||X.dispose();Y.player=Y.api.Lc(m);m={};Y.player.GL((m.localmediachange=Y.Ci,m.signatureexpired=Y.AY,m.statechange=Y.GSl,m),Y);Y.L("html5_generate_content_po_token")&&Y.player.Qv();e=Y.oY(e);Y.player.oL(g.pA(e,e,!0,"m"),!1);Y.player.iR(!1);O.X.start(108E5);g.Br(k)}})},Qn1=function(O){var f,P;
return g.T(function(x){if(x.S==1)return g.H(x,ii(O.N,"transfer"),2);f=x.N;P=f.filter(Ha4).sort(W8E);return P.length===0?x.return():x.return(P[0])})},paF=function(O){var f,P,x;
return g.T(function(M){if(M.S==1){if(!O.S)return Vy(O,"onTransferStart"),M.return();O.X.start(108E5);return g.H(M,vJ(O,"TRANSFER_STATE_TRANSFERRING"),2)}f=O.S;return(x=((P=f)==null?0:P.key)?g.VH(f.key).entityId:"")&&O.K?g.H(M,mV(x,O.K,O.N,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):M.R_(0)})},veF=function(O){var f,P,x,M;
g.T(function(r){switch(r.S){case 1:if(!O.S){Vy(O,"onTransferPausedByUser");r.R_(2);break}f=O.S;O.X.stop();return g.H(r,vJ(O,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:x=((P=f)==null?0:P.key)?g.VH(f.key).entityId:"";if(!x||!O.K){r.R_(4);break}return g.H(r,mV(x,O.K,O.N,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.H(r,cJ(O,x),6);case 6:M=r.N,juF({videoId:x,H$:f,offlineModeType:M});case 2:$4(O),Zf(O),g.Br(r)}})},z91=function(O){var f,P,x;
g.T(function(M){if(M.S==1){if(!O.S)return Vy(O,"onTransferPausedByNetwork"),M.return();O.X.stop();return g.H(M,vJ(O,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(M.S!=3)return f=O.S,(x=((P=f)==null?0:P.key)?g.VH(f.key).entityId:"")&&O.K?g.H(M,mV(x,O.K,O.N,"DOWNLOAD_STATE_PAUSED"),3):M.R_(3);$4(O);g.Br(M)})},TJ9=function(O){var f,P,x,M,r;
g.T(function(d){switch(d.S){case 1:if(!O.S)return Vy(O,"onTransferComplete"),d.return();f=O.S;O.X.stop();if(!f||!O.j){d.R_(2);break}P=ZfT(O.api.B(),f.cotn,O.j);return g.H(d,F8r(O,P),2);case 2:return g.H(d,vJ(O,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:M=((x=f)==null?0:x.key)?g.VH(f.key).entityId:"";if(!M||!O.K){d.R_(5);break}return g.H(d,mV(M,O.K,O.N,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.H(d,CsQ(O.N,M),7);case 7:return g.H(d,cJ(O,M),8);case 8:r=d.N,wt({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:M,H$:f,offlineModeType:r}),$4(O),Zf(O),g.Br(d)}})},$jr=function(O,f,P){var x,M;
g.T(function(r){switch(r.S){case 1:if(!O.S)return Vy(O,"onTransferProgress: "+f),r.return();if(O.S.transferState==="TRANSFER_STATE_TRANSFERRING"){r.R_(2);break}return g.H(r,paF(O),2);case 2:x=Date.now();if(!(x-O.QA>1E3)){r.R_(4);break}O.QA=x;return g.H(r,GMS(O.N,P.videoId,P.N,P.bf,P.bytesDownloaded,P.S),5);case 5:if(O.e$&&!(O.e$&&x-O.S$>O.BB)){r.R_(4);break}O.S$=x;return g.H(r,cJ(O,f),7);case 7:M=r.N,nyT({videoId:f,H$:O.S,offlineModeType:M},P.bytesDownloaded,P.S);case 4:O.X.start(108E5),g.Br(r)}})},
ZaE=function(O){var f=(O.S.transferRetryCount||0)<3;
f&&(O=O.S,O.transferRetryCount=(O.transferRetryCount||0)+1);return f},cXQ=function(O,f){f=f===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":f;
var P,x,M,r;return g.T(function(d){if(d.S==1)return O.S||Vy(O,"setTransferToFailed: "+f),P="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",f==="TRANSFER_FAILURE_REASON_NETWORK"?P="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":f==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(P="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.H(d,vJ(O,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",f),2);if(d.S!=3)return MX(O.nu,{entityKey:(x=O.S)==null?void 0:x.key,failureReason:P}),
M=O.S?g.VH(O.S.key).entityId:"",g.H(d,cJ(O,M),3);r=d.N;var B={videoId:M,H$:O.S,offlineModeType:r},k=f,Y={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};k&&(Y.transferFailureReason=k,Y.failureReason=Hf4(k));wt(Y,B);g.Br(d)})},vJ=function(O,f,P,x){var M;
return g.T(function(r){if(r.S==1){if(!O.S)return Vy(O,"saveTransferState: "+f),r.return();O.S.transferState=f;O.S.failureReason=x;g.oQ(r,2);return g.H(r,ntJ(O,function(d){return P?cN(d,"offlineVideoStreams",O.S.offlineVideoStreams).then(function(B){for(var k=g.R(B),Y=k.next();!Y.done;Y=k.next())if((Y=Y.value)&&Y.streamsProgress){Y=g.R(Y.streamsProgress);for(var m=Y.next();!m.done;m=Y.next())m.value.streamState=P}return $i4(d,B.filter(function(e){return!!e}),"offlineVideoStreams")}):g.lj.resolve(void 0)}),
4)}if(r.S!=2)return g.YJ(r,0);
M=g.mF(r);return M instanceof g.gD&&M.type==="QUOTA_EXCEEDED"?g.H(r,O.iB("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):r.R_(0)})},ntJ=function(O,f){var P;
return g.T(function(x){if(!O.S)return x.return();P=O.S;return g.H(x,KZ(O.N,{mode:"readwrite",b1:!0},function(M){var r=[vN(M,P,"transfer")];f&&r.push(f(M));return g.lj.all(r)}),0)})},$4=function(O){O.S=void 0;
O.j=void 0;O.X.stop()},jnE=function(O,f){var P,x,M,r,d;
return g.T(function(B){if(B.S==1)return P=g.VH(f.key),x=P.entityId,M=g.vP(x,"playbackData"),g.H(B,sB(O.N,M,"playbackData"),2);r=B.N;if((d=r)==null?0:d.playerResponseJson)return B.return(JSON.parse(r.playerResponseJson));throw Error("No PlayerResponse found");})},Vy=function(O,f){O.api.Nc("woffle",{mcte:f});
PJ("missing current transfer entity.")},cJ=function(O,f){var P,x,M;
return g.T(function(r){if(r.S==1)return g.H(r,sB(O.N,g.vP(f,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);P=r.N;return r.return((M=(x=P)==null?void 0:x.offlineModeType)!=null?M:void 0)})},Ha4=function(O){return VXJ[O.transferState]!==void 0},W8E=function(O,f){var P=VXJ[O.transferState],x=VXJ[f.transferState];
return P!==x?P-x:Number(O.enqueuedTimestampMs)-Number(f.enqueuedTimestampMs)},z5=function(O,f){var P=this;
this.U=O;this.api=f;this.C=new g.v7;this.j=new g.mo;this.Pr={QT:function(){return P.K.Pr.QT()},
Lw:function(){return P.C},
k1o:function(){return P.K},
nH:function(){return P.nH()},
VO:function(){return P.VO()},
MS:function(){return P.MS()},
yO:function(){return P.yO()},
n8:function(){return P.n8()},
je:function(x){return P.je(x)}};
this.K=new bf4(function(){return vtQ(P)},function(){P.MS()},this.api.O3(),this.api.L.bind(this.api));
this.S=new x4(this.api);A_E(this.K)},vtQ=function(O){return g.T(function(f){O.api.PB("onOrchestrationBecameLeader");
return g.H(f,O.VO(),0)})},hc9=function(O){var f,P;
return g.T(function(x){if(x.S==1)return g.H(x,Dy(),2);if(x.S!=3){f=x.N;if(!f)return PJ("PES is undefined"),x.return();O.N=new baF(f,O.api,O.K,O.S);P=O.UQ(f);return g.H(x,BJS(f,P,O.K,O.S,O.U),3)}O.W=x.N;return g.H(x,zcF(O),0)})},zcF=function(O){var f;
return g.T(function(P){switch(P.S){case 1:if(!O.N)return PJ("transferManager is undefined"),P.return();if(O.N.S){P.R_(2);break}return g.H(P,Zf(O.N),2);case 2:if(!O.U.L("woffle_enable_main_downloads_library")){P.R_(4);break}return g.H(P,O.im(),4);case 4:if(!O.U.L("html5_offline_playback_position_sync")){P.R_(6);break}return g.H(P,O.HK(),7);case 7:return g.H(P,O.je(864E5),6);case 6:return g.H(P,O.refreshAllStaleEntities(43200,!0),9);case 9:return g.H(P,O.bD(),10);case 10:if(!O.U.L("html5_retry_downloads_for_expiration")){P.R_(11);
break}return g.H(P,O.n8(),11);case 11:return O.J=g.l2(function(){O.refreshAllStaleEntities(43200,!0);O.bD()},9E5),g.ya(g.fn(),function(){return O.yO()}),g.H(P,Dy(),13);
case 13:return f=P.N,g.H(P,C_2(f),14);case 14:Qu2(O.K),g.Br(P)}})},Et2=function(){var O,f,P,x,M,r;
return g.T(function(d){switch(d.S){case 1:return g.H(d,Dy(),2);case 2:O=d.N;if(!O)return d.return([]);f=Date.now()/1E3;return g.H(d,ii(O,"offlineVideoPolicy"),3);case 3:P=d.N,x=g.R(P),M=x.next();case 4:if(M.done){d.R_(6);break}r=M.value;if(!(r.expirationTimestamp&&Number(r.expirationTimestamp)<f)){d.R_(5);break}r.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";r.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.H(d,aL(O,r,"offlineVideoPolicy"),5);
case 5:M=x.next();d.R_(4);break;case 6:return d.return(P.map(function(B){return B.key}))}})},hi=function(O,f,P,x,M){var r,d,B;
return g.T(function(k){if(k.S==1)return g.H(k,Dy(),2);r=k.N;if(!r)return k.return([]);d=f.map(function(Y){var m=g.vP(Y,P);m={actionType:x,entityKey:m,actionMetadata:Object.assign({},c_r(),M)};x!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(m.actionMetadata.priority=0);Y=new I6(P,Y,m);return U8(Y)});
B=aUF(r,d);A_E(O.K);return k.return(B)})},K8T=function(O,f,P,x){var M,r,d,B,k,Y,m,e;
return g.T(function(X){switch(X.S){case 1:M=[],r=g.R(f),d=r.next();case 2:if(d.done){X.R_(4);break}B=d.value;if(B.upToDate||P&&!B.shouldAutoSyncMetadata||!B.playlistId){X.R_(3);break}k={};switch(x){case "mainPlaylistEntity":Y={nextAutoRefreshIntervalSeconds:B.checkInSeconds,autoSync:P};k={mainPlaylistEntityActionMetadata:Y};break;case "musicPlaylist":m={autoSync:P},k={musicPlaylistEntityActionMetadata:m}}return g.H(X,hi(O,[B.playlistId],x,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",k),6);case 6:(e=
X.N)&&M.push.apply(M,g.F(e));case 3:d=r.next();X.R_(2);break;case 4:return X.return(M)}})},a6T=function(O,f){var P;
return g.T(function(x){return f.length?(P=c_r(),g.pg(P,nu,{isEnqueuedForExpiredStreamUrlRefetch:!0}),O.api.Nc("qrd",{v:f.length}),x.return(hi(O,f,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",P))):x.return([])})},snQ=function(O,f,P){this.S=O;
this.U=f;this.K=P},yXF=function(O,f){var P,x,M,r,d,B,k,Y,m,e,X,I,J,l,S,Q,A;
return g.T(function(t){switch(t.S){case 1:return P=BJ(f),x=g.VH(f.entityKey),M=x.entityId,r=[],g.oQ(t,2),g.H(t,iaE(O,M),4);case 4:r=t.N;if(!(O.U.L("woffle_enable_main_downloads_library")&&((d=r)==null?0:d.length))){t.R_(5);break}return g.H(t,fWF(O.S,[f.entityKey]),5);case 5:g.YJ(t,3);break;case 2:return B=g.mF(t),k="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",B instanceof g.gD&&B.type==="QUOTA_EXCEEDED"?(k="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):PJ("Playlist add error"),t.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,k,Y));case 3:m=[];if(!O.U.L("html5_offline_prevent_redownload_downloaded_video")){t.R_(7);break}return g.H(t,$oS(O.S,"mainVideoEntity",r),8);case 8:r=t.N;case 7:if((e=r)==null?0:e.length)for(X=g.R(r),I=X.next();!I.done;I=X.next())if(J=I.value,l=J.offlineVideoData,S=void 0,(S=l)==null?0:S.videoId)Q=void 0,A=Number(((Q=f.actionMetadata)==null?void 0:Q.priority)||
0)+1,m.push(ti("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",l.videoId,"mainVideoEntity",A,E8,DjJ(f,l,M)));return t.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,m))}})},fDT=function(O,f){var P,x,M,r,d,B,k,Y,m,e,X,I,J,l,S,Q,A,t,n,V,Z,rU,fd,xK,BY,eQ,PY,N2,iV,wE,ZE,sg,HY,aQ,tZ,b,D2,ET,oT,Q2,u,Og,la,BX,KB,og,DE,Pr,CB,C,N,G,p,E,wU,a,z,W,tK,F0,q2,QJ,MF,bV,cX,pB,sT,RT,Vu,nd,NF,cY,uQ,u4;
return g.T(function(y2){switch(y2.S){case 1:return P=BJ(f),x=f.entityKey,M=g.VH(x).entityId,r=[],d=!1,M==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.H(y2,ii(O.S,"mainPlaylistEntity"),5)):g.H(y2,sB(O.S,x,"mainPlaylistEntity"),4);case 4:(B=y2.N)&&r.push(B);y2.R_(3);break;case 5:r=y2.N;case 3:if((k=r)==null||!k.length)return y2.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));Y=g.q(f.actionMetadata,OpF);e=(m=Y)==null?void 0:m.nextAutoRefreshIntervalSeconds;I=(X=Y)==null?void 0:X.autoSync;J=[];S=l=
!0;Q=!1;if(!d&&I===!1){y2.R_(6);break}g.oQ(y2,7);return g.H(y2,X6F(0,!!I,!0,r),9);case 9:J=y2.N;g.YJ(y2,8);break;case 7:A=g.mF(y2);if(!(A instanceof Error&&A.message==="No data")){A instanceof Error&&A.message==="Empty response body"&&PJ(A.message);y2.R_(8);break}return M==="!*$_ALL_ENTITIES_!*$"?g.H(y2,a$F(O.S,f,O.K,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.H(y2,EyJ(M,O.S,f,O.K),8);case 8:if(!J.length||!d&&J[0].playlistId!==M)return y2.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
P));case 6:if(d){t=[];n=g.R(J);for(V=n.next();!V.done;V=n.next())Z=V.value,Z.upToDate||I&&!Z.shouldAutoSyncMetadata||!Z.playlistId||(rU={nextAutoRefreshIntervalSeconds:Z.checkInSeconds,autoSync:I},t.push(ti("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Z.playlistId,"mainPlaylistEntity",0,E8,{mainPlaylistEntityActionMetadata:rU})));return y2.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,t))}J.length&&(fd=J[0],Q=!!fd.upToDate,I&&(l=(xK=fd.shouldAutoSyncMetadata)!=null?xK:!0,S=(BY=fd.shouldAutoSyncVideos)!=
null?BY:!0,fd.checkInSeconds&&(e=fd.checkInSeconds)));if(Q||!l)return y2.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));eQ=[];PY=r[0];if(!PY.downloadState){N2=void 0;y2.R_(15);break}return g.H(y2,sB(O.S,PY.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:N2=y2.N;case 15:return iV=N2,ZE=((wE=iV)==null?0:wE.addedTimestampMillis)?String(iV.addedTimestampMillis):void 0,g.oQ(y2,17),g.H(y2,iaE(O,M,ZE,e),19);case 19:eQ=y2.N;g.YJ(y2,18);break;case 17:sg=g.mF(y2);if(!(sg instanceof
Error&&sg.message==="No data for playlist")){if(sg instanceof Error&&sg.message==="Empty response body for playlist")PJ(sg.message);else return HY="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",aQ="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",sg instanceof g.gD&&sg.type==="QUOTA_EXCEEDED"&&(HY="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",aQ="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),y2.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,HY,aQ));
y2.R_(18);break}return g.H(y2,EyJ(M,O.S,f,O.K),18);case 18:if(!S)return y2.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));tZ=[];b=new Map;if((D2=eQ)==null?0:D2.length)for(ET=g.R(eQ),oT=ET.next();!oT.done;oT=ET.next())Q2=oT.value,u=Q2.offlineVideoData,Og=void 0,((Og=u)==null?0:Og.videoId)&&b.set(u.videoId,u);la=new Map;BX=[];if((KB=PY)==null?0:(og=KB.videos)==null?0:og.length)for(DE=g.R(PY.videos),Pr=DE.next();!Pr.done;Pr=DE.next())if(CB=Pr.value,C=JSON.parse(g.VH(CB).entityId),N=
C.videoId)b.has(N)?(la.set(N,b.get(N)),b.delete(N)):BX.push(N);p=Number(((G=f.actionMetadata)==null?void 0:G.priority)||0)+1;E=g.R(b.entries());for(wU=E.next();!wU.done;wU=E.next())a=wU.value,z=g.R(a),W=z.next().value,tK=z.next().value,F0=W,q2=tK,tZ.push(ti("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",F0,"mainVideoEntity",p,E8,DjJ(f,q2,M)));QJ=g.R(la.entries());for(MF=QJ.next();!MF.done;MF=QJ.next())bV=MF.value,cX=g.R(bV),pB=cX.next().value,sT=cX.next().value,RT=pB,Vu=sT,tZ.push(ti("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
RT,"mainVideoEntity",p,E8,DjJ(f,Vu,M)));nd=g.R(BX);for(NF=nd.next();!NF.done;NF=nd.next())cY=NF.value,uQ={playlistId:M},u4={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:uQ},tZ.push(ti("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",cY,"mainVideoEntity",0,E8,u4));return y2.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,tZ))}})},PIQ=function(O,f){var P,x,M,r;
return g.T(function(d){switch(d.S){case 1:return P=BJ(f),g.oQ(d,2),x=g.VH(f.entityKey).entityId,x==="!*$_ALL_ENTITIES_!*$"?g.H(d,a$F(O.S,f,O.K,(M=f.actionMetadata)==null?void 0:(r=M.offlineLoggingData)==null?void 0:r.offlineDeleteReason),5):g.H(d,EyJ(x,O.S,f,O.K),6);case 6:if(!O.U.L("woffle_enable_main_downloads_library")){d.R_(5);break}return g.H(d,PXT(O.S,f.entityKey),5);case 5:g.YJ(d,3);break;case 2:return g.mF(d),d.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return d.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P))}})},iaE=function(O,f,P,x){var M,r,d,B,k,Y,m;
return g.T(function(e){switch(e.S){case 1:return g.H(e,e9S([f]),2);case 2:return M=e.N,g.H(e,xY9(O,M[0],P,x),3);case 3:return r=e.N,d=r.mainPlaylistEntity,B=r.kmA,Y=zVF(d,(k=B)==null?void 0:k.avatar),g.oQ(e,4),g.H(e,Lu(Y),6);case 6:g.YJ(e,5);break;case 4:m=g.mF(e),m instanceof Error&&m.message==="Failed to fetch"&&PJ(m.message);case 5:return e.return(M[0].videos)}})},xY9=function(O,f,P,x){var M,r,d,B,k,Y,m,e,X,I,J,l,S,Q,A,t,n;
return g.T(function(V){switch(V.S){case 1:M=Date.now().toString();P||(P=M);r=f.videos;d=f.playlistId;B=[];k=[];if(r)for(Y=g.R(r),m=Y.next();!m.done;m=Y.next()){e=m.value;X=e.offlineVideoData;if(!X||!X.videoId)throw PJ("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");I=X.videoId;J={videoId:I,playlistId:d};l={id:g.vP(JSON.stringify(J),"mainPlaylistVideoEntity"),video:g.vP(I,"mainVideoEntity")};B.push(l);k.push(l.id)}Q={key:g.vP(d,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:P,lastSyncedTimestampMillis:M};A={key:g.vP(d,"mainPlaylistEntity"),playlistId:d,videos:k,title:f.title,thumbnailStyleData:MGF(f),visibility:rQr(f),downloadState:Q.key};f.channel&&(t=f.channel.offlineChannelData,S=dYF(g.vP(d,"ytMainChannelEntity"),t),A.channelOwner=S.id);((n=A)==null?0:n.entityMetadata)?(A.entityMetadata.offlineLastModifiedTimestampSeconds=f.lastModifiedTimestamp,x&&(A.entityMetadata.nextAutoRefreshIntervalSeconds=String(x))):A&&(A.entityMetadata={nextAutoRefreshIntervalSeconds:x?
String(x):void 0,offlineLastModifiedTimestampSeconds:f.lastModifiedTimestamp});g.oQ(V,2);return g.H(V,KZ(O.S,{mode:"readwrite",b1:!0},function(Z){var rU=vN(Z,A,"mainPlaylistEntity"),fd=vN(Z,Q,"mainPlaylistDownloadStateEntity");rU=[rU,fd];fd=g.R(B);for(var xK=fd.next();!xK.done;xK=fd.next())rU.push(vN(Z,xK.value,"mainPlaylistVideoEntity"));S&&rU.push(vN(Z,S,"ytMainChannelEntity"));return g.lj.all(rU)}),4);
case 4:g.YJ(V,3);break;case 2:throw g.mF(V),PJ("PES failure for playlist"),Error("PES failure for playlist");case 3:return V.return({mainPlaylistEntity:A,kmA:S,Fzd:B})}})},dYF=function(O,f){return{id:O,
channelId:f.channelId,title:f.title,avatar:f.thumbnail}},MGF=function(O){var f=[],P=O.videos;
P&&P.length>0&&f.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:P[0].offlineVideoData.thumbnail}}});if((O=O.additionalMetadadatas)&&O.length>0)for(O=g.R(O),P=O.next();!P.done;P=O.next()){var x=P.value.offlineBundleItemPlaylistData,M=void 0;P=(M=x)==null?void 0:M.style;M=void 0;x={collageThumbnail:{coverThumbnail:(M=x)==null?void 0:M.coverThumbnail}};switch(P){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":f.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:x});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":f.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:x});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":f.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:x});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":f.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:x})}}return f},rQr=function(O){switch(O.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},DjJ=function(O,f,P){f={offlineVideoData:f,
playlistId:P};if(O=g.q(O.actionMetadata,OpF))f.maximumDownloadQuality=O.maximumDownloadQuality;return{mainVideoEntityActionMetadata:f}},wzE=function(O,f,P){this.S=O;
this.U=f;this.K=P},kT9=function(O,f){var P,x,M,r,d,B,k,Y,m,e,X,I,J;
return g.T(function(l){switch(l.S){case 1:return P=BJ(f),x=g.VH(f.entityKey),M=x.entityId,r=g.q(f.actionMetadata,Ku),B=!((d=r)==null?0:d.playlistId),g.oQ(l,2),g.H(l,Bl2(O,M,void 0,(k=r)==null?void 0:k.offlineVideoData,B),4);case 4:g.YJ(l,3);break;case 2:return Y=g.mF(l),m="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Y instanceof g.gD&&Y.type==="QUOTA_EXCEEDED"&&(m="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
l.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,m,e));case 3:X=1;X=Number(((I=f.actionMetadata)==null?void 0:I.priority)||0)+1;var S=(S=g.q(f.actionMetadata,Ku))?{playbackDataActionMetadata:{maximumDownloadQuality:S.maximumDownloadQuality}}:void 0;J=ti("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",M,"playbackData",X,o22,S);return l.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,[J]))}})},YwF=function(O,f){var P,x,M,r,d,B,k,Y,m,e,X,I,J,l,S,Q,A;
return g.T(function(t){switch(t.S){case 1:return P=BJ(f),x=g.VH(f.entityKey),M=x.entityId,g.H(t,sB(O.S,f.entityKey,"mainVideoEntity"),2);case 2:r=t.N;if(!r){d=void 0;t.R_(3);break}return g.H(t,sB(O.S,r.downloadState,"mainVideoDownloadStateEntity"),4);case 4:d=t.N;case 3:B=d;if(!r||!B)return t.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));g.oQ(t,5);return g.H(t,Bl2(O,M,B.addedTimestampMillis,(Y=g.q(f.actionMetadata,Ku))==null?void 0:Y.offlineVideoData),7);case 7:m=1;m=Number(((e=
f.actionMetadata)==null?void 0:e.priority)||0)+1;k=ti("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",M,"playbackData",m,o22);g.YJ(t,6);break;case 5:X=g.mF(t);if(!(X instanceof Error&&X.message==="No data")){if(X instanceof Error&&X.message==="Empty response body")PJ(X.message);else return I="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.gD&&X.type==="QUOTA_EXCEEDED"&&(I="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
J="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),t.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,I,J));t.R_(6);break}return g.H(t,S3(O.S,M),9);case 9:l=t.N;S=g.q(f.actionMetadata,Ku);if(A=(Q=S)==null?void 0:Q.playlistId)l.playlistId=A;l.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.H(t,lB(M,O.S,f,O.K,l),6);case 6:return t.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,k?[k]:void 0))}})},mYT=function(O,f){var P,x,M,r,d,B,k,Y,m,e;
return g.T(function(X){switch(X.S){case 1:return P=BJ(f),g.oQ(X,2),x=g.VH(f.entityKey).entityId,x==="!*$_ALL_ENTITIES_!*$"?g.H(X,a$F(O.S,f,O.K,(m=f.actionMetadata)==null?void 0:(e=m.offlineLoggingData)==null?void 0:e.offlineDeleteReason),5):g.H(X,S3(O.S,x),6);case 6:M=X.N;r=g.q(f.actionMetadata,Ku);if(B=(d=r)==null?void 0:d.playlistId)M.playlistId=B;M.offlineDeleteReason=(k=f.actionMetadata)==null?void 0:(Y=k.offlineLoggingData)==null?void 0:Y.offlineDeleteReason;return g.H(X,lB(x,O.S,f,O.K,M),7);
case 7:if(!O.U.L("woffle_enable_main_downloads_library")){X.R_(5);break}return g.H(X,PXT(O.S,f.entityKey),5);case 5:g.YJ(X,3);break;case 2:return g.mF(X),X.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return X.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P))}})},Bl2=function(O,f,P,x,M){var r,d,B,k,Y,m;
return g.T(function(e){switch(e.S){case 1:if(r=x){e.R_(2);break}return g.H(e,m52([f]),3);case 3:d=e.N,r=d[0];case 2:return g.H(e,eNS(O,r,P,M),4);case 4:B=e.N;k=B.mainVideoEntity;Y=B.channelEntity;g.oQ(e,5);var X=X$(k.thumbnail),I=X$(Y.avatar);return g.H(e,Lu(X.concat(I)),7);case 7:g.YJ(e,0);break;case 5:m=g.mF(e),m instanceof Error&&m.message==="Failed to fetch"&&PJ(m.message),g.Br(e)}})},eNS=function(O,f,P,x){var M,r,d,B,k,Y,m,e,X,I,J,l,S;
return g.T(function(Q){switch(Q.S){case 1:P||(P=Date.now().toString());r=(M=f.channel)==null?void 0:M.offlineChannelData;d={id:g.vP(f.videoId,"ytMainChannelEntity"),channelId:r.channelId,title:r.title,avatar:r.thumbnail};B={key:g.vP(f.videoId,"mainVideoDownloadStateEntity"),playbackData:g.vP(f.videoId,"playbackData"),addedTimestampMillis:P,videoDownloadContextEntity:g.vP(f.videoId,"videoDownloadContextEntity")};k={key:g.vP(f.videoId,"videoPlaybackPositionEntity"),videoId:f.videoId,lastPlaybackPositionSeconds:"0"};
O.U.L("html5_offline_playback_position_sync")&&(Y={playbackPosition:k.key});m=g.vP(f.videoId,"mainVideoEntity");e={key:m,videoId:f.videoId,title:f.title,thumbnail:f.thumbnail,localizedStrings:{viewCount:f.shortViewCountText},userState:Y,lengthSeconds:f.lengthSeconds?Number(f.lengthSeconds):void 0,publishedTimestampMillis:f.publishedTimestamp?(Number(f.publishedTimestamp)*1E3).toString():void 0,formattedDescription:f.description,owner:d.id,downloadState:B.key};if(!O.U.L("woffle_enable_main_downloads_library")||
!x){Q.R_(2);break}return g.H(Q,O4Q(O.S,[m]),3);case 3:if(J=Q.N)X=J.mainDownloadsLibraryEntity,I=J.mainDownloadsListEntity;case 2:return S=Tv4,l={key:g.vP(f.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.pg(B,S,l),g.H(Q,KZ(O.S,{mode:"readwrite",b1:!0},function(A){var t=vN(A,d,"ytMainChannelEntity"),n=vN(A,B,"mainVideoDownloadStateEntity"),V=vN(A,e,"mainVideoEntity");t=[t,n,V];O.U.L("html5_offline_playback_position_sync")&&(n=vN(A,k,"videoPlaybackPositionEntity"),
t.push(n));X&&(n=vN(A,X,"mainDownloadsLibraryEntity"),t.push(n));I&&(n=vN(A,I,"mainDownloadsListEntity"),t.push(n));l&&(A=vN(A,l,"downloadStatusEntity"),t.push(A));return g.lj.all(t)}),4);
case 4:return Q.return({mainVideoEntity:e,channelEntity:d})}})},g22=function(O,f,P){this.S=O;
this.U=f;this.K=P},ID1=function(O,f){var P,x,M,r,d,B,k,Y,m,e,X,I,J,l,S,Q,A,t,n,V,Z,rU,fd,xK,BY,eQ,PY;
return g.T(function(N2){switch(N2.S){case 1:return P=BJ(f),x=[],g.H(N2,WN.getInstance(),2);case 2:M=N2.N;if(!M){N2.R_(3);break}return g.H(N2,M.get("sdois"),4);case 4:return r=N2.N,g.H(N2,(B=M)==null?void 0:B.get("lmqf"),5);case 5:d=N2.N;case 3:g.oQ(N2,6);if(r===void 0)throw Error("prefStorage or opt-in state is undefined");k=[];if(r){N2.R_(8);break}return g.H(N2,y_E(O.S),9);case 9:k=N2.N,k.reverse();case 8:if(!k.length){N2.R_(10);break}Y=g.R(k);m=Y.next();case 11:if(m.done){N2.R_(10);break}e=m.value;
if(!e){N2.R_(12);break}X=g.VH(e).entityId;return g.H(N2,S3(O.S,X),14);case 14:return I=N2.N,I.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.H(N2,lB(X,O.S,{entityKey:e,actionType:f.actionType},O.K,I),12);case 12:m=Y.next();N2.R_(11);break;case 10:return g.H(N2,JE9(r,(J=d)!=null?J:"SD"),16);case 16:return l=N2.N,g.H(N2,suQ(l),17);case 17:S=DoJ(l);if(!O.U.L("woffle_enable_main_downloads_library")){N2.R_(18);break}if(r){N2.R_(19);break}return g.H(N2,PXT(O.S,g.pQ),19);case 19:return g.H(N2,
fWF(O.S,[g.pQ]),18);case 18:if((Q=S)==null?0:Q.length)for(A=g.R(S),t=A.next();!t.done;t=A.next())if(V=n=t.value,Z=V.actionType,rU=V.entityKey,fd=V.actionMetadata,Z&&rU&&fd&&!g.q(fd,Xz1)){Z==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(fd.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(xK=g.q(n.actionMetadata,Ku))xK.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",n.actionMetadata=Object.assign({},n.actionMetadata,{mainVideoEntityActionMetadata:xK});x.push(n)}g.YJ(N2,
7);break;case 6:return BY=g.mF(N2),eQ="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",PY="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",BY instanceof g.gD&&BY.type==="QUOTA_EXCEEDED"&&(eQ="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",PY="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),N2.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,eQ,PY));case 7:return N2.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,x))}})},JQ2=function(){z5.apply(this,
arguments);
this.e$="mainVideoEntity"},UY1=function(O,f,P){f=f===void 0?43200:f;
P=P===void 0?!0:P;var x=x===void 0?!1:x;var M,r,d;return g.T(function(B){switch(B.S){case 1:if(!O.C.h1())return B.return([]);M=[];g.oQ(B,2);return g.H(B,X6F(f,P,x),4);case 4:M=B.N;g.YJ(B,3);break;case 2:r=g.mF(B),r instanceof Error&&r.message==="No data"||r instanceof Error&&r.message==="Empty response body"&&PJ(r.message);case 3:return d=K8T(O,M,P,"mainPlaylistEntity"),B.return(d)}})},qwS=function(O,f,P,x){x=x===void 0?!1:x;
var M,r,d,B,k,Y,m,e,X,I,J,l,S,Q,A;return g.T(function(t){switch(t.S){case 1:return M=[],g.H(t,IW2(),2);case 2:return(r=t.N)||x?g.H(t,U5r(f,P),3):t.return([]);case 3:d=t.N;if((B=d)==null||!B.length)return t.return([]);k={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};Y=g.R(d);m=Y.next();case 4:if(m.done){t.R_(6);break}X=e=m.value;I=X.actionType;J=X.entityKey;l=X.actionMetadata;if(!(I&&J&&l)||g.q(l,Xz1)){t.R_(5);break}I==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(l.offlineLoggingData=
k);S=g.VH(J);Q=S.entityId;return g.H(t,hi(O,[Q],"mainVideoEntity",I,l),8);case 8:A=t.N,M=M.concat(A);case 5:m=Y.next();t.R_(4);break;case 6:return t.return(M)}})},LoF=function(O,f){this.S=O;
this.K=f},Nl1=function(O,f){var P,x,M,r,d,B,k,Y,m,e,X,I,J,l,S,Q;
return g.T(function(A){switch(A.S){case 1:return P=BJ(f),x=g.VH(f.entityKey),M=x.entityId,r=[],g.oQ(A,2),g.H(A,lD4(O,M),4);case 4:r=A.N;if((d=r)==null||!d.length){A.R_(5);break}return g.H(A,w6S(O.S,f.entityKey),5);case 5:g.YJ(A,3);break;case 2:return B=g.mF(A),k="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",B instanceof g.gD&&B.type==="QUOTA_EXCEEDED"&&(k="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
A.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,k,Y));case 3:return m=[],g.H(A,$oS(O.S,"musicTrack",r),7);case 7:r=A.N;if(r.length)for(e=g.R(r),X=e.next();!X.done;X=e.next())if(I=X.value,J=I.offlineVideoData,l=void 0,(l=J)==null?0:l.videoId)S=void 0,Q=Number(((S=f.actionMetadata)==null?void 0:S.priority)||0)+1,m.push(ti("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",J.videoId,"musicTrack",Q,a6,bB(f,J,M)));return A.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,m))}})},
Sw1=function(O,f){var P,x,M,r,d,B,k,Y,m,e,X,I,J,l,S,Q,A,t,n,V,Z,rU,fd,xK,BY,eQ,PY,N2,iV,wE,ZE,sg,HY,aQ,tZ,b,D2,ET,oT,Q2,u,Og,la,BX,KB,og,DE,Pr,CB,C,N,G,p,E,wU,a,z,W,tK;
return g.T(function(F0){switch(F0.S){case 1:return P=BJ(f),x=f.entityKey,M=g.VH(x).entityId,r=[],d=!1,M==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.H(F0,ii(O.S,"musicAlbumRelease"),5)):g.H(F0,sB(O.S,x,"musicAlbumRelease"),4);case 4:(B=F0.N)&&r.push(B);F0.R_(3);break;case 5:r=F0.N;case 3:if((k=r)==null||!k.length)return F0.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));if(d){Y=[];m=g.R(r);for(e=m.next();!e.done;e=m.next())X=e.value,I=g.VH(X.id).entityId,Y.push(ti("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
I,"musicAlbumRelease",0,a6));return F0.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,Y))}J=[];l=r[0];S=void 0;if(!l.downloadMetadata){F0.R_(6);break}return g.H(F0,sB(O.S,l.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:Q=F0.N,S=Number((t=(A=Q)==null?void 0:A.addedTimestampMillis)!=null?t:"0")/1E3;case 6:return g.oQ(F0,8),g.H(F0,lD4(O,M,(n=S)==null?void 0:n.toString()),10);case 10:J=F0.N;g.YJ(F0,9);break;case 8:V=g.mF(F0);if(!(V instanceof Error&&V.message===
"No data")){if(V instanceof Error&&V.message==="Empty response body")PJ(V.message);else return Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",rU="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",V instanceof g.gD&&V.type==="QUOTA_EXCEEDED"&&(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",rU="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),F0.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,Z,rU));F0.R_(9);break}return g.H(F0,G5(M,"musicAlbumRelease",
O.S,f,O.K),9);case 9:fd=[];xK=new Map;if((BY=J)==null?0:BY.length)for(eQ=g.R(J),PY=eQ.next();!PY.done;PY=eQ.next())N2=PY.value,iV=N2.offlineVideoData,wE=void 0,((wE=iV)==null?0:wE.videoId)&&xK.set(iV.videoId,iV);ZE=new Map;sg=[];if((HY=l)==null?0:(aQ=HY.tracks)==null?0:aQ.length)for(tZ=g.R(l.tracks),b=tZ.next();!b.done;b=tZ.next())if(D2=b.value,ET=g.VH(D2).entityId)xK.has(ET)?(ZE.set(ET,xK.get(ET)),xK.delete(ET)):sg.push(ET);Q2=Number(((oT=f.actionMetadata)==null?void 0:oT.priority)||0)+1;u=g.R(xK.entries());
for(Og=u.next();!Og.done;Og=u.next())la=Og.value,BX=g.R(la),KB=BX.next().value,og=BX.next().value,DE=KB,Pr=og,fd.push(ti("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",DE,"musicTrack",Q2,a6,bB(f,Pr)));CB=g.R(ZE.entries());for(C=CB.next();!C.done;C=CB.next())N=C.value,G=g.R(N),p=G.next().value,E=G.next().value,wU=p,a=E,fd.push(ti("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",wU,"musicTrack",Q2,a6,bB(f,a)));z=g.R(sg);for(W=z.next();!W.done;W=z.next())tK=W.value,fd.push(ti("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
tK,"musicTrack",0,a6));return F0.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,fd))}})},uar=function(O,f){var P,x;
return g.T(function(M){switch(M.S){case 1:return P=BJ(f),g.oQ(M,2),x=g.VH(f.entityKey).entityId,x==="!*$_ALL_ENTITIES_!*$"?g.H(M,Cu(O.S,f,O.K),5):g.H(M,G5(x,"musicAlbumRelease",O.S,f,O.K),6);case 6:return g.H(M,BYF(O.S,f.entityKey),5);case 5:g.YJ(M,3);break;case 2:return g.mF(M),M.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return M.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
P))}})},lD4=function(O,f,P){var x,M,r;
return g.T(function(d){switch(d.S){case 1:return g.H(d,e9S([f]),2);case 2:return x=d.N,g.H(d,GTF(O,x[0],P),3);case 3:return M=d.N,r=X$(M.thumbnailDetails),g.H(d,Lu(r),4);case 4:return d.return(x[0].videos)}})},GTF=function(O,f,P){var x,M,r,d,B,k,Y,m,e,X,I,J,l,S;
return g.T(function(Q){if(Q.S==1){x=f.additionalMetadadatas;M=void 0;if(x&&x.length>0)for(r=g.R(x),d=r.next();!d.done;d=r.next())if(B=d.value,B.offlineMusicPlaylistData){M=B.offlineMusicPlaylistData;break}k=f.playlistId;Y=oeS(f);m=Y.Zd;e=Y.A6;X=P?(Number(P)*1E3).toString():Date.now().toString();I=f.lastModifiedTimestamp?(Number(f.lastModifiedTimestamp)*1E3).toString():"0";J={id:g.vP(k,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:e,lastModifiedTimestampMillis:I,addedTimestampMillis:X,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};l={id:g.vP(k,"musicAlbumRelease"),title:f.title,audioPlaylistId:k,trackCount:f.totalVideoCount,tracks:m,downloadMetadata:J.id};M&&(l.thumbnailDetails=(S=M.albumHqThumbnail)!=null?S:M.albumArtistThumbnail,l.artistDisplayName=M.albumArtistDisplayName,l.releaseDate=M.albumReleaseDate,l.contentRating={explicitType:M.albumReleaseExplicitType},l.releaseType=M.albumReleaseType);return g.H(Q,KZ(O.S,{mode:"readwrite",b1:!0},function(A){var t=vN(A,l,"musicAlbumRelease");
A=vN(A,J,"musicAlbumReleaseDownloadMetadataEntity");return g.lj.all([t,A])}),2)}return Q.return(l)})},CIr=function(O,f){this.S=O;
this.K=f},AQZ=function(O,f){var P,x,M,r,d,B,k,Y,m,e,X,I,J,l,S,Q;
return g.T(function(A){switch(A.S){case 1:return P=BJ(f),x=g.VH(f.entityKey),M=x.entityId,r=[],g.oQ(A,2),g.H(A,bpF(O,M),4);case 4:r=A.N;if((d=r)==null||!d.length){A.R_(5);break}return g.H(A,w6S(O.S,f.entityKey),5);case 5:g.YJ(A,3);break;case 2:return B=g.mF(A),k="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",B instanceof g.gD&&B.type==="QUOTA_EXCEEDED"&&(k="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
A.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,k,Y));case 3:return m=[],g.H(A,$oS(O.S,"musicTrack",r),7);case 7:r=A.N;if(r.length)for(e=g.R(r),X=e.next();!X.done;X=e.next())if(I=X.value,J=I.offlineVideoData,l=void 0,(l=J)==null?0:l.videoId)S=void 0,Q=Number(((S=f.actionMetadata)==null?void 0:S.priority)||0)+1,m.push(ti("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",J.videoId,"musicTrack",Q,s8,bB(f,J,M)));return A.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,m))}})},
Qr1=function(O,f){var P,x,M,r,d,B,k,Y,m,e,X,I,J,l,S,Q,A,t,n,V,Z,rU,fd,xK,BY,eQ,PY,N2,iV,wE,ZE,sg,HY,aQ,tZ,b,D2,ET,oT,Q2,u,Og,la,BX,KB,og,DE,Pr,CB,C,N,G,p,E,wU,a,z,W,tK,F0,q2,QJ,MF,bV,cX,pB,sT,RT,Vu,nd,NF;
return g.T(function(cY){switch(cY.S){case 1:return P=BJ(f),x=f.entityKey,M=g.VH(x).entityId,r=[],d=!1,M==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.H(cY,ii(O.S,"musicPlaylist"),5)):g.H(cY,sB(O.S,x,"musicPlaylist"),4);case 4:(B=cY.N)&&r.push(B);cY.R_(3);break;case 5:r=cY.N;case 3:if((k=r)==null||!k.length)return cY.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));Y=g.q(f.actionMetadata,km2);e=(m=Y)==null?void 0:m.autoSync;X=[];J=I=!0;l=!1;S=void 0;if(!d&&e===!1){cY.R_(6);break}g.oQ(cY,7);return g.H(cY,
qKT(0,!!e,!0,r),9);case 9:X=cY.N;g.YJ(cY,8);break;case 7:Q=g.mF(cY);if(!(Q instanceof Error&&Q.message==="No data")){Q instanceof Error&&Q.message==="Empty response body"&&PJ(Q.message);cY.R_(8);break}return M==="!*$_ALL_ENTITIES_!*$"?g.H(cY,Cu(O.S,f,O.K),8):g.H(cY,G5(M,"musicPlaylist",O.S,f,O.K),8);case 8:if(!X.length||!d&&X[0].playlistId!==M)return cY.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));case 6:if(d){A=[];t=g.R(X);for(n=t.next();!n.done;n=t.next())V=n.value,V.upToDate||
e&&!V.shouldAutoSyncMetadata||!V.playlistId||(Z={autoSync:e},A.push(ti("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",V.playlistId,"musicPlaylist",0,s8,{musicPlaylistEntityActionMetadata:Z})));return cY.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,A))}X.length&&(rU=X[0],l=!!rU.upToDate,e&&(I=(fd=rU.shouldAutoSyncMetadata)!=null?fd:!0,J=(xK=rU.shouldAutoSyncVideos)!=null?xK:!0,rU.checkInSeconds&&(S=rU.checkInSeconds)));if(l||!I)return cY.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
P));BY=[];eQ=r[0];PY=void 0;if(!eQ.downloadMetadata){cY.R_(15);break}return g.H(cY,sB(O.S,eQ.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:N2=cY.N,PY=Number((wE=(iV=N2)==null?void 0:iV.addedTimestampMillis)!=null?wE:"0")/1E3;case 15:return g.oQ(cY,17),g.H(cY,bpF(O,M,(ZE=PY)==null?void 0:ZE.toString(),S),19);case 19:BY=cY.N;g.YJ(cY,18);break;case 17:sg=g.mF(cY);if(!(sg instanceof Error&&sg.message==="No data")){if(sg instanceof Error&&sg.message==="Empty response body")PJ(sg.message);
else return HY="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",aQ="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",sg instanceof g.gD&&sg.type==="QUOTA_EXCEEDED"&&(HY="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",aQ="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),cY.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,HY,aQ));cY.R_(18);break}return g.H(cY,G5(M,"musicPlaylist",O.S,f,O.K),18);case 18:if(!J)return cY.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
P));tZ=[];b=new Map;if((D2=BY)==null?0:D2.length)for(ET=g.R(BY),oT=ET.next();!oT.done;oT=ET.next())Q2=oT.value,u=Q2.offlineVideoData,Og=void 0,((Og=u)==null?0:Og.videoId)&&b.set(u.videoId,u);la=new Map;BX=[];if((KB=eQ)==null?0:(og=KB.tracks)==null?0:og.length)for(DE=g.R(eQ.tracks),Pr=DE.next();!Pr.done;Pr=DE.next())if(CB=Pr.value,C=g.VH(CB).entityId)b.has(C)?(la.set(C,b.get(C)),b.delete(C)):BX.push(C);G=Number(((N=f.actionMetadata)==null?void 0:N.priority)||0)+1;p=g.R(b.entries());for(E=p.next();!E.done;E=
p.next())wU=E.value,a=g.R(wU),z=a.next().value,W=a.next().value,tK=z,F0=W,tZ.push(ti("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",tK,"musicTrack",G,s8,bB(f,F0)));q2=g.R(la.entries());for(QJ=q2.next();!QJ.done;QJ=q2.next())MF=QJ.value,bV=g.R(MF),cX=bV.next().value,pB=bV.next().value,sT=cX,RT=pB,tZ.push(ti("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",sT,"musicTrack",G,s8,bB(f,RT)));Vu=g.R(BX);for(nd=Vu.next();!nd.done;nd=Vu.next())NF=nd.value,tZ.push(ti("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",NF,"musicTrack",
0,s8));return cY.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,tZ))}})},RN9=function(O,f){var P,x;
return g.T(function(M){switch(M.S){case 1:return P=BJ(f),g.oQ(M,2),x=g.VH(f.entityKey).entityId,x==="!*$_ALL_ENTITIES_!*$"?g.H(M,Cu(O.S,f,O.K),5):g.H(M,G5(x,"musicPlaylist",O.S,f,O.K),6);case 6:return g.H(M,BYF(O.S,f.entityKey),5);case 5:g.YJ(M,3);break;case 2:return g.mF(M),M.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return M.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
P))}})},bpF=function(O,f,P,x){var M,r,d;
return g.T(function(B){switch(B.S){case 1:return g.H(B,e9S([f]),2);case 2:return M=B.N,g.H(B,tGS(O,M[0],P,x),3);case 3:return r=B.N,d=X$(r.thumbnailDetails),g.H(B,Lu(d),4);case 4:return B.return(M[0].videos)}})},tGS=function(O,f,P,x){var M,r,d,B,k,Y,m,e,X;
return g.T(function(I){return I.S==1?(M=f.playlistId,r=oeS(f),d=r.Zd,B=r.A6,k=P?(Number(P)*1E3).toString():Date.now().toString(),Y=f.lastModifiedTimestamp?(Number(f.lastModifiedTimestamp)*1E3).toString():"0",m={id:g.vP(M,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:B,lastModifiedTimestampMillis:Y,addedTimestampMillis:k,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},e={id:g.vP(M,"musicPlaylist"),title:f.title,playlistId:M,thumbnailDetails:f.thumbnail,visibility:Fo4(f),trackCount:f.totalVideoCount,
tracks:d,downloadMetadata:m.id},x&&(((X=e)==null?0:X.entityMetadata)?e.entityMetadata.nextAutoRefreshIntervalSeconds=String(x):e&&(e.entityMetadata={nextAutoRefreshIntervalSeconds:String(x)})),g.H(I,KZ(O.S,{mode:"readwrite",b1:!0},function(J){var l=vN(J,e,"musicPlaylist");J=vN(J,m,"musicPlaylistDownloadMetadataEntity");return g.lj.all([l,J])}),2)):I.return(e)})},Fo4=function(O){switch(O.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},n2T=function(O,f){this.S=O;
this.K=f},Wo1=function(O,f){var P,x,M,r,d,B,k,Y,m,e,X,I,J;
return g.T(function(l){switch(l.S){case 1:return P=BJ(f),x=g.VH(f.entityKey),M=x.entityId,r=g.q(f.actionMetadata,pz1),g.oQ(l,2),g.H(l,jrJ(O,M,void 0,(d=r)==null?void 0:d.track,(B=r)==null?void 0:B.albumRelease),4);case 4:if((k=r)==null?0:k.playlistId){l.R_(5);break}return g.H(l,w6S(O.S,f.entityKey),5);case 5:g.YJ(l,3);break;case 2:return Y=g.mF(l),m="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Y instanceof g.gD&&Y.type==="QUOTA_EXCEEDED"&&
(m="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),l.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,m,e));case 3:I=Number(((X=f.actionMetadata)==null?void 0:X.priority)||0)+1;var S=(S=g.q(f.actionMetadata,pz1))?{playbackDataActionMetadata:{maximumDownloadQuality:S.maximumDownloadQuality}}:void 0;J=ti("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",M,"playbackData",I,HpZ,S);return l.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
P,[J]))}})},TlZ=function(O,f){var P,x,M,r,d,B,k,Y,m,e,X,I,J,l,S;
return g.T(function(Q){switch(Q.S){case 1:return P=BJ(f),x=g.VH(f.entityKey),M=x.entityId,g.H(Q,sB(O.S,f.entityKey,"musicTrack"),2);case 2:r=Q.N;if(!r){d=void 0;Q.R_(3);break}return g.H(Q,sB(O.S,r.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:d=Q.N;case 3:B=d;if(!r||!B)return Q.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P));Y=g.q(f.actionMetadata,pz1);g.oQ(Q,5);return g.H(Q,jrJ(O,M,B.addedTimestampMillis,(m=Y)==null?void 0:m.track,(e=Y)==null?void 0:e.albumRelease),
7);case 7:I=Number(((X=f.actionMetadata)==null?void 0:X.priority)||0)+1;k=ti("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",M,"playbackData",I,HpZ);g.YJ(Q,6);break;case 5:J=g.mF(Q);if(!(J instanceof Error&&J.message==="No data")){if(J instanceof Error&&J.message==="Empty response body")PJ(J.message);else return l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",J instanceof g.gD&&J.type==="QUOTA_EXCEEDED"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
S="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Q.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,l,S));Q.R_(6);break}return g.H(Q,uB(M,O.S,f,O.K),6);case 6:return Q.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",P,k?[k]:void 0))}})},$Y2=function(O,f){var P,x;
return g.T(function(M){switch(M.S){case 1:return P=BJ(f),g.oQ(M,2),x=g.VH(f.entityKey).entityId,x==="!*$_ALL_ENTITIES_!*$"?g.H(M,Cu(O.S,f,O.K),5):g.H(M,uB(x,O.S,f,O.K),6);case 6:return g.H(M,BYF(O.S,f.entityKey),5);case 5:g.YJ(M,3);break;case 2:return g.mF(M),M.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",P,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return M.return(new F$("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
P))}})},jrJ=function(O,f,P,x,M){var r,d,B,k,Y,m;
return g.T(function(e){switch(e.S){case 1:if(r=x){e.R_(2);break}return g.H(e,m52([f]),3);case 3:d=e.N,B=d[0],r=d5T(B);case 2:return g.H(e,ZpS(O,r,f,M,P),4);case 4:k=e.N;Y=k.musicTrackEntity;m=k.HD;var X=X$(Y.thumbnailDetails),I=[];m&&(I=X$(m.thumbnailDetails));return g.H(e,Lu(X.concat(I)),0)}})},ZpS=function(O,f,P,x,M){var r;
return g.T(function(d){return d.S==1?(M||(M=Date.now().toString()),r={id:g.vP(P,"musicTrackDownloadMetadataEntity"),playbackData:g.vP(P,"playbackData"),addedTimestampMillis:M,videoDownloadContextEntity:g.vP(P,"videoDownloadContextEntity")},x&&(f.albumRelease=x.id),g.H(d,KZ(O.S,{mode:"readwrite",b1:!0},function(B){var k=[],Y=vN(B,r,"musicTrackDownloadMetadataEntity");k.push(Y);Y=vN(B,f,"musicTrack");k.push(Y);x&&(B=vN(B,x,"musicAlbumRelease"),k.push(B));return g.lj.all(k)}),2)):d.S!=3?g.H(d,mV(P,"musicTrackDownloadMetadataEntity",
O.S,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):d.return({musicTrackEntity:f,
HD:x})})},iB=function(){z5.apply(this,arguments);
this.e$="musicTrack"},cQ1=function(O,f,P){f=f===void 0?43200:f;
P=P===void 0?!0:P;var x=x===void 0?!1:x;var M,r;return g.T(function(d){switch(d.S){case 1:if(!O.C.h1())return d.return([]);M=[];g.oQ(d,2);return g.H(d,qKT(f,P,x),4);case 4:M=d.N;g.YJ(d,3);break;case 2:g.mF(d);case 3:return r=K8T(O,M,P,"musicPlaylist"),d.return(r)}})},VG1=function(){g.gL.apply(this,arguments);
var O=this;this.events=new g.kN(this);this.U=this.player.B();this.Pr={LW5:function(){return O.S},
Jm:function(){return O.Jm()},
Zh:function(f){return O.Zh(f)}}},v2Q=function(O){var f;
O=g.q((f=O.getWatchNextResponse())==null?void 0:f.currentVideoEndpoint,g.eY);if(O==null?0:O.playlistId)var P=O.playlistId;return P},zN9=function(O,f){var P,x,M,r;
return g.T(function(d){if(d.S==1){P=f.clientPlaybackNonce;x={cpn:P,offlineSourceVisualElement:g.XY(f.S$||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};f.N&&(x.videoFmt=Number(f.N.itag));f.X&&(x.audioFmt=Number(f.X.itag));if((M=v2Q(f))&&f.videoId){var B=f.videoId;B=M!=="PPSV"?Promise.resolve(!1):O.S.t8(B);d=g.H(d,B,3)}else d=d.R_(2);return d}d.S!=2&&(r=d.N)&&(x.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");O.N=P;g.eo("offlinePlaybackStarted",x);g.Br(d)})};
g.p_.prototype.Lc=g.VJ(41,function(O){return this.app.Lc(O)});
g.Xn.prototype.Lc=g.VJ(40,function(O){return g.ZHR(this,9,O)});
g.L(j1,pZ);g.Eg.Object.defineProperties(j1.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.S.entityMetadata},
set:function(O){this.S.entityMetadata=O}}});
g.L(tBE,j1);tBE.prototype.N=function(){return[]};
g.L(Fe4,j1);Fe4.prototype.N=function(){return[]};
g.L(nb4,j1);nb4.prototype.N=function(){return[]};
g.L(p8T,j1);p8T.prototype.N=function(){return[]};
g.L(jY2,j1);jY2.prototype.N=function(){return[]};
g.L(HCJ,j1);HCJ.prototype.N=function(){var O=[];this.S.alternateChannel&&O.push(this.S.alternateChannel);this.S.alternateChannelList&&O.push.apply(O,g.F(this.S.alternateChannelList));this.S.oneofChannelEntity&&O.push(this.S.oneofChannelEntity);return[].concat(g.F(new Set(O)))};
g.L(We2,j1);We2.prototype.N=function(){var O=[];this.S.entryCollection&&O.push(this.S.entryCollection);return[].concat(g.F(new Set(O)))};
g.L(T$9,pZ);T$9.prototype.N=function(){var O=[];this.S.video&&O.push(this.S.video);return[].concat(g.F(new Set(O)))};
g.L($p4,j1);$p4.prototype.N=function(){var O=[];this.S.parentPlaylist&&O.push(this.S.parentPlaylist);if(this.S.entries)for(var f=g.R(this.S.entries),P=f.next();!P.done;P=f.next())O.push.apply(O,g.F((new T$9(P.value)).N()));return[].concat(g.F(new Set(O)))};
g.L(ZCT,j1);ZCT.prototype.N=function(){var O=[];this.S.descriptionEntity&&O.push(this.S.descriptionEntity);this.S.creators&&O.push.apply(O,g.F(this.S.creators));this.S.theBiggestFan&&O.push(this.S.theBiggestFan);return[].concat(g.F(new Set(O)))};
g.L(cH2,j1);cH2.prototype.N=function(){return[]};
g.L(VB2,j1);VB2.prototype.N=function(){return[]};
g.L(vbZ,j1);vbZ.prototype.N=function(){return[]};
g.L(z0F,j1);z0F.prototype.N=function(){return[]};
g.L(h0r,j1);h0r.prototype.N=function(){return[]};
g.L(EbJ,j1);EbJ.prototype.N=function(){return[]};
g.L(KeQ,j1);KeQ.prototype.N=function(){return[]};
g.L(a_2,j1);a_2.prototype.N=function(){return[]};
g.L(sYr,j1);sYr.prototype.N=function(){return[]};
g.L(iCE,j1);iCE.prototype.N=function(){var O=[];this.S.downloadsList&&O.push(this.S.downloadsList);this.S.smartDownloadsList&&O.push(this.S.smartDownloadsList);this.S.recommendedDownloadsList&&O.push(this.S.recommendedDownloadsList);this.S.refresh&&O.push(this.S.refresh);return[].concat(g.F(new Set(O)))};
g.L(Dp9,pZ);Dp9.prototype.N=function(){var O=[];this.S.video&&O.push(this.S.video);this.S.playlist&&O.push(this.S.playlist);this.S.videoItem&&O.push(this.S.videoItem);this.S.playlistItem&&O.push(this.S.playlistItem);return[].concat(g.F(new Set(O)))};
g.L(yHE,j1);yHE.prototype.N=function(){var O=[];this.S.refresh&&O.push(this.S.refresh);if(this.S.downloads)for(var f=g.R(this.S.downloads),P=f.next();!P.done;P=f.next())O.push.apply(O,g.F((new Dp9(P.value)).N()));return[].concat(g.F(new Set(O)))};
g.L(Oq4,j1);Oq4.prototype.N=function(){var O=[];this.S.localImageEntities&&O.push.apply(O,g.F(this.S.localImageEntities));return[].concat(g.F(new Set(O)))};
g.L(fbT,j1);fbT.prototype.N=function(){var O=[];this.S.playbackData&&O.push(this.S.playbackData);this.S.localImageEntities&&O.push.apply(O,g.F(this.S.localImageEntities));this.S.videoDownloadContextEntity&&O.push(this.S.videoDownloadContextEntity);return[].concat(g.F(new Set(O)))};
g.L(Pp2,j1);Pp2.prototype.N=function(){return[]};
g.L(xLS,j1);xLS.prototype.N=function(){var O=[];this.S.fakeChildren&&O.push.apply(O,g.F(this.S.fakeChildren));return[].concat(g.F(new Set(O)))};
g.L(MT4,j1);MT4.prototype.N=function(){var O=[];this.S.video&&O.push(this.S.video);this.S.playbackData&&O.push(this.S.playbackData);this.S.offlineVideoPolicy&&O.push(this.S.offlineVideoPolicy);return[].concat(g.F(new Set(O)))};
g.L(rDr,j1);rDr.prototype.N=function(){return[]};
g.L(dLZ,j1);dLZ.prototype.N=function(){var O=[];this.S.channelOwner&&O.push(this.S.channelOwner);this.S.videos&&O.push.apply(O,g.F(this.S.videos));this.S.collaboratorChannels&&O.push.apply(O,g.F(this.S.collaboratorChannels));this.S.downloadState&&O.push(this.S.downloadState);this.S.refresh&&O.push(this.S.refresh);return[].concat(g.F(new Set(O)))};
g.L(wv1,j1);wv1.prototype.N=function(){var O=[];this.S.video&&O.push(this.S.video);this.S.channelContributor&&O.push(this.S.channelContributor);return[].concat(g.F(new Set(O)))};
g.L(BiE,pZ);BiE.prototype.N=function(){var O=[];this.S.localImageEntities&&O.push.apply(O,g.F(this.S.localImageEntities));this.S.videoDownloadContextEntity&&O.push(this.S.videoDownloadContextEntity);return[].concat(g.F(new Set(O)))};
g.L(okJ,pZ);okJ.prototype.N=function(){var O=[];this.S.recommendedVideoMetadata&&O.push.apply(O,g.F((new BiE(this.S.recommendedVideoMetadata)).N()));return[].concat(g.F(new Set(O)))};
g.L(kbS,pZ);kbS.prototype.N=function(){var O=[];this.S.playbackPosition&&O.push(this.S.playbackPosition);return[].concat(g.F(new Set(O)))};
g.L(YFr,j1);YFr.prototype.N=function(){var O=[];this.S.owner&&O.push(this.S.owner);this.S.downloadState&&O.push(this.S.downloadState);this.S.userState&&O.push.apply(O,g.F((new kbS(this.S.userState)).N()));this.S.additionalMetadata&&O.push.apply(O,g.F((new okJ(this.S.additionalMetadata)).N()));return[].concat(g.F(new Set(O)))};
g.L(mLJ,j1);mLJ.prototype.N=function(){var O=[];this.S.userChannelDetails&&O.push(this.S.userChannelDetails);return[].concat(g.F(new Set(O)))};
g.L(eKF,j1);eKF.prototype.N=function(){var O=[];this.S.channelOwner&&O.push(this.S.channelOwner);this.S.playbackPosition&&O.push(this.S.playbackPosition);this.S.localImageEntities&&O.push.apply(O,g.F(this.S.localImageEntities));this.S.downloadStatus&&O.push(this.S.downloadStatus);return[].concat(g.F(new Set(O)))};
g.L(gkF,j1);gkF.prototype.N=function(){return[]};
g.L(XvF,j1);XvF.prototype.N=function(){return[]};
g.L(IbS,j1);IbS.prototype.N=function(){return[]};
g.L(JDr,j1);JDr.prototype.N=function(){return[]};
g.L(ULJ,j1);ULJ.prototype.N=function(){return[]};
g.L(qFF,j1);qFF.prototype.N=function(){return[]};
g.L(LgT,j1);LgT.prototype.N=function(){return[]};
g.L(lbF,j1);lbF.prototype.N=function(){return[]};
g.L(NiF,j1);NiF.prototype.N=function(){return[]};
g.L(SF2,j1);SF2.prototype.N=function(){return[]};
g.L(uCF,j1);uCF.prototype.N=function(){return[]};
g.L(GbZ,j1);GbZ.prototype.N=function(){return[]};
g.L(CpF,j1);CpF.prototype.N=function(){return[]};
g.L(bqr,j1);bqr.prototype.N=function(){var O=[];this.S.compositeSourceKeys&&O.push.apply(O,g.F(this.S.compositeSourceKeys));return[].concat(g.F(new Set(O)))};
g.L(ADQ,j1);ADQ.prototype.N=function(){var O=[];this.S.trackDownloadMetadatas&&O.push.apply(O,g.F(this.S.trackDownloadMetadatas));return[].concat(g.F(new Set(O)))};
g.L(Qjr,j1);
Qjr.prototype.N=function(){var O=[];this.S.downloadedTracks&&O.push.apply(O,g.F(this.S.downloadedTracks));this.S.smartDownloadedTracks&&O.push.apply(O,g.F(this.S.smartDownloadedTracks));this.S.downloadedEpisodes&&O.push.apply(O,g.F(this.S.downloadedEpisodes));this.S.downloadedAlbumReleases&&O.push.apply(O,g.F(this.S.downloadedAlbumReleases));this.S.smartDownloadedAlbumReleases&&O.push.apply(O,g.F(this.S.smartDownloadedAlbumReleases));this.S.downloadedPlaylists&&O.push.apply(O,g.F(this.S.downloadedPlaylists));this.S.smartDownloadedPlaylists&&
O.push.apply(O,g.F(this.S.smartDownloadedPlaylists));this.S.metadataOnlyTracks&&O.push.apply(O,g.F(this.S.metadataOnlyTracks));return[].concat(g.F(new Set(O)))};
g.L(RKT,j1);RKT.prototype.N=function(){var O=[];this.S.trackDownloadMetadatas&&O.push.apply(O,g.F(this.S.trackDownloadMetadatas));return[].concat(g.F(new Set(O)))};
g.L(tTT,j1);tTT.prototype.N=function(){var O=[];this.S.playbackData&&O.push(this.S.playbackData);this.S.localImageEntities&&O.push.apply(O,g.F(this.S.localImageEntities));this.S.videoDownloadContextEntity&&O.push(this.S.videoDownloadContextEntity);return[].concat(g.F(new Set(O)))};
g.L(Fg9,j1);Fg9.prototype.N=function(){var O=[];this.S.musicLibraryStatusEntity&&O.push(this.S.musicLibraryStatusEntity);this.S.primaryArtists&&O.push.apply(O,g.F(this.S.primaryArtists));this.S.details&&O.push(this.S.details);this.S.userDetails&&O.push(this.S.userDetails);this.S.tracks&&O.push.apply(O,g.F(this.S.tracks));this.S.share&&O.push(this.S.share);this.S.downloadMetadata&&O.push(this.S.downloadMetadata);this.S.refresh&&O.push(this.S.refresh);return[].concat(g.F(new Set(O)))};
g.L(nkE,j1);nkE.prototype.N=function(){var O=[];this.S.albumRelease&&O.push(this.S.albumRelease);this.S.tracks&&O.push.apply(O,g.F(this.S.tracks));return[].concat(g.F(new Set(O)))};
g.L(pvF,j1);pvF.prototype.N=function(){var O=[];this.S.albumRelease&&O.push(this.S.albumRelease);return[].concat(g.F(new Set(O)))};
g.L(jj4,j1);jj4.prototype.N=function(){var O=[];this.S.details&&O.push(this.S.details);this.S.userDetails&&O.push(this.S.userDetails);return[].concat(g.F(new Set(O)))};
g.L(Hq1,j1);Hq1.prototype.N=function(){var O=[];this.S.parentArtist&&O.push(this.S.parentArtist);return[].concat(g.F(new Set(O)))};
g.L(WgJ,j1);WgJ.prototype.N=function(){var O=[];this.S.parentArtist&&O.push(this.S.parentArtist);return[].concat(g.F(new Set(O)))};
g.L(TiJ,j1);TiJ.prototype.N=function(){return[]};
g.L($LQ,j1);$LQ.prototype.N=function(){return[]};
g.L(ZqF,pZ);ZqF.prototype.N=function(){var O=[];this.S.creatorEntity&&O.push(this.S.creatorEntity);return[].concat(g.F(new Set(O)))};
g.L(cDT,j1);
cDT.prototype.N=function(){var O=[];this.S.tracks&&O.push.apply(O,g.F(this.S.tracks));this.S.refresh&&O.push(this.S.refresh);this.S.musicLibraryStatusEntity&&O.push(this.S.musicLibraryStatusEntity);this.S.details&&O.push(this.S.details);this.S.downloadMetadata&&O.push(this.S.downloadMetadata);this.S.sideloadMetadata&&O.push(this.S.sideloadMetadata);this.S.userDetails&&O.push(this.S.userDetails);this.S.entryCollection&&O.push(this.S.entryCollection);this.S.share&&O.push(this.S.share);this.S.podcastShowAdditionalMetadata&&O.push.apply(O,
g.F((new ZqF(this.S.podcastShowAdditionalMetadata)).N()));return[].concat(g.F(new Set(O)))};
g.L(VTQ,j1);VTQ.prototype.N=function(){return[]};
g.L(vkT,j1);
vkT.prototype.N=function(){var O=[];this.S.musicLibraryStatusEntity&&O.push(this.S.musicLibraryStatusEntity);this.S.artists&&O.push.apply(O,g.F(this.S.artists));this.S.audioModeVersion&&O.push(this.S.audioModeVersion);this.S.videoModeVersion&&O.push(this.S.videoModeVersion);this.S.userDetails&&O.push(this.S.userDetails);this.S.details&&O.push(this.S.details);this.S.albumRelease&&O.push(this.S.albumRelease);this.S.share&&O.push(this.S.share);this.S.libraryEdit&&O.push(this.S.libraryEdit);this.S.downloadMetadata&&
O.push(this.S.downloadMetadata);this.S.playbackPosition&&O.push(this.S.playbackPosition);this.S.lyrics&&O.push(this.S.lyrics);return[].concat(g.F(new Set(O)))};
g.L(zK9,j1);zK9.prototype.N=function(){var O=[];this.S.parentTrack&&O.push(this.S.parentTrack);return[].concat(g.F(new Set(O)))};
g.L(hKE,j1);hKE.prototype.N=function(){var O=[];this.S.parentTrack&&O.push(this.S.parentTrack);return[].concat(g.F(new Set(O)))};
g.L(EkS,j1);EkS.prototype.N=function(){return[]};
g.L(Kg4,j1);Kg4.prototype.N=function(){return[]};
g.L(abF,j1);abF.prototype.N=function(){return[]};
g.L(sjF,j1);sjF.prototype.N=function(){return[]};
g.L(iqS,j1);iqS.prototype.N=function(){var O=[];this.S.transfer&&O.push(this.S.transfer);this.S.adsPlaybackData&&O.push.apply(O,g.F(this.S.adsPlaybackData));this.S.drmLicense&&O.push(this.S.drmLicense);this.S.offlineVideoPolicy&&O.push(this.S.offlineVideoPolicy);this.S.videoDownloadContextEntity&&O.push(this.S.videoDownloadContextEntity);return[].concat(g.F(new Set(O)))};
g.L(DL9,j1);DL9.prototype.N=function(){return[]};
g.L(yDS,j1);yDS.prototype.N=function(){var O=[];this.S.offlineVideoStreams&&O.push.apply(O,g.F(this.S.offlineVideoStreams));this.S.captionTrack&&O.push.apply(O,g.F(this.S.captionTrack));return[].concat(g.F(new Set(O)))};
g.L(OjZ,j1);OjZ.prototype.N=function(){return[]};
g.L(fU9,j1);fU9.prototype.N=function(){return[]};
g.L(PZ1,j1);PZ1.prototype.N=function(){return[]};
g.L(xiF,j1);xiF.prototype.N=function(){return[]};
g.L(MxF,j1);MxF.prototype.N=function(){return[]};
g.L(r$4,j1);r$4.prototype.N=function(){return[]};
g.L(dir,j1);dir.prototype.N=function(){return[]};
g.L(wsZ,j1);wsZ.prototype.N=function(){return[]};
g.L(BwQ,j1);BwQ.prototype.N=function(){return[]};
g.L(ouJ,j1);ouJ.prototype.N=function(){return[]};
g.L(kG1,j1);kG1.prototype.N=function(){return[]};
g.L(YXF,j1);YXF.prototype.N=function(){return[]};
g.L(mi2,j1);mi2.prototype.N=function(){return[]};
g.L(eQ2,j1);eQ2.prototype.N=function(){return[]};
g.L(guQ,j1);guQ.prototype.N=function(){return[]};
g.L(XsF,j1);XsF.prototype.N=function(){return[]};
g.L(IUT,j1);IUT.prototype.N=function(){return[]};
g.L(J$r,j1);J$r.prototype.N=function(){return[]};
g.L(UiT,j1);UiT.prototype.N=function(){return[]};
g.L(qXF,j1);qXF.prototype.N=function(){return[]};
g.L(LmF,j1);LmF.prototype.N=function(){return[]};
g.L(lUE,j1);lUE.prototype.N=function(){return[]};
var LvF=["browse","music/browse","streaming_browse","unplugged/browse"],Gm2=["offline/playlist_sync_check"],YK2=["offline"],lWS=["offline/offline_video_playback_position_sync"],SKQ=["offline/get_playback_data_entity"],HN;WN.getInstance=function(){return g.T(function(O){return O.return(new Promise(function(f){g.yK().then(function(P){P?(WN.instance||(WN.instance=new WN(P)),f(WN.instance)):f(void 0)})}))})};
WN.prototype.get=function(O){var f=this,P,x,M;return g.T(function(r){if(r.S==1)return g.H(r,GG4(f.token),2);if(r.S!=3)return P=r.N,g.H(r,P.get("prefs",O),3);x=r.N;if(!x)return r.return();M=(0,g.Gf)();return x.expirationTimestampMs<=M?r.return():r.return(x.value)})};
WN.prototype.set=function(O,f,P){P=P===void 0?31536E3:P;var x=this,M,r,d;return g.T(function(B){if(B.S==1)return M=(0,g.Gf)(),r={key:O,value:f,expirationTimestampMs:M+P*1E3},g.H(B,GG4(x.token),2);d=B.N;return g.H(B,g.F2(d,"prefs",r),0)})};
WN.prototype.remove=function(O){var f=this,P;return g.T(function(x){if(x.S==1)return g.H(x,GG4(f.token),2);P=x.N;return g.H(x,P.delete("prefs",O),0)})};
g.L(TY,g.dU);g.L($R,RQr);$R.prototype.K=function(O,f){f=FmF(f);O=(new TextEncoder).encode(JSON.stringify(O));return this.S.encrypt(O,f)};
$R.prototype.N=function(O,f){if(!(O instanceof Uint8Array))throw CZ1(1);var P=new TextDecoder;f=FmF(f);O=this.S.decrypt(O,f);return JSON.parse(P.decode(O))};
var nu2={accountLinkStatusEntity:vbZ,booleanEntity:p8T,buttonEntity:guQ,captionTrack:EkS,channelHandle:tBE,chipEntity:dir,commerceAcquisitionClientPayloadEntity:IUT,commerceCartListEntity:J$r,compositeSourceEntity:CpF,multiviewStagingEntity:bqr,contextNoteFeedEntityPayload:Fe4,contextNoteUserRatingEntityPayload:nb4,continuationTokenEntity:rDr,downloadQualityPickerEntity:KeQ,downloadsPageRefreshTokenEntity:sYr,downloadsPageViewConfigurationEntity:gkF,downloadStatusEntity:a_2,dismissState:wsZ,sfvAudioItemCurrentlyPlayingEntity:xiF,
emojiFountainDataEntity:mi2,emojiCustomizationSetEntity:YXF,fakeChannel:HCJ,fakePlaylist:We2,fakePlaylistEntryCollection:$p4,fakeVideo:ZCT,fakeVideoDescription:cH2,featuredProductsEntity:SF2,flowStateEntity:VB2,iconBadgeEntity:UiT,interstitialInteractionStateEntity:h0r,likeButtonAnimationEntity:XvF,liveChatPollStateEntity:EbJ,dataFreshnessEntity:kG1,liveViewerLeaderboardChatEntryPointStateEntity:fU9,liveViewerLeaderboardPointsEntity:PZ1,liveReactionsDataEntity:eQ2,logoEntity:z0F,macroMarkerEntity:IbS,
mainDownloadsLibraryEntity:iCE,mainDownloadsListEntity:yHE,mainPlaylistDownloadStateEntity:Oq4,mainPlaylistEntity:dLZ,mainPlaylistVideoEntity:wv1,mainVideoDownloadStateEntity:fbT,mainVideoEntity:YFr,markersEngagementPanelSyncEntity:JDr,markersVisibilityOverrideEntity:ULJ,musicAlbumReleaseDetail:nkE,musicAlbumReleaseDownloadMetadataEntity:ADQ,musicAlbumRelease:Fg9,musicAlbumReleaseUserDetail:pvF,musicArtistDetail:Hq1,musicArtist:jj4,musicArtistUserDetail:WgJ,musicDownloadsLibraryEntity:Qjr,musicLibraryEdit:TiJ,
musicLibraryStatusEntity:$LQ,musicPlaylist:cDT,musicPlaylistDownloadMetadataEntity:RKT,musicShare:VTQ,musicTrackDetail:zK9,musicTrackDownloadMetadataEntity:tTT,musicTrack:vkT,musicTrackUserDetail:hKE,offlineOrchestrationActionWrapperEntity:Kg4,offlineVideoPolicy:abF,offlineVideoStreams:sjF,offlineabilityEntity:Pp2,orchestrationWebSamplingEntity:xLS,pageHeaderEntity:BwQ,pdpStateEntity:qXF,pinnedProductEntity:uCF,playbackData:iqS,playerStateEntity:qFF,quantityIncrementerEntity:LmF,refresh:DL9,saveToPlaylistListEntity:MxF,
selectedChipIndexEntityPayload:LgT,settingEntity:r$4,stringEntity:jY2,suggestedFeedbackChipStateEntity:lbF,transfer:yDS,trendingOfferEntity:GbZ,videoDownloadContextEntity:OjZ,videoOverviewAsyncDataEntity:lUE,videoPlaybackPositionEntity:XsF,votingEntity:ouJ,ytMainChannelEntity:mLJ,youchatPendingResponseEntity:NiF,ytMainDownloadedVideoEntity:MT4,ytMainVideoEntity:eKF};g.L(hT,RQr);hT.prototype.K=function(O){return O};
hT.prototype.N=function(O){if(O instanceof Uint8Array)throw CZ1(0);return O};
g.L(EB,g.c);EB.prototype.observe=function(O){var f=this;this.observers.push(O);return function(){var P=f.observers.indexOf(O);P>=0&&f.observers.splice(P,1)}};
EB.prototype.N=function(O){Km2(this,O.data)};
EB.prototype.Ku=function(){this.channel.close()};
var y$2,ifQ=new g.nE("elementsCommand");var NX=new g.nE("entityBatchUpdate");var Tv4=new g.nE("downloadStatusEntity");var OpF=new g.nE("mainPlaylistEntityActionMetadata");var Ku=new g.nE("mainVideoEntityActionMetadata");var km2=new g.nE("musicPlaylistEntityActionMetadata");var pz1=new g.nE("musicTrackEntityActionMetadata");var Xz1=new g.nE("localImageEntityActionMetadata");var nu=new g.nE("playbackDataActionMetadata");var i4r=new g.nE("transferEntityActionMetadata");var H4S=new g.nE("videoPlaybackPositionEntityActionMetadata");var gy2;new g.mo;new g.mo;qm2.prototype.request=function(O,f,P){f=f===void 0?{}:f;return this.locks.request(O,f,function(x){return P(x)})};var fu=g.G9.caches,O8,uPE;y$.prototype.open=function(O){return fu.open(Nv2(O))};
y$.prototype.has=function(O){return fu.has(Nv2(O))};
y$.prototype.delete=function(O){return fu.delete(Nv2(O))};
y$.prototype.match=function(O,f){var P=this,x,M,r,d,B,k;return g.T(function(Y){switch(Y.S){case 1:return g.H(Y,P.keys(),2);case 2:x=Y.N,M=g.R(x),r=M.next();case 3:if(r.done){Y.R_(5);break}d=r.value;return g.H(Y,P.open(d),6);case 6:return B=Y.N,g.H(Y,B.match(O,f),7);case 7:if(k=Y.N)return Y.return(k);r=M.next();Y.R_(3);break;case 5:return Y.return()}})};
g.L(l$r,y$);l$r.prototype.keys=function(){var O,f,P,x,M,r,d,B,k;return g.T(function(Y){if(Y.S==1)return O=[],f=g.ak("CacheStorage keys"),g.H(Y,fu.keys(),2);P=Y.N;x=g.R(P);for(M=x.next();!M.done;M=x.next()){r=M.value;var m=r.indexOf(":");d=m===-1?{AS:r}:{AS:r.substring(0,m),datasyncId:r.substring(m+1)};B=d.AS;k=d.datasyncId;k===f&&O.push(B)}return Y.return(O)})};g.L(x4,g.c);x4.prototype.K=function(O){this.api.PB("onOfflineOperationFailure",O.data)};
x4.prototype.X=function(O){this.api.publish("offlinetransferpause",O.data)};
x4.prototype.Ku=function(){var O;(O=this.S)==null||O.close();var f;(f=this.N)==null||f.close()};bf4.prototype.Ge=function(){this.S&&rt(this)};
bf4.prototype.La=function(){this.N&&this.N.resolve();this.K=this.S=!1;this.e$()};var ec2=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var KWr="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var rEF="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.L(b4S,R6);b4S.prototype.N=function(O){return o6(O)?R9S(this,O):k4(O)?neF(this,O):Promise.reject(Error("Unsupported action type: "+O.actionType))};g.L(p6F,R6);p6F.prototype.N=function(O){return k4(O)?jsr(this,O):WWE(O)?WvE(this,O):Y4(O)?TYZ(this,O):Promise.reject(Error("Unsupported action type: "+O.actionType))};g.U=$5E.prototype;g.U.GSl=function(O){var f=this,P,x,M,r;return g.T(function(d){if(!g.K(O.state,128))return d.R_(0);P=O.state.l4;var B=(x=P)==null?void 0:x.errorCode,k=(M=P)==null?void 0:M.j9;r=B==="net.connect"&&k===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(B==null?0:B.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.H(d,f.iB(f.player.getVideoData().videoId,r),0)})};
g.U.iB=function(O,f){var P=this;return g.T(function(x){if(x.S==1){if(P.N)return x.return();P.N=!0;return f==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(HJ(P,O,!1,!0),x.R_(0)):g.H(x,j3(P,O),3)}g.hL(O,4);return g.H(x,P.S.iB(f),0)})};
g.U.Ci=function(O){O.status===2?(O.status!==this.K&&(paF(this.S),g.hL(O.videoId,2)),O.nj&&$jr(this.S,O.videoId,O.nj)):O.status===4?(j3(this,O.videoId),this.iB(O.videoId,O.jA?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):O.status===1&&TJ9(this.S);this.K=O.status;this.api.PB("localmediachange",{videoId:O.videoId,status:O.status})};
g.U.AY=function(){var O=this,f;return g.T(function(P){if(P.S==1){if(O.N)return P.return();O.N=!0;f=O.player.getVideoData().videoId;return g.H(P,j3(O,f),2)}return g.H(P,O.S.AY(),0)})};
g.U.oY=function(O){switch(O){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.U.L=function(O){return this.api.B().L(O)};g.L(h9J,R6);h9J.prototype.N=function(O){return o6(O)?Kv4(this,O):k4(O)?aWE(this,O):WWE(O)?ssQ(this,O):Promise.reject(Error("Unsupported action type: "+O.actionType))};PsF.prototype.S=function(O,f){var P=O.action.actionMetadata.priority-f.action.actionMetadata.priority;P===0&&(O.S<f.S?P=-1:O.S>f.S&&(P=1));return P};g.L(WJ,g.c);WJ.prototype.Ku=function(){this.e$&&this.e$();g.c.prototype.Ku.call(this)};
WJ.prototype.createAction=function(O,f){var P=g.VH(O.entityKey).entityType,x=g.Xp(16);return new I6(P,x,O,f.actionId,f.rootActionId)};
WJ.prototype.nu=function(O){var f=this,P,x,M,r,d,B,k,Y,m;return g.T(function(e){if(e.S==1){if(f.zN())return e.return();x=(P=O.offlineOrchestrationActionWrapperEntity)!=null?P:new Set;M=[];r=g.R(x);for(d=r.next();!d.done;d=r.next())B=d.value,k=g.VH(B),Y=k.entityId,rXQ(f.S,Y)||M.push(B);return g.H(e,I6r(f,M),2)}m=e.N;return g.H(e,XaF(f,m),0)})};
WJ.prototype.retry=function(){var O=this;return g.T(function(f){return g.H(f,JXF(O),0)})};qLT.prototype.Yt=function(O,f){f=f===void 0?!0:f;var P=this,x,M,r,d,B,k,Y,m;return g.T(function(e){switch(e.S){case 1:if(!P.S)return e.return();x=[];M=g.Kx(P.S.S,f);r=[];for(d={ey:0};d.ey<M.length;d={ey:d.ey},d.ey++)B=M[d.ey],k=P.S.DE(B,"json3"),Y=g.p6(k,{withCredentials:!0,format:"RAW"},3,500).then(function(X){return function(I){I={metadata:g.AL(M[X.ey]),trackData:I.xhr.responseText};r.push(I)}}(d)).o6(function(X){PJ("Caption fetch error",X)}),x.push(Y);
return g.H(e,R0F(x),2);case 2:return g.oQ(e,3),g.H(e,w_F(O,r),5);case 5:g.YJ(e,0);break;case 3:m=g.mF(e),PJ("Caption DB transaction error",m),g.Br(e)}})};g.L(T5,g.c);T5.prototype.Ku=function(){this.N&&this.N();g.c.prototype.Ku.call(this)};
T5.prototype.K=function(O){var f=this,P,x,M,r,d,B,k,Y;return g.T(function(m){x=(P=O.transfer)!=null?P:new Set;M=[];r=g.R(x);for(d=r.next();!d.done;d=r.next())B=d.value,k=g.VH(B),Y=k.entityId,M.push(Y);return M.length===0?m.return():g.H(m,NJZ(f,M),0)})};g.L(baF,g.c);g.U=baF.prototype;g.U.Ku=function(){this.XU&&this.XU();this.k5.dispose();this.X.dispose();this.GN&&g.wJ(this.C.P$,this.GN);this.mp&&g.wJ(this.C.P$,this.mp);g.c.prototype.Ku.call(this)};
g.U.y5u=function(O){var f=this,P,x,M;return g.T(function(r){switch(r.S){case 1:P=g.vP(O,"transfer");if(f.S&&P===f.S.key){HJ(f.W,f.j,!0);f.X.stop();r.R_(0);break}return g.H(r,KZ(f.N,{mode:"readwrite",b1:!0},function(d){return Zy(d,P,"transfer").then(function(B){if(B&&B.transferState!=="TRANSFER_STATE_COMPLETE"&&B.transferState!=="TRANSFER_STATE_FAILED")return B.transferState="TRANSFER_STATE_PAUSED_BY_USER",vN(d,B,"transfer").then(function(){return B})})}),3);
case 3:x=r.N;if(!x){r.R_(0);break}if(!O||!f.K){r.R_(5);break}return g.H(r,mV(O,f.K,f.N,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.H(r,cJ(f,O),7);case 7:M=r.N,juF({videoId:O,H$:x,offlineModeType:M}),g.Br(r)}})};
g.U.XYU=function(){var O=this;if(this.S&&this.j){HJ(this.W,this.j,!1);var f=this.S,P=(f==null?0:f.key)?g.VH(f.key).entityId:"";P&&this.K&&(new Promise(function(x,M){mV(P,O.K,O.N,"DOWNLOAD_STATE_PAUSED").catch(function(r){M(r)})})).catch(function(x){PJ("Download state setting error",x)})}this.X.stop()};
g.U.b6=function(){this.S?RcZ(this,this.S):Zf(this)};
g.U.Kb=function(O){var f=this;return g.T(function(P){switch(P.S){case 1:if(!f.S){P.R_(2);break}if(f.S.transferState==="TRANSFER_STATE_COMPLETE"||f.S.transferState==="TRANSFER_STATE_FAILED"||!O.transfer||!O.transfer.has(f.S.key)){P.R_(3);break}return g.H(P,sB(f.N,f.S.key,"transfer"),4);case 4:f.S=P.N;if(f.S){P.R_(3);break}return g.H(P,tXr(f),3);case 3:if(f.S)return P.return();case 2:return g.H(P,Zf(f),0)}})};
g.U.iB=function(O,f){var P=this,x,M,r,d,B;return g.T(function(k){switch(k.S){case 1:if(!P.S){Vy(P,"onTransferFailure: "+O);k.R_(2);break}x=P.S;r=((M=x)==null?0:M.key)?g.VH(x.key).entityId:"";a:switch(O){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var Y=!1;break a;default:Y=!0}return Y&&ZaE(P)?g.H(k,vJ(P,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.H(k,
cXQ(P,O),5);case 5:if(!r||!P.K){k.R_(2);break}return g.H(k,mV(r,P.K,P.N,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.H(k,cJ(P,r),9);case 9:d=k.N;wt({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:r,H$:x,offlineModeType:d});if(!r||!P.K){k.R_(2);break}return g.H(k,mV(r,P.K,P.N,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:$4(P),B=Zf(P,!0),f&&f(B),g.Br(k)}})};
g.U.AY=function(O){var f=this,P,x,M,r,d,B,k,Y,m,e,X,I;return g.T(function(J){switch(J.S){case 1:if(!f.S){Vy(f,"onMaybeTransferStreamsExpired");J.R_(2);break}return ZaE(f)?g.H(J,vJ(f,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.H(J,cXQ(f,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!f.K){J.R_(2);break}P=f.S;M=((x=P)==null?0:x.key)?g.VH(P.key).entityId:"";if(!M){J.R_(2);break}return g.H(J,mV(M,f.K,f.N,"DOWNLOAD_STATE_FAILED"),2);case 9:return f.S||Vy(f,"onMaybeTransferStreamsExpiredRetryAttempting"),
r=f.S,B=((d=r)==null?0:d.key)?g.VH(r.key).entityId:"",g.H(J,cJ(f,B),10);case 10:return k=J.N,wt({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:B,H$:r,offlineModeType:k}),Y=c_r(),g.pg(Y,nu,{isEnqueuedForExpiredStreamUrlRefetch:!0}),m=g.vP(B,"playbackData"),e={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:m,actionMetadata:Y},X=U8(new I6("playbackData",B,e)),g.H(J,aL(f.N,X,"offlineOrchestrationActionWrapperEntity"),2);case 2:$4(f),I=Zf(f,!0),
O&&O(I),g.Br(J)}})};
var hNS={},VXJ=(hNS.TRANSFER_STATE_TRANSFERRING=1,hNS.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,hNS);g.U=z5.prototype;g.U.nH=function(){return this.j.promise};
g.U.VO=function(){if(this.N&&this.W)return this.j.promise;hc9(this).then(this.j.resolve).catch(this.j.reject);return this.j.promise};
g.U.UQ=function(O){var f={};return f.playbackData=new b4S(O,this.U,this.S),f.transfer=new h9J(O,this.U),f.videoPlaybackPositionEntity=new p6F(O,this.U),f};
g.U.yO=function(){var O=this;return g.T(function(f){return O.N?g.H(f,AX4(O.N),0):f.R_(0)})};
g.U.MS=function(){var O=this,f,P;return g.T(function(x){if(x.S==1)return O.N||O.W?g.H(x,O.nH(),2):x.return();O.J!==void 0&&(g.S$(O.J),O.J=void 0);O.X!==void 0&&(g.S$(O.X),O.X=void 0);(f=O.N)==null||f.dispose();O.N=void 0;(P=O.W)==null||P.dispose();O.W=void 0;O.api.PB("onOrchestrationLostLeader");O.j=new g.mo;g.Br(x)})};
g.U.isOrchestrationLeader=function(){return this.K.S};
g.U.t8=function(){return g.T(function(O){return O.return(!1)})};
g.U.QQ=function(O){var f=this.S;f.api.publish("offlinetransferpause",O);var P;(P=f.N)==null||P.postMessage(O)};
g.U.b6=function(O){var f,P;return g.T(function(x){if(x.S==1)return g.H(x,Dy(),2);f=x.N;if(!f)return x.return();P=g.vP(O,"transfer");return g.H(x,KZ(f,{mode:"readwrite",b1:!0},function(M){var r=Zy(M,P,"transfer"),d=Zy(M,g.vP(O,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.lj.all([r,d]).then(function(B){B=g.R(B);var k=B.next().value;var Y=B.next().value;return k&&k.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(k.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",vN(M,k,"transfer").then(function(){wt({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:O,H$:k,offlineModeType:Y==null?void 0:Y.offlineModeType});return g.lj.resolve(null)})):g.lj.resolve(null)})}),0)})};
g.U.JK=function(O){O=O===void 0?43200:O;var f=this,P,x,M,r,d,B,k,Y;return g.T(function(m){if(m.S==1)return f.C.h1()?g.H(m,Dy(),2):m.return(Et2());if(m.S!=3){P=m.N;if(!P)return m.return([]);x=Date.now()/1E3;return g.H(m,ii(P,"offlineVideoPolicy"),3)}M=m.N;r=[];d=g.R(M);for(B=d.next();!B.done;B=d.next())k=B.value,Number(k.lastUpdatedTimestampSeconds)+O<=x&&(Y=g.VH(k.key).entityId,r.push(Y));return r.length?m.return(hi(f,r,f.e$,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):m.return([])})};
g.U.deleteAll=function(){return hi(this,["!*$_ALL_ENTITIES_!*$"],this.e$,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.U.refreshAllStaleEntities=function(O){var f=this;return g.T(function(P){return P.S==1?g.H(P,f.JK(O),2):P.return(P.N)})};
g.U.setUpPositionSyncInterval=function(O){var f=this;this.X!==void 0&&(g.S$(this.X),this.X=void 0);var P=O!=null?O:864E5;this.X=g.l2(function(){f.je(P)},P)};
g.U.je=function(O){var f=this,P,x,M,r,d,B;return g.T(function(k){switch(k.S){case 1:return g.oQ(k,2),g.H(k,WN.getInstance(),4);case 4:P=k.N;if(!P)throw Error("prefStorage is undefined");return g.H(k,P.get("psi"),5);case 5:x=k.N;r=((M=x)==null?0:M.WI)?Number(x.WI)/1E3:0;d=Date.now();if(!(r+O<=d)){k.R_(6);break}return g.H(k,hi(f,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.YJ(k,0);break;case 2:B=g.mF(k),PJ("Offline manager error",B),
g.Br(k)}})};
g.U.n8=function(){var O=this,f,P,x,M,r,d,B;return g.T(function(k){if(k.S==1)return g.H(k,Dy(),2);if(k.S!=3)return(f=k.N)?g.H(k,ii(f,"transfer"),3):k.return([]);P=k.N;x=[];M=g.R(P);for(r=M.next();!r.done;r=M.next())d=r.value,d.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&d.key&&(B=g.VH(d.key).entityId,x.push(B));return k.return(a6T(O,x))})};
g.U.bD=function(){return g.T(function(O){return O.return([])})};
g.U.im=function(){return g.T(function(O){g.Br(O)})};
g.U.HK=function(){return g.T(function(O){g.Br(O)})};g.L(snQ,R6);snQ.prototype.N=function(O){return o6(O)?yXF(this,O):k4(O)?fDT(this,O):Y4(O)?PIQ(this,O):Promise.reject(Error("Unsupported action type: "+O.actionType))};
var E8=[10];g.L(wzE,R6);wzE.prototype.N=function(O){return o6(O)?kT9(this,O):k4(O)?YwF(this,O):Y4(O)?mYT(this,O):Promise.reject(Error("Unsupported action type: "+O.actionType))};
var o22=[10];g.L(g22,R6);g22.prototype.N=function(O){return k4(O)?ID1(this,O):Promise.reject(Error("Unsupported action type: "+O.actionType))};g.L(JQ2,z5);g.U=JQ2.prototype;g.U.UQ=function(O){var f=z5.prototype.UQ.call(this,O);f.mainVideoEntity=new wzE(O,this.U,this.S);f.mainPlaylistEntity=new snQ(O,this.U,this.S);f.mainDownloadsListEntity=new g22(O,this.U,this.S);return f};
g.U.refreshAllStaleEntities=function(O,f){var P=this,x,M,r,d,B,k,Y,m,e,X,I;return g.T(function(J){switch(J.S){case 1:x=[];if(!P.U.L("web_player_offline_playlist_auto_refresh")){J.R_(2);break}return g.H(J,UY1(P,O,f),3);case 3:x=J.N;case 2:return g.H(J,WN.getInstance(),4);case 4:return M=J.N,g.H(J,(r=M)==null?void 0:r.get("sdois"),5);case 5:return d=J.N,g.H(J,(B=M)==null?void 0:B.get("lmqf"),6);case 6:k=J.N;if(!d){J.R_(7);break}m=x;e=m.concat;return g.H(J,qwS(P,d,(Y=k)!=null?Y:"SD",O===0),8);case 8:x=
e.call(m,J.N);case 7:return X=x,I=X.concat,g.H(J,z5.prototype.refreshAllStaleEntities.call(P,O,f),9);case 9:return x=I.call(X,J.N),J.return(x)}})};
g.U.t8=function(O){var f,P,x,M,r,d,B,k;return g.T(function(Y){if(Y.S==1)return g.H(Y,Dy(),2);if(Y.S!=3)return(f=Y.N)?g.H(Y,sB(f,g.pQ,"mainDownloadsListEntity"),3):Y.return(!1);P=Y.N;if((x=P)==null?0:(M=x.downloads)==null?0:M.length)for(r=g.vP(O,"mainVideoEntity"),d=g.R(P.downloads),B=d.next();!B.done;B=d.next())if(k=B.value,k.videoItem===r)return Y.return(!0);return Y.return(!1)})};
g.U.bD=function(){var O=this,f,P,x,M,r,d,B,k;return g.T(function(Y){if(Y.S==1)return g.H(Y,Dy(),2);if(Y.S!=3)return(f=Y.N)?g.H(Y,ii(f,"downloadStatusEntity"),3):Y.return([]);P=Y.N;x=[];M=g.R(P);for(r=M.next();!r.done;r=M.next())d=r.value,d.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&d.key&&(B=g.VH(d.key).entityId,x.push(B));return x.length?(k={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},Y.return(hi(O,x,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
k))):Y.return([])})};
g.U.HK=function(){var O;return g.T(function(f){return f.S==1?g.H(f,Dy(),2):(O=f.N)?g.H(f,KZ(O,{mode:"readwrite",b1:!0},function(P){return cN(P,"mainVideoEntity").then(function(x){var M=[];x=g.R(x);for(var r=x.next();!r.done;r=x.next()){r=r.value;var d=void 0;(d=r.userState)!=null&&d.playbackPosition||(d=g.VH(r.key).entityId,d={key:g.vP(d,"videoPlaybackPositionEntity"),videoId:d,lastPlaybackPositionSeconds:"0"},M.push(vN(P,d,"videoPlaybackPositionEntity")),r.userState={playbackPosition:d.key},M.push(vN(P,
r,"mainVideoEntity")))}return g.lj.all(M)})}),0):f.return()})};
g.U.im=function(){var O,f,P,x,M,r,d,B,k,Y,m,e,X,I,J,l,S,Q,A,t,n,V,Z,rU,fd,xK,BY,eQ,PY,N2,iV,wE,ZE,sg,HY,aQ,tZ,b;return g.T(function(D2){if(D2.S==1)return g.H(D2,Dy(),2);if(D2.S!=3){O=D2.N;if(!O)return D2.return();f=g.vP("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.H(D2,KZ(O,{mode:"readonly",b1:!0},function(ET){return g.lj.all([Zy(ET,f,"mainDownloadsListEntity"),Zy(ET,g.pQ,"mainDownloadsListEntity"),cN(ET,"mainVideoEntity"),cN(ET,"mainPlaylistEntity")])}),3)}P=D2.N;
x=g.R(P);M=x.next().value;r=x.next().value;d=x.next().value;B=x.next().value;k=M;Y=r;m=d;e=B;X=new Set;if((I=k)==null?0:(J=I.downloads)==null?0:J.length)for(l=g.R(k.downloads),S=l.next();!S.done;S=l.next())Q=S.value,A=void 0,(t=(A=Q.videoItem)!=null?A:Q.playlistItem)&&X.add(t);if((n=Y)==null?0:(V=n.downloads)==null?0:V.length)for(Z=g.R(Y.downloads),rU=Z.next();!rU.done;rU=Z.next())fd=rU.value,fd.videoItem&&X.add(fd.videoItem);xK=new Set;BY=[];eQ=g.R(e);for(PY=eQ.next();!PY.done;PY=eQ.next()){N2=PY.value;
if(N2.videos)for(iV=g.R(N2.videos),wE=iV.next();!wE.done;wE=iV.next())ZE=wE.value,(sg=JSON.parse(g.VH(ZE).entityId).videoId)&&xK.add(sg);N2.key&&!X.has(N2.key)&&BY.push(N2.key)}HY=g.R(m);for(aQ=HY.next();!aQ.done;aQ=HY.next())tZ=aQ.value,tZ.key&&!X.has(tZ.key)&&(b=g.VH(tZ.key).entityId,xK.has(b)||BY.push(tZ.key));return BY.length?g.H(D2,fWF(O,BY),0):D2.R_(0)})};g.L(LoF,R6);LoF.prototype.N=function(O){return o6(O)?Nl1(this,O):k4(O)?Sw1(this,O):Y4(O)?uar(this,O):Promise.reject(Error("Unsupported action type: "+O.actionType))};
var a6=[10];g.L(CIr,R6);CIr.prototype.N=function(O){return o6(O)?AQZ(this,O):k4(O)?Qr1(this,O):Y4(O)?RN9(this,O):Promise.reject(Error("Unsupported action type: "+O.actionType))};
var s8=[10];g.L(n2T,R6);n2T.prototype.N=function(O){return o6(O)?Wo1(this,O):k4(O)?TlZ(this,O):Y4(O)?$Y2(this,O):Promise.reject(Error("Unsupported action type: "+O.actionType))};
var HpZ=[10];g.L(iB,z5);iB.prototype.UQ=function(O){var f=z5.prototype.UQ.call(this,O);f.musicTrack=new n2T(O,this.S);f.musicPlaylist=new CIr(O,this.S);f.musicAlbumRelease=new LoF(O,this.S);return f};
iB.prototype.refreshAllStaleEntities=function(O,f){var P=this,x,M,r;return g.T(function(d){if(d.S==1)return g.H(d,cQ1(P,O,f),2);if(d.S!=3)return M=x=d.N,r=M.concat,g.H(d,z5.prototype.refreshAllStaleEntities.call(P,O,f),3);x=r.call(M,d.N);return d.return(x)})};g.L(VG1,g.gL);g.U=VG1.prototype;g.U.create=function(){var O=this;g.v(this,this.events);if(g.B3(this.U))this.S=new JQ2(this.U,this.player);else if(g.jf(this.U)||g.kI(this.U))this.S=new iB(this.U,this.player);this.events.Z(this.player,"onPlaybackStartExternal",function(){O.Jm()});
this.events.Z(this.player,"videodatachange",function(){O.Jm()});
this.U.L("html5_offline_playback_position_sync")&&this.events.Z(this.player,"presentingplayerstatechange",this.Zh)};
g.U.CV=function(){return!1};
g.U.xK=function(O,f,P,x){var M=this;return g.T(function(r){return M.S?r.return(hi(M.S,O,f,P,x)):r.return(Promise.reject())})};
g.U.deleteAll=function(){return this.S.deleteAll()};
g.U.JK=function(O){return this.S.JK(O)};
g.U.refreshAllStaleEntities=function(O){return this.S.refreshAllStaleEntities(O)};
g.U.setUpPositionSyncInterval=function(O){this.S.setUpPositionSyncInterval(O)};
g.U.QQ=function(O){this.S.QQ(O)};
g.U.b6=function(O){return this.S.b6(O)};
g.U.Jm=function(){var O=this,f;return g.T(function(P){f=O.player.getVideoData();return g.wQ(f)?v2Q(f)&&O.N!==f.clientPlaybackNonce?g.H(P,zN9(O,f),0):P.R_(0):P.return()})};
g.U.Zh=function(O){var f=this,P,x,M,r,d,B,k;return g.T(function(Y){if(Y.S==1)return P=f.player.getVideoData(),x=P.zd,g.mH(O,2)||g.mH(O,512)?g.H(Y,Dy(),2):Y.return();if(Y.S!=3){M=Y.N;if(!M)return PJ("PES is undefined"),Y.return();r=P.videoId;return g.H(Y,sB(M,g.vP(r,"mainVideoEntity"),"mainVideoEntity"),3)}d=Y.N;if(!d)return Y.return();B=Math.floor(x).toString();k={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:B}};return g.H(Y,f.xK([r],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
k),0)})};
g.U.isOrchestrationLeader=function(){return this.S.isOrchestrationLeader()};
g.U.updateDownloadState=function(O,f){var P,x,M,r;return g.T(function(d){if(d.S==1)return g.H(d,Dy(),2);P=d.N;if(!P)return PJ("PES is undefined"),d.return();x=g.VH(O);M=x.entityType;r=x.entityId;return g.H(d,mV(r,M,P,f,!0),0)})};g.eu("offline",VG1);})(_yt_player);
